{% include  'base.html' %}
{% load static %}
{% block contentarea%}
<title>Letworkbedone - Inbox </title>
<link rel="stylesheet" href="{% static 'assets/css/frontend/index1.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'assets/css/frontend/chat.css' %}" type="text/css" />
<div class="all_page page-flex__content header-new-nav is_index">
    <div id="event_list" class="event-list js-event-list"></div>
    <div id="fox_notification_block"></div>
    <input type="hidden"  value="{{chat_words}}" id="chat_words_hidd" />
    <input type="hidden"  value="{{five_chat_words}}" id="five_chat_words_hidd" />
    <input type="hidden"  value="{{session_users}}" id="session_users" />
    <div class="mp-box inbox_perseus">
        <div id="perseus-app" class="inbox_perseus">
           <article class="index inbox_perseus_wrapper" data-testid="index-container">
              <div class="route show-route">
                 <aside class="contacts-container">
                    <header>
                        <div class="search-bar">
                           <span>
                              <button class="button-link filters-toggle link-action"  id="filtered_val" onclick="onclick_filter();" >All Conversations <span class="triangle-down"></span></button>
                              <div class="popover-filters" id="show_all_filters">
                                 <div class="filters-scroll-wrap">
                                    <ul>
                                       <li class="active-filter"><a onclick="filter_click(this);" data-label="active" class="link-action">All Conversations</a></li>
                                       <li ><a onclick="filter_click(this);" data-label="block" class="link-action">Blocked</a></li>
                                       <li><a onclick="filter_click(this);" data-label="unread" class="link-action">Unread</a></li>
                                       <li><a onclick="filter_click(this);" data-label="offers" class="link-action">Custom Offers</a></li>
                                    </ul>
                                 </div>
                              </div>
                           </span>
                        </div>
                     </header>
                     <nav class="contacts-list" data-testid="contacts-list" id="contacts-list">

                     </nav>
                 </aside>


                 <div id="conversation">
                    <header>
                       <div class="upper-row">
                          <div class="user-info">
                             <span class="online-indicator"><i></i></span>
                             <h1><a href="#" class="username" id="data_username" target="_blank" rel="noopener noreferrer"></a></h1>
                          </div>
                          <aside class="actions-menu open">
                             <nav>
                              <button class="button-link  hint--bottom action-delete" data-label="user_id" onclick="data_on_deleteclick(this);" id="data_delete" data- data-hint="Delete" title="Delete">
                                 <i class="fa fa-trash-o" aria-hidden="true"></i>
                              </button>
                              <i class="divider"></i>
                              <button class="button-link  hint--bottom action-delete" data-label="user_id" data-hint="Block" onclick="data_on_blockclick(this);"  id="data_block" title="Block">
                                 <i class="fa fa-ban" aria-hidden="true"></i>
                              </button>
                             </nav>
                          </aside>
                       </div>
                       <small><span id="data_last_seen">Last seen:</span></small><span></span>
                    </header>
                    <div class="conversation-panels">
                       <div class="message-flow">
                          <aside class="butter-toast-tray top-center">
                             <div class="wrapper"></div>
                          </aside>
                          <div class="content" id="message_content">
                           <h2 id="h_previous_mssg"><------------------------------------     <button onclick="loadPrevious_Mssg();">Load Previous Message</button>     ------------------------------------></h2>
                           <div  id="loaded_messages">
                              
                           </div>
                           <div  id="start_message_content">
                              
                           </div>
                          </div>
                          <footer class="conversation-footer">
                             <div class="message-box ">
                                <div class="message-uploader-container ">
                                   <div class="message-container " style="padding: 15px;">
                                      <div class="textarea-container" style="height: 70px; min-height: 0px; max-height: 192px;">
                                       <input type="hidden" value="chat" id= "message_type">
                                       <textarea class="" data-testid="message-box" id="chat_message" maxlength="{{inbox_char}}"></textarea>
                                       <div class="help_div"> <div class="helptext_desc">Message should contain {{inbox_char}} characters minimum.</div> <span class="help_text_span"><i class="fa fa-question-circle" aria-hidden="true"></i></span> </div>
                                       <span class="text-counter" id="span_chat_mssg">0 / {{inbox_char}}</span>
                                       <span class="ruler"> </span></div>
                                   </div>
                                </div>
                                <div class="terms-error" id="message_errors">
                                 <i class="fa fa-exclamation-triangle"></i>
                                 <p>Terms of Service reminder: Providing <span class="detected_mssg"></span> is only allowed if it is needed as part of the service. Otherwise, all communication must go through Letworkbedone.</p>
                              </div>
                                <div class="message-action-bar">
                                   <ul>
                                       <li class="attachmentsdiv">
                                          <label class="ORLWF8p _7pUBXz- co-green-700 attachments-button p-0 YxOH7gm bg-co-white">
                                             <span class="attachment-icon" for="chat_file"></span>
                                             <input  type="file" id="inbox_chat_file"  accept="application/msword, application/vnd.ms-excel, application/vnd.ms-powerpoint,text/plain, application/pdf, image/*" >
                                       </label>
                                       </li>
                                       <li id="create_offer_li">
                                         <div class="W46fKfn +cX12Jm k-kBZXW">
                                            <span class="_5-fo9i5"><button class="FW1syM7 wapdb+q xaFER3a p9qU5Ka co-grey-1000 k-kBZXW" id="btn_create_offer" data-label="" onclick="btn_create_offer_click(this);">Create an Offer</button></span>
                                            <div class="k-kBZXW Gcze-fJ">
                                               <aside class="_77O-JH4 zBHi7jg _7t6M82a _8UHHk5Q TTIjdUR" data-position="top" style="left: -57.4667px; top: -95px; padding-bottom: 8px;">
                                                  <div class="_5KluhlZ Yn90o2E">Create and send your customer a unique offer based on their specific requests.</div>
                                               </aside>
                                            </div>
                                         </div>
                                       </li>
                                   </ul>
                                   <span><span class="send-action"><button class="button-link toggle"><i class="fa fa-chevron-down link-action"></i></button></span><button class="message-action green" id="inbox_chat_mssg_send">Send</button></span>
                                </div>
                                <div class="wrap-box" id="wrap_files_list">
                                 <div class="message-box-cta" id="files_list"> 
                                 </div>
                              </div>
                              <div class="wrap-box" id="wrap_progress_list">
                                 <div class="message-box-cta" id="file_progress_div"> 
                                 </div>
                              </div>
                             </div>
                          </footer>
                       </div>
                       <aside class="details-pane" data-testid="details-pane">
                          <div class="p-t-8 p-16">
                             <div class="pS6OOeY p-t-24 p-b-24" id="orders_with_u">
                                 <div class="flex-between flex-items-baseline tbody-5 text-semi-bold co-text-darker">Orders with you<a class="tbody-6 RQbOZmB" href="" target="_blank" rel="noopener noreferrer" id="order_total_link">Total <span id="order_total"></span></a></div>
                                 <div id="order_card_div"></div>
                             </div>
                             <div class="dUaTNpt p-t-16 p-b-16">
                                <div class="iIlQwX0 flex-items-baseline tbody-5 text-semi-bold co-text-darker m-b-8">About <a id="detail_username" target="_blank" rel="noreferrer noopener"></a></div>
                                <ul class="YDqpr8K jVM84O3 tbody-6">
                                   <li class="-ApdB1q">
                                      <span>From</span>
                                      <strong>
                                         <div class="jl041DV IdkZvd0 GU4H+Y8">
                                            <span class="_67jZFGZ GU4H+Y8">
                                               <div class="text-trunc _8nupQ3Q" data-testid="tooltip-child" delay="120" position="top" boxclassname="YZEZDke hidden" boxcontentclassname="QN8yZbj" contentclassname="GU4H+Y8" style="width: 114.766px;" id="detail_country">India</div>
                                            </span>
                                         </div>
                                      </strong>
                                   </li>
                                   <li class="-ApdB1q"><span>On Fiverr since</span>
                                    <strong>
                                       <div class="jl041DV IdkZvd0 GU4H+Y8">
                                          <span class="_67jZFGZ GU4H+Y8">
                                             <div class="text-trunc _8nupQ3Q" data-testid="tooltip-child" delay="120" position="top" boxclassname="YZEZDke hidden" boxcontentclassname="QN8yZbj" contentclassname="GU4H+Y8" style="width: 114.766px;" id="detail_since">Mar 2022</div>
                                          </span>
                                       </div>
                                    </strong></li>
                                    <li class="-ApdB1q"><span>English</span>
                                       <strong>
                                          <div class="jl041DV IdkZvd0 GU4H+Y8">
                                             <span class="_67jZFGZ GU4H+Y8">
                                                <div class="text-trunc _8nupQ3Q" data-testid="tooltip-child" delay="120" position="top" boxclassname="YZEZDke hidden" boxcontentclassname="QN8yZbj" contentclassname="GU4H+Y8" style="width: 114.766px;" id="detail_english">Fluent</div>
                                             </span>
                                          </div>
                                       </strong></li>
                                </ul>
                                <div class="btn-container YDqpr8K jVM84O3 tbody-6 mt-4">
                                    <label class="switch btn-color-mode-switch">
                                       <input type="checkbox" name="color_mode" id="color_mode" value="1">
                                    <label for="color_mode" data-on="As a seller" data-off="As a buyer" class="btn-color-mode-switch-inner"></label>
                                    </label>
                              </div>
                              <div class="btn-container YDqpr8K jVM84O3 tbody-6 mt-4" id="seller_rating_div">
                                 <ul class="s8IatFi jVM84O3 tbody-6">
                                    <li class="-ApdB1q">
                                       <span>Seller level</span>
                                       <strong>
                                          <div class="W46fKfn k-kBZXW GU4H+Y8">
                                             <span class="_5-fo9i5 GU4H+Y8">
                                                <div class="text-trunc _8nupQ3Q" data-testid="tooltip-child" delay="120" position="top" boxclassname="_8UHHk5Q hidden" boxcontentclassname="Yn90o2E" contentclassname="GU4H+Y8" style="width: 117.5px;" id="detail_seller_level">New Seller</div>
                                             </span>
                                          </div>
                                       </strong>
                                    </li>
                                    <li class="-ApdB1q"><span>Response time</span><strong id="detail_response_time">1h</strong></li>
                                    <li class="-ApdB1q"><span>Rating</span><strong class="Z0-w-cm" id="detail_seller_rating">5.0<small> (<a  target="_blank" rel="noreferrer" id="details_seller_review">93</a>)</small></strong></li>
                                 </ul>
                              </div>
                              <div class="btn-container YDqpr8K jVM84O3 tbody-6  mt-4" id="buyer_rating_div">
                                 <ul class="iKk7Smu jVM84O3 tbody-6">
                                    <li class="-ApdB1q"><span>Rating</span><strong class="Z0-w-cm" id="detail_buyer_rating">4.9</strong></li>
                                 </ul>
                              </div>
                              <input type="hidden"  value="" id="chat_receiver" />
                              <input type="hidden"  value="{{request.user.username}}" id="chat_initiator" />
                              <input type="hidden"  value="{{request.user.username}}" id="chat_conversation_id" />
                              <input type="hidden"  value="" id="total_chat_count" />
                              <input type="hidden"  value="" id="current_count" />
                              <input type="hidden"  value="" id="message_ids" />
                             </div>
                          </div>
                       </aside>
                    </div>
                 </div>

                  <div class="empty-state no-selection" id="empty_conversation">
                     <strong class="font-accent">Pick up where you left off</strong>
                     <small>Select a conversation and chat away.</small>
                  </div>
              </div>
           </article>
        </div>
    </div>
 </div>
{% if request.session.userpage == "buyer" %}
   {% include  'Dashboard/base_buyer.html' %}
{% else %}
   {% include  'Dashboard/base_seller.html' %}
{% endif %}
<div class="modal fade" id="modal_send_offer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-keyboard="false" data-backdrop="static">
   <div class="modal-dialog  modal-lg" role="document">
     <div class="modal-content">
       <div class="modal-header">
         <h4>Select a Gig to Offer</h4>
         <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
       </div>
       <div class="modal-body">
         <div class="row tab1" id="send_offer_div">
            <div class="col-lg-11">
               <div class="popup-content ">
                  <input type="hidden" value="" id= "custom_sender">
                  <input type="hidden" value="" id= "custom_receiver">
                  <input type="hidden" value="" id= "cus_offer_id">
                  <input type="hidden" value="" id= "buyer_request_id">
                  <div id="model_gig_choose">
                     <div class="js-offer-gigs-list">
                        <div class="offer-gigs-list1 antiscroll-wrap1">
                           <ul class="antiscroll-inner scroll-shadow" id="gig_ul_li">
                           </ul>
                        </div>
                     </div>
                  </div>
                  <form id="offer_gig_req_form">
                     <input type="hidden" value="" id= "tbl_row_id">
                     <input type="hidden" value="" id= "tbl_req_id">
                     <input type="hidden" value="" id= "tbl_gig_id">
                  <div class="offer-extras-list conditions js-conditions" id="gig_details">
                     <ul class="antiscroll-inner scroll-shadow">
                        <li class="sel selected-gig">
                           <label class="fake-radio-black radio-text">
                              <p id="sel_gig_title"></p>
                              <span class="gig-pict-74"><img src="" class="" id="sel_gig_img" ></span>
                              <div class="js-personal-message offer-personal-message">
                                 <div class="write-wrap cf">
                                    <textarea name="offer[custom_offer][description]" required maxlength="{{offer_description}}" placeholder="Describe Your Offer" id="text_offer_desc"></textarea>
                                    <span class="char-count rf" id="offer-char-count"><em>0</em> / {{offer_description}} Chars Max</span>
                                    <div class="js-desc-error-text error-text p-t-0 p-b-0 hidden">Please provide a description.</div>
                                 </div>
                              </div>
                           </label>
                        </li> 
                     </ul>
                     <ul>
                        <li>
                           <label>
                              <small class="extra-text">Total Offer Amount</small>
                              <div class="js-price-error-text error-text lf hidden">Define a price between ₹433-₹432401</div>
                           </label>
                           <div class="input-wrap">
                              <small>$</small>
                              <input type="text" name="offer[custom_offer][price]" required class="js-custom-offer-price js-force-digits"  id="text_offer_price" maxlength="5" placeholder="5000 max." value="">
                           </div>
                        </li>
                        <li>
                           <label><small class="extra-text">Delivery Time</small></label>
                           <select name="offer[custom_offer][duration]" class="js-ddown-delivery" id="delivery_time" required>
                              {% for del in delivery_time %}
                                 {% if forloop.first %}
                                    <option value="{{del.parameter_value}}" selected="">{{del.parameter_value}} Days</option>
                                 {% else %}
                                    <option value="{{del.parameter_value}}">{{del.parameter_value}} Days</option>
                                 {% endif %}
                              {% endfor %}
                           </select>
                        </li>
                        <li class="js-revisions">
                           <label><small class="extra-text">Number of Revisions (optional)</small></label>
                           <select name="offer[num_of_revisions]" class="js-ddown-revisions" id="no_revisions" required>
                              <option value="" selected="">Select</option>
                              {% for rev in no_revisions %}
                                    <option value="{{rev.parameter_value}}">{{rev.parameter_value}}</option>
                              {% endfor %}
                           </select>
                        </li>
                        <li class="toggle-li">
                           <div class="toggle-wrapper">
                              <label class="switch" for="req_gig">
                                 <small class="extra-text">Ask for Gig Requirements</small>
                                 <input type="checkbox" name="req_gig" id="req_gig" class="sel">
                                 <span class="slider round"></span>
                              </label>
                           </div>
                        </li>
                     </ul>
                  </div>
                  <div class="js-gig-items offer-gig-items show" id="gig_offer_scopes">
                     <a  class="expander js-gig-items-expander js-gtm-event-auto" data-gtm-category="offers-popup" data-gtm-action="click" data-gtm-label="extras-expander"><p>Define the Offer Scope:</p></a>
                     <div class="offer-extras-list">
                        <ul id="offer_extra_li">

                        </ul>
                     </div>
                     <p class="label-helper">
                        <i class="fa fa-exclamation-circle"></i>
                        The order will start immediately upon payment.<br><span>Make sure you have all of the required information to start working.</span>
                     </p>
                  </div>
                 
                  <footer class="cf p-20 modal_footer">
                     <div class="error-container hidden js-error-container">
                        <p class="msg-error t-a-center">Something went wrong, please try again.</p>
                     </div>
                     <input type="submit" class="btn-standard btn-green-grad js-fiverr-form-submit js-gtm-event-auto" value="Submit Offer"  />
                     <a onclick="gig_back_click();" class="btn-back lf m-t-10 p-r-20 js-btn-back">Back</a>
                  </footer>
                  </form>
               </div>
            </div>
           
       </div>
     </div>
   </div>
 </div>



<script src="{% static 'assets/js/select2.min.js' %}"></script>
<script src="{% static 'assets/js/jquery.flipper-responsive.js' %}"></script>
<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/jquery-emoji-picker@0.2.2/css/jquery.emojipicker.css" />
<script src="https://cdn.jsdelivr.net/npm/jquery-emoji-picker@0.2.2/js/jquery.emojipicker.js"></script>
<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/jquery-emoji-picker@0.2.2/css/jquery.emojipicker.tw.css" />
<script src="https://cdn.jsdelivr.net/npm/jquery-emoji-picker@0.2.2/js/jquery.emojis.js"></script>

<style>
   #h_previous_mssg
   {
      font-size: 10px;
   }
   .contacts-list>.contact .username-container
   {
      text-transform: capitalize;
   }
</style>

<script>

   function formatDate(date) {
      var monthNames =  ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'June', 'July', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'];
      var hours = date.getHours();
      var minutes = date.getMinutes();
      var _date = date.getDate();
      var month = date.getMonth();
      var year = date.getFullYear();
      var d = new Date();
      var curr_year = d.getFullYear();    
      var ampm = hours >= 12 ? 'pm' : 'am';
      hours = hours % 12;
      hours = hours ? hours : 12; // the hour '0' should be '12'
      minutes = minutes < 10 ? '0'+minutes : minutes;
      var strTime = '';
      strTime =  monthNames[month] + " " + _date+ ", " + year ;  
      return strTime;
    }
   
    function formatDate(date) {
      var monthNames =  ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'June', 'July', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'];
      var hours = date.getHours();
      var minutes = date.getMinutes();
      var _date = date.getDate();
      var month = date.getMonth();
      var year = date.getFullYear();
      var d = new Date();
      var curr_year = d.getFullYear();    
      var ampm = hours >= 12 ? 'pm' : 'am';
      hours = hours % 12;
      hours = hours ? hours : 12; // the hour '0' should be '12'
      minutes = minutes < 10 ? '0'+minutes : minutes;
      var strTime = '';
      strTime =  monthNames[month] + " " + _date+ ", " + year ;  
      return strTime;
    }

    const relativeTimePeriods = [
    [31536000, 'year'],
    [2419200, 'month'],
    [604800, 'week'],
    [86400, 'day'],
    [3600, 'hour'],
    [60, 'minute'],
    [1, 'second']
];

function relativeTime(date, isUtc=false) {
    if (!(date instanceof Date)) date = new Date(date * 1000);
    var seconds = (new Date() - date) / 1000;
    seconds = parseInt(seconds) - parseInt(12606);
    for (let [secondsPer, name] of relativeTimePeriods) {
        if (seconds >= secondsPer) {
            const amount = Math.floor(seconds / secondsPer);
            return `${amount} ${name}${amount ? 's' : ''} ago`;
        }
    }
    return 'Just now';
}
   
   function formatAMPM(date) {
      var monthNames =  ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'June', 'July', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'];
      var hours = date.getHours();
      var minutes = date.getMinutes();
      var _date = date.getDate();
      var month = date.getMonth();
      var year = date.getFullYear();
      var d = new Date();
      var curr_year = d.getFullYear();   
      var curr_month = d.getMonth(); 
      var curr_day = d.getDate(); 
      var ampm = hours >= 12 ? 'pm' : 'am';
      hours = hours % 12;
      hours = hours ? hours : 12; // the hour '0' should be '12'
      minutes = minutes < 10 ? '0'+minutes : minutes;
      var strTime = '';
      if(curr_year != year)
      {
         strTime =  monthNames[month] + " " + _date+ ", " + year + hours + ':' + minutes + ' ' + ampm; 
      }
      else if(curr_year == year  && curr_month == month && curr_day == _date )
      {
         strTime = relativeTime(date)
      }
      else{
         strTime = monthNames[month]  + " " + _date+ ", " + hours + ':' + minutes + ' ' + ampm;  
      }   
      return strTime;
   }
   location_path = window.location.origin;
   $(document).ready(function(){
      $(".help_div").hover(function (e) {
         $('.helptext_desc').toggle();
      });
      sessionObj = eval($("#session_users").val());
      setTimeout(function () {
         setInterval(function() {
            refersh_notifications();
         }, 20000); 
      }, 180000);
      $("#show_all_filters").find("ul li a:first").trigger("click");
      jsonObj1 = eval($("#chat_words_hidd").val());
      five_jsonObj1 = eval($("#five_chat_words_hidd").val());
      location_href =  $(location).attr('href').split("/");
      if(location_href[4].length == 0)
      {
         $("#empty_conversation").show();
         $("#conversation").hide();
      }
      else{
         $("#empty_conversation").hide();
         user_conversation_click(location_href[4].trim());
      }
      $(".subnav--new").hide();
      $("#seller_rating_div").hide();
      $("#buyer_rating_div").hide();
      $(".subnav--new").hide();
      $("#color_mode").on("change", function (){
         if($(this).prop("checked") == true){
            $("#seller_rating_div").show();
            $("#buyer_rating_div").hide();
         }
         else{
            $("#seller_rating_div").hide();
            $("#buyer_rating_div").show();
         }
     });
     $('#chat_message').emojiPicker({
         position: 'right'
      });
     $('#chat_message').on('keyup', 'paste', function() {
      setTimeout(function() { 
      var thisChars = this.value.replace(/{.*}/g, '').length; 
      var maxlength = $(this).attr("maxlength");
      messages =  jsonObj1.some(substring=>this.value.includes(substring));
      $("#message_type").val("chat");
      if(messages == true)
      {
         array_string =  five_jsonObj1.join(", ");
         $("#message_errors").show();
         $(".detected_mssg").text(array_string);
      }
      else{
         $("#message_errors").hide();
         $(".detected_mssg").text("");
      }
      if(thisChars > maxlength) 
      {
         var CharsToDel = (thisChars-maxlength); 
         this.value = this.value.substring(0,this.value.length-CharsToDel); 
      }else{
         $("#span_chat_mssg").text( maxlength - thisChars + " /"+maxlength ); 
      }
   }, 500);  
   });
   const get = (selector, root = document) => root.querySelector(selector);
   let attachment;
   
   const roomName = "chat_896";
   const chatSocket = new WebSocket(
     'ws://'
     + window.location.host
     + '/ws/chat/'
     + roomName
     + '/'
   );
   chatSocket.onmessage = e => {
      const data = JSON.parse(e.data);
      $("#chat_message").val("");
      $("#message_type").val("");
      $("#cus_offer_id").val("");
      $("#files_list").empty();
      $("#message_errors").hide();
      var sender_user = $("#chat_initiator").val();
      var receiver_user = $("#chat_receiver").val();
      if(data.attachment.length != 0)
      {
         attachments = data.attachment.trim().split(",");
         attachment_txt = '<div class="attachments-preview-component"><div class="thumbnails-header"><h3>ATTACHMENTS</h3></div><ul class="attchments-container">';
         $.each(attachments, function (key, value) {
            if(value.trim().length != 0)
            {
               file_path = '/media/chat_files/'+value.trim();
               attachment_txt += '<li class="thumbnail-preview" onclick="attachfile_onclick(this);" title="'+value+'" data-label= "'+file_path+'"><a class="thumbnail-link" href="'+file_path+'" target="_blank"><span class="fa fa-file-o fileicon" ></span></a><div class="action-bar flex flex-between"><div class="flex flex-center"><div class="attachment-name-container"><p class="attachment-name" title="'+value+'">...'+value.slice(-20)+'</p></div><span class="attachment-size"></span></div><div class="flex flex-center m-l-8"><a href="'+file_path+'" download class="download-button m-r-8"><span><i class="fa fa-download" aria-hidden="true"></i></span></a></div></div></li>';
            }
         });
         attachment_txt += '</ul></div>';
      }
      else{
         attachment_txt = ''
      }
      contact_list = $("#contacts-list").find(".active-contact");
      if(sender_user == data.sender)
      {
         $(contact_list).find(".last_message").html("<b>Me:</b> "+data.message);
         if(data.message_type == "chat")
         {
            $("#start_message_content").append('<div class="message-wrapper"> <div id="632ead45c2781c000e9ce00f" class="message "> <span class=""> <figure class="profile-image"> <img src="'+data.sender_img+'" alt=""> <figcaption class="font-accent"></figcaption> </figure> </span> <div class="message-content"> <div class="header"> <span class="sender">Me</span><time>'+formatAMPM(new Date(data.time))+'</time> <div></div> </div> <span class=""> <div> <div> <p class="message-body">'+data.message+'</p>'+attachment_txt+' </div> </div> </span> <span class=""></span> </div> </div> </div>');
         }
         else{
            $.ajax({
               type:"GET",
               url: "/get_offer_details/",
               data: {'o_offer_id': data.offer_id},
               success: function(data1) 
               {
                  $("#start_message_content").append('<div class="message-wrapper"> <div id="6374d8a32a883f0001d7f4a3" class="message "> <span class=""> <a href="'+location_path+'/user/profile/'+data.sender+'" target="_blank" rel="noopener noreferrer" class="profile-image-link"> <figure class="profile-image"> <img src="'+data.sender_img+'" alt="b"> <figcaption class="font-accent"></figcaption> </figure> </a> </span> <div class="message-content"> <div class="header"> <a href="'+location_path+'/user/profile/'+data.sender+'" target="_blank" class="sender" rel="noopener noreferrer">Me</a> </div> <span class=""> <div> <p class="title italic"> '+data.message+'</p> <div class="+LNAmyM"> <div class="custom-offer-message-package custom-package-content" data-testid="custom-offer"> <header class="KUW+QwR _3YNlATc"> <div class="flex-center"> <h3 class="text-display-7"><a href="/gigs/'+data1[0].offer_sender+'/'+data1[0].gig_title+'" target="_blank">'+data1[0].gig_title+'</a></h3> </div> <div class="McOrFfb"><b class="GBwyMi1 _0-pU6pf">$ '+data1[0].offer_amount+'</b></div> </header> <div class="main"> <div class="description"> <div> <div class="fg5FMWv" style="height: auto;"> <p class="sanitized-text">'+data1[0].offer_desc+'</p> </div> </div> </div> <div class="package-content"> <h6 class="text-display-7 p-b-8">Your offer includes</h6> <div class="includes"> <div class="package-item flex flex-items-center tbody-default co-text-darker"> <span class="XQskgrQ icon" aria-hidden="true" style="width: 17px; height: 17px; fill: rgb(46, 93, 197);"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M4.50001 11.4999C6.40001 13.3999 9.60001 13.3999 11.5 11.4999C12.2 10.7999 12.7 9.7999 12.9 8.7999L14.9 9.0999C14.7 10.5999 14 11.8999 13 12.8999C10.3 15.5999 5.90001 15.5999 3.10001 12.8999L0.900012 15.0999L0.200012 8.6999L6.60001 9.3999L4.50001 11.4999Z"></path> <path d="M15.8 7.2999L9.40001 6.5999L11.5 4.4999C9.60001 2.5999 6.40001 2.5999 4.50001 4.4999C3.80001 5.1999 3.30001 6.1999 3.10001 7.1999L1.10001 6.8999C1.30001 5.3999 2.00001 4.0999 3.00001 3.0999C4.40001 1.6999 6.10001 1.0999 7.90001 1.0999C9.70001 1.0999 11.5 1.7999 12.8 3.0999L15 0.899902L15.8 7.2999Z"></path> </svg> </span> '+data1[0].offer_revision +'  Revisions </div> <div class="package-item flex flex-items-center tbody-default co-text-darker"> <span class="XQskgrQ icon" aria-hidden="true" style="width: 17px; height: 17px; fill: rgb(46, 93, 197);"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 14c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6z"></path> <path d="M9 4H7v5h5V7H9V4z"></path> </svg> </span> '+data1[0].offer_time+' Days Delivery </div> </div> </div> </div></div> </div> </div> </span> <span class=""></span> </div> </div> </div>');
               }
            });
         }  
      }
      else if(receiver_user.trim() == data.sender.trim())
      {
         $(contact_list).find(".last_message").html(data.message);
         if(data.message_type == "chat")
         {
            $("#start_message_content").append('<div class="message-wrapper"> <div id="632ead45c2781c000e9ce00f" class="message "> <span class=""> <figure class="profile-image"> <img src="'+data.sender_img+'" alt=""> <figcaption class="font-accent"></figcaption> </figure> </span> <div class="message-content"> <div class="header"> <span class="sender">'+data.sender+'</span><time>'+formatAMPM(new Date(data.time))+'</time> <div></div> </div> <span class=""> <div> <div> <p class="message-body">'+data.message+'</p>'+attachment_txt+' </div> </div> </span> <span class=""></span> </div> </div> </div>');
         }
         else{
            $.ajax({
               type:"GET",
               url: "/get_offer_details/",
               data: {'o_offer_id': data.offer_id},
               success: function(data1) 
               {
                  $("#start_message_content").append('<div class="message-wrapper"> <div id="6374d8a32a883f0001d7f4a3" class="message "> <span class=""> <a href="'+location_path+'/user/profile/'+data.sender+'" target="_blank" rel="noopener noreferrer" class="profile-image-link"> <figure class="profile-image"> <img src="'+data.sender_img+'" alt="b"> <figcaption class="font-accent"></figcaption> </figure> </a> </span> <div class="message-content"> <div class="header"> <a href="'+location_path+'/user/profile/'+data.sender+'" target="_blank" class="sender" rel="noopener noreferrer">Me</a> </div> <span class=""> <div> <p class="title italic"> '+data.message+'</p> <div class="+LNAmyM"> <div class="custom-offer-message-package custom-package-content" data-testid="custom-offer"> <header class="KUW+QwR _3YNlATc"> <div class="flex-center"> <h3 class="text-display-7"><a href="/gigs/'+data1[0].offer_sender+'/'+data1[0].gig_title+'" target="_blank">'+data1[0].gig_title+'</a></h3> </div> <div class="McOrFfb"><b class="GBwyMi1 _0-pU6pf">$ '+data1[0].offer_amount+'</b></div> </header> <div class="main"> <div class="description"> <div> <div class="fg5FMWv" style="height: auto;"> <p class="sanitized-text">'+data1[0].offer_desc+'</p> </div> </div> </div> <div class="package-content"> <h6 class="text-display-7 p-b-8">Your offer includes</h6> <div class="includes"> <div class="package-item flex flex-items-center tbody-default co-text-darker"> <span class="XQskgrQ icon" aria-hidden="true" style="width: 17px; height: 17px; fill: rgb(46, 93, 197);"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M4.50001 11.4999C6.40001 13.3999 9.60001 13.3999 11.5 11.4999C12.2 10.7999 12.7 9.7999 12.9 8.7999L14.9 9.0999C14.7 10.5999 14 11.8999 13 12.8999C10.3 15.5999 5.90001 15.5999 3.10001 12.8999L0.900012 15.0999L0.200012 8.6999L6.60001 9.3999L4.50001 11.4999Z"></path> <path d="M15.8 7.2999L9.40001 6.5999L11.5 4.4999C9.60001 2.5999 6.40001 2.5999 4.50001 4.4999C3.80001 5.1999 3.30001 6.1999 3.10001 7.1999L1.10001 6.8999C1.30001 5.3999 2.00001 4.0999 3.00001 3.0999C4.40001 1.6999 6.10001 1.0999 7.90001 1.0999C9.70001 1.0999 11.5 1.7999 12.8 3.0999L15 0.899902L15.8 7.2999Z"></path> </svg> </span> '+data1[0].offer_revision +'  Revisions </div> <div class="package-item flex flex-items-center tbody-default co-text-darker"> <span class="XQskgrQ icon" aria-hidden="true" style="width: 17px; height: 17px; fill: rgb(46, 93, 197);"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 14c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6z"></path> <path d="M9 4H7v5h5V7H9V4z"></path> </svg> </span> '+data1[0].offer_time+' Days Delivery </div> </div> </div> </div> <footer class="custom-package-footer flex flex-items-center"> <div class="package-buttons"><button class="FW1syM7 ZyiRdeA co-grey-1100 action-button tbody-default btn-order-no-thanks offer-decline-button bg-co-grey-300 decline_offer" data-hook="no-thanks" onclick="decline_onclick(this);" data-label="'+data.offer_id+'" >Decline</button><a class="FW1syM7 L1yjt43 co-white action-button bg-co-green-700" data-label="'+data.offer_id+'" target="_blank" href="/payments/0/'+ data.offer_id+'">Accept</a></div> </footer> </div> </div> </div> </span> <span class=""></span> </div> </div> </div>');
               }
            });           
         }  
      }
      $('#message_content').scrollTop($('#message_content')[0].scrollHeight);
   };
   chatSocket.onclose = e => console.error(e);
   $( "#inbox_chat_mssg_send" ).click(function() {
      event.preventDefault();
      if($("#chat_message").val().trim().length  != 0)
      {
         var sender_user = $("#chat_initiator").val();
         var receiver_user = $("#chat_receiver").val();
         let message;
         imgList= '';
         $("#files_list").find('.imagediv').each(function(ev){ 
            imgList = imgList +", "+  $(this).find('.img_file_name').val();
         });
         const msgText = $("#chat_message").val().trim();
         const message_type = $("#message_type").val().trim();
         const offer_id = $("#cus_offer_id").val().trim();
         sender_mssg = '';
         receiver_mssg = '';
         if('{{request.user.username}}' == sender_user)
         {
            sender_mssg = sender_user;
            receiver_mssg = receiver_user;
         }            
         else if('{{request.user.username}}' == receiver_user)
         {
            sender_mssg = receiver_user;
            receiver_mssg = sender_user;
         }
         message = JSON.stringify({
            'message': msgText,
            'recepient': receiver_mssg,
            'sender': sender_mssg,   
            'attachment': imgList,
            'message_type':message_type,
            'offer_id':offer_id,
            'time': Date.now()
         });
         chatSocket.send(message);
      }
      else{
         $(".help_div").removeClass("min_width").addClass("error_help");
         $(".help_div").show();
         $(".help_div").find(".helptext_desc").text('This field is required.').addClass("min_width");
      }
   });
   class FileUpload {
      constructor(input) {
         this.input = input
         this.max_length = 1024 * 1024 * 10;
      }
      create_progress_bar() {
         var progress = `<div class="file-icon">
                           <i class="fa fa-file-o" aria-hidden="true"></i>
                       </div>
                       <div class="file-details">
                           <p class="filename"></p>
                           <div class="progress" style="margin-top: 5px;">
                               <div class="progress-bar bg-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                               </div>
                           </div>
                       </div>`
         document.getElementById('file_progress_div').innerHTML = progress
      }
      upload() {
         this.create_progress_bar();
         this.initFileUpload();
      }
      initFileUpload() {
         this.file = this.input.files[0];
         this.upload_file(0, null);
      }
      upload_file(start, model_id) {
         var end;
         var self = this;
         var existingPath = model_id;
         var formData = new FormData();
         var nextChunk = start + this.max_length + 1;
         var currentChunk = this.file.slice(start, nextChunk);
         var uploadedChunk = start + currentChunk.size
         if (uploadedChunk >= this.file.size) {
            end = 1;
         } else {
            end = 0;
         }
         formData.append('file', currentChunk)
         formData.append('filename', this.file.name)
         $('.filename').text(this.file.name)
         formData.append('end', end)
         formData.append('existingPath', existingPath);
         formData.append('nextSlice', nextChunk);
         $.ajax({
            xhr: function () {
               var xhr = new XMLHttpRequest();
               xhr.upload.addEventListener('progress', function (e) {
               if (e.lengthComputable) {
                  if (self.file.size < self.max_length) {
                     var percent = Math.round((e.loaded / e.total) * 100);
                  } else {
                     var percent = Math.round((uploadedChunk / self.file.size) * 100);
                  }
                  $('.progress-bar').css('width', percent + '%')
                  $('.progress-bar').text(percent + '%')
               }
            });
            return xhr;
         },
         url: '/post_inbox_upload/',
         type: 'POST',
         dataType: 'json',
         cache: false,
         processData: false,
         contentType: false,
         data: formData,
         error: function (xhr) {
            console.log(xhr.statusText);
         },
         success: function (res) {
            console.log(res)
            if (nextChunk < self.file.size) {
               existingPath = res.existingPath
               self.upload_file(nextChunk, existingPath);
               $("#inbox_chat_mssg_send").prop("disabled",true);
            } else {
               $("#file_progress_div").empty();
               var no_of_imgs = $("#files_list").find(".imagediv").length;
               $("#files_list").append('<div class="mssg_img'+(no_of_imgs+1)+' imagediv" id="mssg_img'+(no_of_imgs+1)+'"><input type="hidden" value="'+res.existingPath+'" class="img_file_name"> <span class= "fa fa-file-o fileicon"><i class="fa fa-trash" onclick="post_img_message_delete(this);" data-label="mssg_img'+(no_of_imgs+1)+' "></i></span><span class="file_name">...'+res.existingPath.slice(-20)+'</span></div>');
               $("#inbox_chat_mssg_send").prop("disabled",false);
            }
         }
      });
   };
}

   $("#inbox_chat_file").change(function() {
      var uploader = new FileUpload(document.querySelector('#inbox_chat_file'));
      uploader.upload();
   });
   $('#text_offer_desc').on('keyup', 'paste', function() {
      setTimeout(function() {  
      var thisChars = this.value.replace(/{.*}/g, '').length; 
      var maxlength = $(this).attr("maxlength");
      if(thisChars > maxlength) 
      {
         var CharsToDel = (thisChars-maxlength); 
         this.value = this.value.substring(0,this.value.length-CharsToDel); 
      }else{
         $("#offer-char-count").text( maxlength - thisChars + " /"+maxlength  +" Chars Max" ); 
      }
   }, 500);
   });

   $("#offer_gig_req_form").submit(function(e)
   {
       e.preventDefault();
       o_gig_id =  $("#tbl_gig_id").val();
       o_b_req_id =  $("#tbl_req_id").val();
       o_buyer_req_id =  $("#buyer_request_id").val();
       o_user_id = '{{request.user.id}}'
       o_text_desc = $("#text_offer_desc").val();
       o_text_price = $("#text_offer_price").val();
       o_text_del_time = $("#delivery_time").val();
       o_text_no_revs = $("#no_revisions").val();
       o_text_req_gig = $("#req_gig").val();
       o_chat_initiator = $("#custom_sender").val();
       o_chat_receiver = $("#custom_receiver").val();
       o_text_req_gig = '';
       if($("#req_gig").is(':checked')){
         o_text_req_gig = "true";
      } else {
         o_text_req_gig = "false";
      }
      o_extra_params = []
      $("#offer_extra_li li").each(function (i, vt) {
         if($(vt).find("input[type='checkbox']").is(':checked')){
            if($(vt).attr("data-type")== "input")
            {
               o_extra_params.push({"name":$(vt).find(".extra-text").text(), "value":$(vt).find(".js-extra-quantity").val()});
            }
            else
            {
               o_extra_params.push({"name":$(vt).find(".extra-text").text(), "value":"true"});
            }
         }
      });
      $.ajax({
         type:"POST",
         url: "/post_custom_offer_details/",
         data: {'o_gig_id': o_gig_id,'o_b_req_id': o_b_req_id,"o_user_id":o_user_id,"o_text_desc":o_text_desc,"o_text_price":o_text_price,"o_text_del_time":o_text_del_time,"o_text_no_revs":o_text_no_revs,"o_text_req_gig":o_text_req_gig,"o_offer_type":"custom","o_extra_params":JSON.stringify( o_extra_params ),"offer_sender":o_chat_initiator,"offer_receiver":o_chat_receiver,"o_buyer_req_id":o_buyer_req_id},
         success: function(data) 
         {  
            $("#chat_message").val("Here's your Custom Offer");
            $("#message_type").val("offer");
            $("#cus_offer_id").val(data);
            $("#inbox_chat_mssg_send").trigger('click');
            $("#modal_send_offer").modal("hide");
         }
      });
   });

   });
   function onclick_filter()
   {
      $("#show_all_filters").toggle(800);
   }
   function data_on_deleteclick(ev)
   {
      $.ajax({
         type:"GET",
         url: "/post_conv_delete/",
         data: {"conver_id":$(ev).attr("data-label")},
         success: function(data)
         {

         }
      });
   }
   function data_on_blockclick(ev)
   {
      $.ajax({
         type:"GET",
         url: "/post_conv_block/",
         data: {"conver_id":$(ev).attr("data-label")},
         success: function(data)
         {

         }
      });
   }
   function post_img_message_delete(ev)
   {
      div_id = $(ev).attr("data-label");
      $("#files_list").find("#" +div_id).remove();
   }
   function btn_create_offer_click(ev)
   {
      username = '{{request.user.username}}';
      $.ajax({
         type:"GET",
         url: "/get_modal_show_gig_details/",
         data: {"username":username},
         success: function(data)
         {
            jsonObject = JSON.parse(data);
            $("#model_gig_choose").show();
            $("#gig_details").hide();
            $("#gig_offer_scopes").hide();
            $(".modal_footer").hide();
            $("#gig_ul_li").empty();
            $.each(jsonObject.user_gig_details, function(i, vvv2) {
               $("#gig_ul_li").append('<li class="sel"> <label class="fake-radio-black radio-text"> <input type="radio" name="offer[gig_id]" onclick="gig_onclick(this);" class="js-offered-gig" value="'+vvv2.gig_id+'" data-label="'+vvv2.gig_image+'" data-title="'+vvv2.gig_title+'"> <span class="gig-pict-74"><img src="'+vvv2.gig_image+'" class="" alt="'+vvv2.gig_title+'" data-reload="inprogress"></span> <p>'+vvv2.gig_title+'</p> </label> </li>');
            });
            $("#custom_sender").val($("#chat_initiator").val());
            $("#custom_receiver").val($("#chat_receiver").val());
            $("#buyer_request_id").val('0');
            $("#modal_send_offer").modal("show");
         }
      });
   }
   function decline_onclick(ev)
   {
      offer_id = $(ev).attr("data-label");
      $.ajax({
         type:"GET",
         url: "/post_decline_offer/",
         data: {"o_offer_id":offer_id},
         success: function(data)
         {
            if(data == "sucess")
            {
               $(ev).parent().html('<button class="FW1syM7 ZyiRdeA co-grey-1100 action-button tbody-default btn-order-no-thanks offer-decline-button bg-co-grey-300 decline_offer" data-hook="no-thanks">Offer Declined</button> ')
            }
         }
      });
   }
   function create_offer(ev)
   {
      request_id = $(ev).attr("data-label");
      username = $(ev).attr("data-username");
      $.ajax({
         type:"GET",
         url: "/get_modal_show_gig_details/",
         data: {"username":username},
         success: function(data)
         {
            jsonObject = JSON.parse(data);
            $("#model_gig_choose").show();
            $("#gig_details").hide();
            $("#gig_offer_scopes").hide();
            $(".modal_footer").hide();
            $("#gig_ul_li").empty();
            $.each(jsonObject.user_gig_details, function(i, vvv2) {
               $("#gig_ul_li").append('<li class="sel"> <label class="fake-radio-black radio-text"> <input type="radio" name="offer[gig_id]" onclick="gig_onclick(this);" class="js-offered-gig" value="'+vvv2.gig_id+'" data-label="'+vvv2.gig_image+'" data-title="'+vvv2.gig_title+'"> <span class="gig-pict-74"><img src="'+vvv2.gig_image+'" class="" alt="'+vvv2.gig_title+'" data-reload="inprogress"></span> <p>'+vvv2.gig_title+'</p> </label> </li>');
            });
            $("#custom_sender").val($("#chat_initiator").val());
            $("#custom_receiver").val($("#chat_receiver").val());
            $("#buyer_request_id").val(request_id);
            $("#modal_send_offer").modal("show");
         }
      });
   }


   function gig_onclick(ev)
   {
     gig_id = $(ev).val();
     $.ajax({
        type:"GET",
        url: "/get_gig_parameters/",
        data: {'gig_id': gig_id, "user_id":'{{request.user.id}}'},
        success: function(data)
        {
           var intRegex = /^\d+$/;
           img_url = $(ev).attr("data-label");
           gig_title = $(ev).attr("data-title");
           $("#sel_gig_title").text(gig_title);
           $("#sel_gig_img").attr("src",img_url);
           jsonObject = JSON.parse(data);
           json_parse1 =  eval(jsonObject[0]["data"]);
           $("#offer_extra_li").empty();
           $.each(json_parse1, function(i, v5) {
              if(intRegex.test(v5.value.toString()))
              {
                 $("#offer_extra_li").append('<li class="js-extra-chkbox" data-type="input"> <label class="fake-check-black check-text"> <input type="checkbox" > <span class="chk-img"></span> <span class="extra-text"> <small>'+v5.name+'</small> </span> <input type="number" class="js-extra-quantity"  value="0"> </label> </li>');
              }
              else{
                 $("#offer_extra_li").append(' <li class="js-extra-chkbox" data-type="boolean"> <label class="fake-check-black check-text"> <input type="checkbox" > <span class="chk-img"></span> <span class="extra-text"> <small>'+v5.name+'</small> </span> </label> </li>')
              }
           });
           $("#model_gig_choose").hide();
           $("#gig_details").show();
           $("#gig_offer_scopes").show();
           $(".modal_footer").show();
           $("#text_offer_desc").val("");
           $("#tbl_gig_id").val(gig_id);
           $("#text_offer_price").val("");
           $("#delivery_time").prop("selectedIndex", 0);
           $("#no_revisions").val("");
           $('#req_gig').prop('checked', true);
        }
     });
   }
   function gig_back_click()
   {
     $("#model_gig_choose").show();
     $("#gig_details").hide();
     $("#gig_offer_scopes").hide();
     $(".modal_footer").hide();
   }
   function filter_click(ev)
   {
      data_label = $(ev).attr("data-label");
      $("#show_all_filters").find("ul li").removeClass("active-filter");
      $(ev).parent().addClass("active-filter");
      $("#filtered_val").html($(ev).text() + '<span class="triangle-down"></span>');
      $("#show_all_filters").hide(200);
      $.ajax({
         type:"GET",
         url: "/get_all_contacts/",
         data: {"category":data_label,"username":"{{request.user.username}}"},
         success: function(data) 
         {  
            $("#contacts-list").empty();
            $.each(data, function(i, vvv) {
               last_message_txt = ''
               notification_txt = ''
               time_txt = ''
               var user_list = sessionObj.filter(function (item) {
                  return item.name == vvv.user_Name;
               });
               indicator = '';
               if(user_list.length != 0)
               {
                  indicator = "green"
               }
               if(vvv.last_message_str.trim().length >= 0)
               {
                  if('{{request.user.username}}' == vvv.last_message_sender)
                  {
                     last_message_txt = "<b>Me:</b> "+  vvv.last_message_str.trim();
                  }
                  else{
                     last_message_txt = vvv.last_message_str.toString().trim();
                  }
               }
               if(parseInt(vvv.unread_count) > 0)
               {
                  notification_txt = '<span class="unread-count">'+parseInt(vvv.unread_count)+'</span>'
               }
               $("#contacts-list").append('<a class="contact read" data-label="'+ vvv.user_Name +'" onclick="user_conversation_click(this)"> <span class="image-container"> <figure class="profile-image"> <img src="'+ vvv.user_imag +'" alt="a"> </figure> <span class="online-indicator '+indicator+'"><i></i></span> </span> <div class="user-info"> <div class="username-container"><strong> '+ vvv.user_Name +' </strong></div> <p class="text-trunc"><i class=""></i> <span class="last_message">' + last_message_txt +' </span> </p> </div> <aside> <div> <time >'+vvv.last_message_time.trim()+'</time> <span class="notif_div">'+notification_txt+'</span></div> <div>  </div> </aside></a>');
            }); 
         }
      });
   }

   function user_conversation_click(username)
   {
      if (typeof username == 'string') {
         username = username.replace(/\?/g, '');
      }
      else{
         username = $(username).attr("data-label");
      }
      var user_list = sessionObj.filter(function (item) {
         return item.name == username.replace(/\?/g, '');
      });
      indicator = '';
      if(user_list.length != 0)
      {
         indicator = "green"
      }
      location_href =  $(location).attr('href').split("/");
      pathname = window.location.pathname.split('/');
      var currentURL = window.location.protocol + "//" + window.location.host + "/" + pathname[1] + '/?' +username.replace(/\?/g, '');  
      window.history.pushState({ path: currentURL }, '', currentURL);
      $.ajax({
         type:"GET",
         url: "/get_conv_user_details/",
         data: {'receiver_user': username.replace(/\?/g, ''),'initiator_user': '{{request.user.username}}',"current_count":10,"id_list":"start"},
         success: function(data)
         {
            if(parseInt(data.initiator_gigs) == 0)
            {
               $("#create_offer_li").hide();
            }
            else{
               $("#create_offer_li").show();
            }
            if(parseInt(data.total_count) < 10)
            {
               $("#h_previous_mssg").hide();
            }
            else{
               $("#h_previous_mssg").show();
            }
            $("#total_chat_count").val(data.total_count);
            $("#current_count").val(data.current_count);
            $("#message_ids").val(data.message_ids);
            array_list = $("#message_ids").val().split(",");
            $("#contacts-list").find("a").removeClass("active-contact");
            parentdiv =  $("#contacts-list").find("a[data-label='"+username.replace(/\?/g, '')+"']");
            $(parentdiv).find(".unread-count").remove();
            $("#contacts-list").find("a[data-label='"+username.replace(/\?/g, '')+"']").addClass("active-contact");
            $("#data_delete").attr("data-label",data.conversation_id);
            $("#data_block").attr("data-label",data.conversation_id);
            $("#btn_create_offer").attr("data-label",data.response_userDetails[0]['username']);
            $("#chat_receiver").val(data.response_userDetails[0]['username']);
            $("#data_username").text(data.response_userDetails[0]['username']);
            $("#data_last_seen").text("have to calculate");
            $("#detail_country").text(data.response_userDetails[0]['user_location']);
            $("#detail_since").text(data.response_userDetails[0]['user_start']);
            $("#detail_english").text(data.response_userDetails[0]['user_english']);
            $("#detail_seller_level").text(data.response_userDetails[0]['seller_level']);
            $("#detail_response_time").text(data.response_userDetails[0]['response_time']);
            $("#detail_seller_rating").html(data.response_userDetails[0]['seller_rating'] + '<small> (<a id="details_seller_review" href="'+location_path+'/user/profile/' + data.response_userDetails[0]['username']+'" target="_blank" rel="noreferrer">'+data.response_userDetails[0]['seller_reviews']+'</a>)</small>');
            $("#detail_buyer_rating").html(data.response_userDetails[0]['buyer_rating'] + '<small> (<a id="details_buyer_review" href="'+location_path+'/user/profile/' + data.response_userDetails[0]['username']+'" target="_blank" rel="noreferrer">'+data.response_userDetails[0]['buyer_reviews']+'</a>)</small>');
            $("#data_username").attr("href", location_path + "/user/profile/" + data.response_userDetails[0]['username']);
            $("#detail_username").text(data.response_userDetails[0]['username']);
            $("#detail_username").attr("href",location_path +  "/user/profile/" + data.response_userDetails[0]['username']);
            $("#details_buyer_review").text();
            $("#details_buyer_review").attr("href",location_path + "/user/profile/" + data.response_userDetails[0]['username']);
            $("#empty_conversation").hide();
            $("#conversation").show();
            $("#color_mode").prop("checked",false).trigger("change");
            $("#order_total").text(data.no_of_orders);
            $("#chat_conversation_id").val(data.conversation_id);
            $("#order_card_div").empty();
            if(data.order_details.length >0)
            {
               $("#orders_with_u").show();
               $.each(data.order_details, function(i, v) {
                  $("#order_card_div").append(' <div class="CfL5AJd tbody-6 m-t-12" role="order-card"> <div class="xflEYMx cf"> <img class="Ts1SPzc m-r-8" src="'+v.gig_img+'" alt="'+v.gig_title+'" id="order_gig_title"> <div class="text-semi-bold co-text-darker order_amount" role="amount" id="order_amount">$ '+v.order_amount+'</div> <div class="TNCPqsk"> <div class="W46fKfn k-kBZXW GU4H+Y8"> <span class="_5-fo9i5 GU4H+Y8"> <div class="text-trunc _8nupQ3Q tbody-6 order_date" data-testid="tooltip-child" delay="120" position="top" boxclassname="_8UHHk5Q hidden" boxcontentclassname="Yn90o2E" contentclassname="GU4H+Y8" id="order_due_date" >Due '+v.order_due_date+'</div> </span> </div> </div> </div> <div class="flex-between flex-items-center p-t-8"><a class="xe5S0vU tbody-6" role="order-link" href="'+location_path+'/user/'+data.response_userDetails[0]['username']+'/manage_orders/'+v.order_no+'/activities" target="_blank" rel="noopener noreferrer" id="see_order_link">See order</a><span class="order-status-badge in_revision" id="order_status">'+v.order_status.trim().toString().toUpperCase()+'</span></div> </div>');
               });
            }
            else{
               $("#orders_with_u").hide();
            }
            $("#conversation").find(".online-indicator").addClass(indicator);
            if(data.curre_User == "Buyer")
            {
               $("#order_total_link").attr("href","/manage_orders");
            }
            else{
               $("#order_total_link").attr("href", location_path + "/user/" + data.response_userDetails[0]['username'] + "/manage_orders");
            }
            $("#message_errors").hide();
            $("#start_message_content").empty();
            $.each(data.data_messages, function(j, vv) {
               array_list = jQuery.grep(array_list, function(value) {
                  return value !=  vv.mssg_id;
               });
               if(vv.attachment != "None" && vv.res_type == null)
               {
                  attachments = vv.attachment.trim().split(",");
                  attachment_txt = '<div class="attachments-preview-component"><div class="thumbnails-header"><h3>ATTACHMENTS</h3></div><ul class="attchments-container">';
                  $.each(attachments, function (key, value) {
                     if(value.trim().length != 0)
                     {
                        file_path = '/media/chat_files/'+value.trim();
                        attachment_txt += '<li class="thumbnail-preview" onclick="attachfile_onclick(this);" title="'+value+'" data-label= "'+file_path+'"><a class="thumbnail-link" href="'+file_path+'" target="_blank"><span class="fa fa-file-o fileicon" ></span></a><div class="action-bar flex flex-between"><div class="flex flex-center"><div class="attachment-name-container"><p class="attachment-name" title="'+value+'">...'+value.slice(-20)+'</p></div><span class="attachment-size"></span></div><div class="flex flex-center m-l-8"><a href="'+file_path+'" download class="download-button m-r-8"><span><i class="fa fa-download" aria-hidden="true"></i></span></a></div></div></li>';
                     }
                  });
                  attachment_txt += '</ul></div>';
                  if('{{request.user.username}}' == vv.sender_username)
                  {
                     $("#start_message_content").append('<div class="message-wrapper"> <div id="632ead45c2781c000e9ce00f" class="message "> <span class=""> <figure class="profile-image"> <img src="'+vv.sender_img+'" alt=""> <figcaption class="font-accent"></figcaption> </figure> </span> <div class="message-content"> <div class="header"> <span class="sender">Me</span><time>'+formatAMPM(new Date(vv.timestamp))+'</time> <div></div> </div> <span class=""> <div> <div> <p class="message-body">'+vv.message+'</p>'+attachment_txt+' </div> </div> </span> <span class=""></span> </div> </div> </div>');
                  }
                  else{
                     $("#start_message_content").append('<div class="message-wrapper"> <div id="632ead45c2781c000e9ce00f" class="message "> <span class=""> <figure class="profile-image"> <img src="'+vv.sender_img+'" alt=""> <figcaption class="font-accent"></figcaption> </figure> </span> <div class="message-content"> <div class="header"> <span class="sender">'+vv.sender_username+'</span><time>'+formatAMPM(new Date(vv.timestamp))+'</time> <div></div> </div> <span class=""> <div> <div> <p class="message-body">'+vv.message+'</p>'+attachment_txt+' </div> </div> </span> <span class=""></span> </div> </div> </div>');
                  }
               }
               else{
                  if(vv.mssg_type != "chat")
                  {
                     if('{{request.user.username}}' == vv.sender_username)
                     {
                        if(vv.mssg_type == "offer")
                        {
                           btn_offer_txt = ''
                           if(vv.offer_status == "ordered")
                           {
                              btn_offer_txt = '<footer class="custom-package-footer flex flex-items-center"> <div class="package-buttons"><a class="FW1syM7 ZyiRdeA co-grey-1100 action-button tbody-default btn-order-no-thanks offer-decline-button bg-co-grey-300 decline_offer" data-hook="no-thanks" href="'+location_path+'/user/{{request.user.username}}/manage_orders/'+vv.order_no+'/activities" >View Order</a> </div> </footer>'
                           }
                           $("#start_message_content").append('<div class="message-wrapper"> <div id="6374d8a32a883f0001d7f4a3" class="message "> <span class=""> <a href="'+location_path+'/user/profile/'+vv.sender_username+'" target="_blank" rel="noopener noreferrer" class="profile-image-link"> <figure class="profile-image"> <img src="'+vv.sender_img+'" alt="b"> <figcaption class="font-accent"></figcaption> </figure> </a> </span> <div class="message-content"> <div class="header"> <a href="'+location_path+'/user/profile/'+vv.sender_username+'" target="_blank" class="sender" rel="noopener noreferrer">Me</a> </div> <span class=""> <div> <p class="title italic"> '+vv.message+'</p> <div class="+LNAmyM"> <div class="custom-offer-message-package custom-package-content" data-testid="custom-offer"> <header class="KUW+QwR _3YNlATc"> <div class="flex-center"> <h3 class="text-display-7"><a href="/gigs/'+vv.offer_sender+'/'+vv.gig_title+'" target="_blank">'+vv.gig_title+'</a></h3> </div> <div class="McOrFfb"><b class="GBwyMi1 _0-pU6pf">$ '+vv.offer_amount+'</b></div> </header> <div class="main"> <div class="description"> <div> <div class="fg5FMWv" style="height: auto;"> <p class="sanitized-text">'+vv.offer_desc+'</p> </div> </div> </div> <div class="package-content"> <h6 class="text-display-7 p-b-8">Your offer includes</h6> <div class="includes"> <div class="package-item flex flex-items-center tbody-default co-text-darker"> <span class="XQskgrQ icon" aria-hidden="true" style="width: 17px; height: 17px; fill: rgb(46, 93, 197);"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M4.50001 11.4999C6.40001 13.3999 9.60001 13.3999 11.5 11.4999C12.2 10.7999 12.7 9.7999 12.9 8.7999L14.9 9.0999C14.7 10.5999 14 11.8999 13 12.8999C10.3 15.5999 5.90001 15.5999 3.10001 12.8999L0.900012 15.0999L0.200012 8.6999L6.60001 9.3999L4.50001 11.4999Z"></path> <path d="M15.8 7.2999L9.40001 6.5999L11.5 4.4999C9.60001 2.5999 6.40001 2.5999 4.50001 4.4999C3.80001 5.1999 3.30001 6.1999 3.10001 7.1999L1.10001 6.8999C1.30001 5.3999 2.00001 4.0999 3.00001 3.0999C4.40001 1.6999 6.10001 1.0999 7.90001 1.0999C9.70001 1.0999 11.5 1.7999 12.8 3.0999L15 0.899902L15.8 7.2999Z"></path> </svg> </span> '+vv.offer_revision +'  Revisions </div> <div class="package-item flex flex-items-center tbody-default co-text-darker"> <span class="XQskgrQ icon" aria-hidden="true" style="width: 17px; height: 17px; fill: rgb(46, 93, 197);"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 14c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6z"></path> <path d="M9 4H7v5h5V7H9V4z"></path> </svg> </span> '+vv.offer_time+' Days Delivery </div> </div> </div> </div> '+ btn_offer_txt +' </div> </div> </div> </span> <span class=""></span> </div> </div> </div>'); 
                        }
                        else if(vv.mssg_type == "quote")
                        {
                           $("#start_message_content").append(' <div class="message-wrapper"> <div id="6374c7ccc293320014d546e0" class="message "> <span class=""> <figure class="profile-image"> <img src="'+vv.sender_img+'" > <figcaption class="font-accent">S</figcaption> </figure> </span> <div class="message-content"> <div class="header"> <span class="sender">Me</span><time >'+formatAMPM(new Date(vv.timestamp))+'</time> <div></div> </div> <span class=""> <div> <p class="tbody-6">'+vv.message+'</p> <div class="_4aalYpY tbody-6" data-testid="brief-entry"> <article> <div class="W6rA1Yv" data-testid="brief-body"> <ul class="SJvuSVq"> <li class="BhSqh3g flex flex-between"> <b class="vtb+Dcs">Specification</b> <div class="ryQqgSG"> <section> <div class="GQtv-8L"> <div class="flex flex-center m-r-4"> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="#2E5DC5"> <path clip-rule="evenodd" fill-rule="evenodd" d="M4.421 2.415c-.945.43-1.171.87-1.171 1.085 0 .215.226.655 1.171 1.085.878.399 2.142.665 3.579.665 1.437 0 2.701-.266 3.579-.665.945-.43 1.171-.87 1.171-1.085 0-.215-.226-.655-1.171-1.085C10.7 2.016 9.437 1.75 8 1.75c-1.437 0-2.701.266-3.579.665zm-.62-1.366C4.914.543 6.399.25 8 .25c1.6 0 3.086.293 4.2.8 1.045.475 2.05 1.285 2.05 2.45 0 .73-.394 1.32-.944 1.775A.75.75 0 0 1 14.25 6v.5c0 .73-.393 1.32-.944 1.775A.75.75 0 0 1 14.25 9v.5c0 .73-.393 1.32-.944 1.775a.749.749 0 0 1 .944.725v.5c0 1.165-1.005 1.975-2.05 2.45-1.114.507-2.6.8-4.2.8s-3.086-.293-4.2-.8c-1.045-.475-2.05-1.285-2.05-2.45V12a.75.75 0 0 1 .944-.725c-.55-.456-.944-1.046-.944-1.775V9a.75.75 0 0 1 .944-.725C2.144 7.82 1.75 7.23 1.75 6.5V6a.75.75 0 0 1 .945-.725C2.144 4.82 1.75 4.23 1.75 3.5c0-1.165 1.005-1.975 2.05-2.45zm-.674 4.54A.74.74 0 0 1 3.25 6v.5c0 .216.226.656 1.171 1.085.877.399 2.142.665 3.579.665 1.437 0 2.702-.266 3.579-.665.945-.43 1.171-.87 1.171-1.085V6c0-.152.045-.294.123-.412a5.504 5.504 0 0 1-.674.363c-1.113.506-2.598.799-4.199.799-1.6 0-3.086-.293-4.2-.8a5.512 5.512 0 0 1-.673-.362zm0 3c.078.118.123.26.123.411v.5c0 .216.226.656 1.171 1.085.877.399 2.142.665 3.579.665 1.437 0 2.702-.266 3.579-.665.945-.43 1.171-.87 1.171-1.085V9c0-.152.045-.293.123-.411a5.51 5.51 0 0 1-.673.362c-1.114.506-2.6.799-4.2.799s-3.086-.293-4.2-.8a5.511 5.511 0 0 1-.673-.361zm0 3c.078.118.123.26.123.411v.5c0 .216.226.656 1.171 1.085.877.399 2.142.665 3.579.665 1.437 0 2.702-.266 3.579-.665.945-.43 1.171-.87 1.171-1.085V12c0-.152.045-.293.123-.411a5.517 5.517 0 0 1-.673.362c-1.114.506-2.6.799-4.2.799s-3.086-.293-4.2-.8a5.517 5.517 0 0 1-.673-.361z"></path> </svg> </div> <div> <p>Budget $ '+vv.req_budget+'</p> </div> </div> <div class="GQtv-8L"> <div class="flex flex-center m-r-4"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="#2E5DC5"> <path d="M8 .25A7.749 7.749 0 0 0 .25 8 7.749 7.749 0 0 0 8 15.75 7.749 7.749 0 0 0 15.75 8 7.749 7.749 0 0 0 8 .25Zm0 14A6.248 6.248 0 0 1 1.75 8 6.248 6.248 0 0 1 8 1.75 6.248 6.248 0 0 1 14.25 8 6.248 6.248 0 0 1 8 14.25Zm1.931-3.262L7.278 9.059a.377.377 0 0 1-.153-.303V3.625c0-.206.169-.375.375-.375h1c.206 0 .375.169.375.375v4.428l2.088 1.519a.375.375 0 0 1 .08.525l-.587.81a.378.378 0 0 1-.525.08Z"></path> </svg> </div> <div> <p>'+vv.req_time+' delivery ('+vv.req_due_date+')</p> </div> </div> </section> </div> </li> <li class="BhSqh3g flex flex-between"> <b class="vtb+Dcs">Criteria</b> <div class="ryQqgSG"></div> </li> </ul> <p class="p-t-12">'+vv.req_desc+'</p> </div> </article> </div> </div> </span> <span class=""></span> </div> </div> </div>');
                        }
                     }
                     else{
                        if(vv.mssg_type == "offer")
                        {
                           if(vv.offer_status == "ordered")
                           {
                              btn_offer_txt = '<footer class="custom-package-footer flex flex-items-center"> <div class="package-buttons"><a class="FW1syM7 ZyiRdeA co-grey-1100 action-button tbody-default btn-order-no-thanks offer-decline-button bg-co-grey-300 decline_offer" data-hook="no-thanks" href="'+location_path+'/user/{{request.user.username}}/manage_orders/'+vv.order_no+'/activities" >View Order</a> </div> </footer>'
                           }
                           else if(vv.offer_status == "deleted")
                           {
                              btn_offer_txt = '<footer class="custom-package-footer flex flex-items-center"> <div class="package-buttons"><button class="FW1syM7 ZyiRdeA co-grey-1100 action-button tbody-default btn-order-no-thanks offer-decline-button bg-co-grey-300 decline_offer" data-hook="no-thanks">Offer Declined</button> </div> </footer>'
                           }
                           else if(vv.offer_status == "active")
                           {
                              btn_offer_txt = '<footer class="custom-package-footer flex flex-items-center"> <div class="package-buttons"><button class="FW1syM7 ZyiRdeA co-grey-1100 action-button tbody-default btn-order-no-thanks offer-decline-button bg-co-grey-300 decline_offer" data-hook="no-thanks" onclick="decline_onclick(this);" data-label="'+vv.offer_id+'" >Decline</button><a class="FW1syM7 L1yjt43 co-white action-button bg-co-green-700" data-label="'+vv.offer_id+'" target="_blank" href="/payments/0/'+ vv.offer_id+'">Accept</a></div> </footer>'
                           }                           
                           $("#start_message_content").append('<div class="message-wrapper"> <div id="6374d8a32a883f0001d7f4a3" class="message "> <span class=""> <a href="'+location_path+'/user/profile/'+vv.sender_username+'" target="_blank" rel="noopener noreferrer" class="profile-image-link"> <figure class="profile-image"> <img src="'+vv.sender_img+'" alt="b"> <figcaption class="font-accent"></figcaption> </figure> </a> </span> <div class="message-content"> <div class="header"> <a href="'+location_path+'/user/profile/'+vv.sender_username+'" target="_blank" class="sender" rel="noopener noreferrer">Me</a> </div> <span class=""> <div> <p class="title italic"> '+vv.message+'</p> <div class="+LNAmyM"> <div class="custom-offer-message-package custom-package-content" data-testid="custom-offer"> <header class="KUW+QwR _3YNlATc"> <div class="flex-center"> <h3 class="text-display-7"><a href="/gigs/'+vv.offer_sender+'/'+vv.gig_title+'" target="_blank">'+vv.gig_title+'</a></h3> </div> <div class="McOrFfb"><b class="GBwyMi1 _0-pU6pf">$ '+vv.offer_amount+'</b></div> </header> <div class="main"> <div class="description"> <div> <div class="fg5FMWv" style="height: auto;"> <p class="sanitized-text">'+vv.offer_desc+'</p> </div> </div> </div> <div class="package-content"> <h6 class="text-display-7 p-b-8">Your offer includes</h6> <div class="includes"> <div class="package-item flex flex-items-center tbody-default co-text-darker"> <span class="XQskgrQ icon" aria-hidden="true" style="width: 17px; height: 17px; fill: rgb(46, 93, 197);"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M4.50001 11.4999C6.40001 13.3999 9.60001 13.3999 11.5 11.4999C12.2 10.7999 12.7 9.7999 12.9 8.7999L14.9 9.0999C14.7 10.5999 14 11.8999 13 12.8999C10.3 15.5999 5.90001 15.5999 3.10001 12.8999L0.900012 15.0999L0.200012 8.6999L6.60001 9.3999L4.50001 11.4999Z"></path> <path d="M15.8 7.2999L9.40001 6.5999L11.5 4.4999C9.60001 2.5999 6.40001 2.5999 4.50001 4.4999C3.80001 5.1999 3.30001 6.1999 3.10001 7.1999L1.10001 6.8999C1.30001 5.3999 2.00001 4.0999 3.00001 3.0999C4.40001 1.6999 6.10001 1.0999 7.90001 1.0999C9.70001 1.0999 11.5 1.7999 12.8 3.0999L15 0.899902L15.8 7.2999Z"></path> </svg> </span> '+vv.offer_revision +'  Revisions </div> <div class="package-item flex flex-items-center tbody-default co-text-darker"> <span class="XQskgrQ icon" aria-hidden="true" style="width: 17px; height: 17px; fill: rgb(46, 93, 197);"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 14c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6z"></path> <path d="M9 4H7v5h5V7H9V4z"></path> </svg> </span> '+vv.offer_time+' Days Delivery </div> </div> </div> </div> '+ btn_offer_txt +'</div> </div> </div> </span> <span class=""></span> </div> </div> </div>'); 
                        }
                        else if(vv.mssg_type == "quote")
                        {
                           btn_quote_txt = '';
                           if(vv.offer_created_sta == "created")
                           {
                              btn_quote_txt = '<footer class="custom-package-footer flex flex-items-center"> <div class="package-buttons quote_btn"><button class="FW1syM7 ZyiRdeA co-grey-1100 action-button tbody-default btn-order-no-thanks offer-decline-button bg-co-grey-300 decline_offer" data-hook="no-thanks"  >Offer Created</button></div> </footer>';
                           }
                           else if(vv.offer_created_sta == "active")
                           {
                              btn_quote_txt = '<footer class="custom-package-footer flex flex-items-center"> <div class="package-buttons quote_btn"><button class="FW1syM7 ZyiRdeA co-grey-1100 action-button tbody-default btn-order-no-thanks offer-decline-button bg-co-grey-300 decline_offer" data-hook="no-thanks" onclick="create_offer(this);" data-username ="'+vv.receiver_name+'"  data-label="'+vv.request_id+'" >Create Offer</button></div> </footer>';
                           }
                           $("#start_message_content").append('<div class="message-wrapper"> <div id="6374c7ccc293320014d546e0" class="message "> <span class=""> <figure class="profile-image"> <img src="'+vv.sender_img+'" alt="s"> <figcaption class="font-accent">S</figcaption> </figure> </span> <div class="message-content"> <div class="header"> <span class="sender">'+vv.sender_username+'</span><time >'+formatAMPM(new Date(vv.timestamp))+'</time> <div></div> </div> <span class=""> <div> <p class="tbody-6">'+vv.message+'</p> <div class="_4aalYpY tbody-6" data-testid="brief-entry"> <article> <div class="W6rA1Yv" data-testid="brief-body"> <ul class="SJvuSVq"> <li class="BhSqh3g flex flex-between"> <b class="vtb+Dcs">Specification</b> <div class="ryQqgSG"> <section> <div class="GQtv-8L"> <div class="flex flex-center m-r-4"> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="#2E5DC5"> <path clip-rule="evenodd" fill-rule="evenodd" d="M4.421 2.415c-.945.43-1.171.87-1.171 1.085 0 .215.226.655 1.171 1.085.878.399 2.142.665 3.579.665 1.437 0 2.701-.266 3.579-.665.945-.43 1.171-.87 1.171-1.085 0-.215-.226-.655-1.171-1.085C10.7 2.016 9.437 1.75 8 1.75c-1.437 0-2.701.266-3.579.665zm-.62-1.366C4.914.543 6.399.25 8 .25c1.6 0 3.086.293 4.2.8 1.045.475 2.05 1.285 2.05 2.45 0 .73-.394 1.32-.944 1.775A.75.75 0 0 1 14.25 6v.5c0 .73-.393 1.32-.944 1.775A.75.75 0 0 1 14.25 9v.5c0 .73-.393 1.32-.944 1.775a.749.749 0 0 1 .944.725v.5c0 1.165-1.005 1.975-2.05 2.45-1.114.507-2.6.8-4.2.8s-3.086-.293-4.2-.8c-1.045-.475-2.05-1.285-2.05-2.45V12a.75.75 0 0 1 .944-.725c-.55-.456-.944-1.046-.944-1.775V9a.75.75 0 0 1 .944-.725C2.144 7.82 1.75 7.23 1.75 6.5V6a.75.75 0 0 1 .945-.725C2.144 4.82 1.75 4.23 1.75 3.5c0-1.165 1.005-1.975 2.05-2.45zm-.674 4.54A.74.74 0 0 1 3.25 6v.5c0 .216.226.656 1.171 1.085.877.399 2.142.665 3.579.665 1.437 0 2.702-.266 3.579-.665.945-.43 1.171-.87 1.171-1.085V6c0-.152.045-.294.123-.412a5.504 5.504 0 0 1-.674.363c-1.113.506-2.598.799-4.199.799-1.6 0-3.086-.293-4.2-.8a5.512 5.512 0 0 1-.673-.362zm0 3c.078.118.123.26.123.411v.5c0 .216.226.656 1.171 1.085.877.399 2.142.665 3.579.665 1.437 0 2.702-.266 3.579-.665.945-.43 1.171-.87 1.171-1.085V9c0-.152.045-.293.123-.411a5.51 5.51 0 0 1-.673.362c-1.114.506-2.6.799-4.2.799s-3.086-.293-4.2-.8a5.511 5.511 0 0 1-.673-.361zm0 3c.078.118.123.26.123.411v.5c0 .216.226.656 1.171 1.085.877.399 2.142.665 3.579.665 1.437 0 2.702-.266 3.579-.665.945-.43 1.171-.87 1.171-1.085V12c0-.152.045-.293.123-.411a5.517 5.517 0 0 1-.673.362c-1.114.506-2.6.799-4.2.799s-3.086-.293-4.2-.8a5.517 5.517 0 0 1-.673-.361z"></path> </svg> </div> <div> <p>Budget $ '+vv.req_budget+'</p> </div> </div> <div class="GQtv-8L"> <div class="flex flex-center m-r-4"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="#2E5DC5"> <path d="M8 .25A7.749 7.749 0 0 0 .25 8 7.749 7.749 0 0 0 8 15.75 7.749 7.749 0 0 0 15.75 8 7.749 7.749 0 0 0 8 .25Zm0 14A6.248 6.248 0 0 1 1.75 8 6.248 6.248 0 0 1 8 1.75 6.248 6.248 0 0 1 14.25 8 6.248 6.248 0 0 1 8 14.25Zm1.931-3.262L7.278 9.059a.377.377 0 0 1-.153-.303V3.625c0-.206.169-.375.375-.375h1c.206 0 .375.169.375.375v4.428l2.088 1.519a.375.375 0 0 1 .08.525l-.587.81a.378.378 0 0 1-.525.08Z"></path> </svg> </div> <div> <p>'+vv.req_time+' delivery ('+vv.req_due_date+')</p> </div> </div> </section> </div> </li> <li class="BhSqh3g flex flex-between"> <b class="vtb+Dcs">Criteria</b> <div class="ryQqgSG"></div> </li> </ul> <p class="p-t-12">'+vv.req_desc+'</p>'+btn_quote_txt+' </div> </article>  </div> </div> </span> <span class=""></span> </div> </div> </div>');
                        }
                     }
                  }
                  else
                  {
                     if('{{request.user.username}}' == vv.sender_username)
                     {
                        $("#start_message_content").append('<div class="message-wrapper"> <div id="632ead45c2781c000e9ce00f" class="message "> <span class=""> <figure class="profile-image"> <img src="'+vv.sender_img+'" alt=""> <figcaption class="font-accent"></figcaption> </figure> </span> <div class="message-content"> <div class="header"> <span class="sender">Me</span><time>'+formatAMPM(new Date(vv.timestamp))+'</time> <div></div> </div> <span class=""> <div> <div> <p class="message-body">'+vv.message+'</p></div> </div> </span> <span class=""></span> </div> </div> </div>');
                     }
                     else{
                        $("#start_message_content").append('<div class="message-wrapper"> <div id="632ead45c2781c000e9ce00f" class="message "> <span class=""> <figure class="profile-image"> <img src="'+vv.sender_img+'" alt=""> <figcaption class="font-accent"></figcaption> </figure> </span> <div class="message-content"> <div class="header"> <span class="sender">'+vv.sender_username+'</span><time>'+formatAMPM(new Date(vv.timestamp))+'</time> <div></div> </div> <span class=""> <div> <div> <p class="message-body">'+vv.message+'</p> </div> </div> </span> <span class=""></span> </div> </div> </div>');
                     }
                  }
               }
            });
            $("#message_ids").val(array_list.join(", "));
            $('#message_content').scrollTop($('#message_content')[0].scrollHeight);
         }
      });
      $("#conversation").show();
   }
   function refersh_notifications()
   {
      $.ajax({
         type:"GET",
         url: "/get_notifications/",
         data: {"username":"{{request.user.username}}"},
         success: function(data)
         {
            $.each(data, function(j, nn) {
               if(parseInt(nn.unread_count)  > 0)
               {
                  parentdiv =  $("#contacts-list").find("a[data-label='"+nn.user_Name.replace(/\?/g, '')+"']");
                  $(parentdiv).find(".notif_div").append('<span class="unread-count">'+parseInt(nn.unread_count)+'</span> ')

               }
            });
         }
      });
   }

   function loadPrevious_Mssg()
   {
      newArray= []
      total_val = $("#total_chat_count").val();
      curre_val = $("#current_count").val();
      message_id = $("#message_ids").val().split(",");
      if(parseInt(curre_val) < parseInt(total_val))
      {
         if(message_id.length > 9){
            curre_val = parseInt(curre_val)+ 10;
            newArray = message_id.slice(0,10);
         }
         else{
            curre_val =  parseInt(curre_val)+ message_id.length;
            newArray = message_id;
         }
         $.ajax({
            type:"GET",
            url: "/get_chat_messages/",
            data: {"conver_id":$("#chat_conversation_id").val(),"current_count":parseInt(curre_val),"id_list":newArray.join(", ").toString()},
            success: function(data) 
            {
               div_id = 'div_messg_wrap_counter'+curre_val;
               $('#loaded_messages').prepend('<div id="div_messg_wrap_counter'+curre_val+'"></div>');    
               $("#current_count").val(data.current_count);
               $.each(data.data, function(i, vv) {
                  message_id = jQuery.grep(message_id, function(value) {
                     return value !=  vv.mssg_id;
                  });
                  if(vv.attachment != "None" && vv.res_type == null)
                  {
                     attachments = vv.attachment.trim().split(",");
                     attachment_txt = '<div class="attachments-preview-component"><div class="thumbnails-header"><h3>ATTACHMENTS</h3></div><ul class="attchments-container">';
                     $.each(attachments, function (key, value) {
                        if(value.trim().length != 0)
                        {
                           file_path = '/media/chat_files/'+value.trim();
                           attachment_txt += '<li class="thumbnail-preview" onclick="attachfile_onclick(this);" title="'+value+'" data-label= "'+file_path+'"><a class="thumbnail-link" href="'+file_path+'" target="_blank"><span class="fa fa-file-o fileicon" ></span></a><div class="action-bar flex flex-between"><div class="flex flex-center"><div class="attachment-name-container"><p class="attachment-name" title="'+value+'">...'+value.slice(-20)+'</p></div><span class="attachment-size"></span></div><div class="flex flex-center m-l-8"><a href="'+file_path+'" download class="download-button m-r-8"><span><i class="fa fa-download" aria-hidden="true"></i></span></a></div></div></li>';
                        }
                     });
                     attachment_txt += '</ul></div>';
                     if('{{request.user.username}}' == vv.sender_username)
                     {
                        $('#loaded_messages').find("#"+div_id).append('<div class="message-wrapper"> <div id="632ead45c2781c000e9ce00f" class="message "> <span class=""> <figure class="profile-image"> <img src="'+vv.sender_img+'" alt=""> <figcaption class="font-accent"></figcaption> </figure> </span> <div class="message-content"> <div class="header"> <span class="sender">Me</span><time>'+formatAMPM(new Date(vv.timestamp))+'</time> <div></div> </div> <span class=""> <div> <div> <p class="message-body">'+vv.message+'</p>'+attachment_txt+' </div> </div> </span> <span class=""></span> </div> </div> </div>');
                     }
                     else{
                        $('#loaded_messages').find("#"+div_id).append('<div class="message-wrapper"> <div id="632ead45c2781c000e9ce00f" class="message "> <span class=""> <figure class="profile-image"> <img src="'+vv.sender_img+'" alt=""> <figcaption class="font-accent"></figcaption> </figure> </span> <div class="message-content"> <div class="header"> <span class="sender">'+vv.sender_username+'</span><time>'+formatAMPM(new Date(vv.timestamp))+'</time> <div></div> </div> <span class=""> <div> <div> <p class="message-body">'+vv.message+'</p>'+attachment_txt+' </div> </div> </span> <span class=""></span> </div> </div> </div>');
                     }
                  }
                  else{
                     if(vv.mssg_type != "chat")
                     {
                        if('{{request.user.username}}' == vv.sender_username)
                        {
                           if(vv.mssg_type == "offer")
                           {
                              $('#loaded_messages').find("#"+div_id).append('<div class="message-wrapper"> <div id="6374d8a32a883f0001d7f4a3" class="message "> <span class=""> <a href="'+location_path+'/user/profile/'+vv.sender_username+'" target="_blank" rel="noopener noreferrer" class="profile-image-link"> <figure class="profile-image"> <img src="'+vv.sender_img+'" alt="b"> <figcaption class="font-accent"></figcaption> </figure> </a> </span> <div class="message-content"> <div class="header"> <a href="'+location_path+'/user/profile/'+vv.sender_username+'" target="_blank" class="sender" rel="noopener noreferrer">Me</a> </div> <span class=""> <div> <p class="title italic"> '+vv.message+'</p> <div class="+LNAmyM"> <div class="custom-offer-message-package custom-package-content" data-testid="custom-offer"> <header class="KUW+QwR _3YNlATc"> <div class="flex-center"> <h3 class="text-display-7"><a href="/gigs/'+vv.offer_sender+'/'+vv.gig_title+'" target="_blank">'+vv.gig_title+'</a></h3> </div> <div class="McOrFfb"><b class="GBwyMi1 _0-pU6pf">$ '+vv.offer_amount+'</b></div> </header> <div class="main"> <div class="description"> <div> <div class="fg5FMWv" style="height: auto;"> <p class="sanitized-text">'+vv.offer_desc+'</p> </div> </div> </div> <div class="package-content"> <h6 class="text-display-7 p-b-8">Your offer includes</h6> <div class="includes"> <div class="package-item flex flex-items-center tbody-default co-text-darker"> <span class="XQskgrQ icon" aria-hidden="true" style="width: 17px; height: 17px; fill: rgb(46, 93, 197);"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M4.50001 11.4999C6.40001 13.3999 9.60001 13.3999 11.5 11.4999C12.2 10.7999 12.7 9.7999 12.9 8.7999L14.9 9.0999C14.7 10.5999 14 11.8999 13 12.8999C10.3 15.5999 5.90001 15.5999 3.10001 12.8999L0.900012 15.0999L0.200012 8.6999L6.60001 9.3999L4.50001 11.4999Z"></path> <path d="M15.8 7.2999L9.40001 6.5999L11.5 4.4999C9.60001 2.5999 6.40001 2.5999 4.50001 4.4999C3.80001 5.1999 3.30001 6.1999 3.10001 7.1999L1.10001 6.8999C1.30001 5.3999 2.00001 4.0999 3.00001 3.0999C4.40001 1.6999 6.10001 1.0999 7.90001 1.0999C9.70001 1.0999 11.5 1.7999 12.8 3.0999L15 0.899902L15.8 7.2999Z"></path> </svg> </span> '+vv.offer_revision +'  Revisions </div> <div class="package-item flex flex-items-center tbody-default co-text-darker"> <span class="XQskgrQ icon" aria-hidden="true" style="width: 17px; height: 17px; fill: rgb(46, 93, 197);"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 14c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6z"></path> <path d="M9 4H7v5h5V7H9V4z"></path> </svg> </span> '+vv.offer_time+' Days Delivery </div> </div> </div> </div>  </div> </div> </div> </span> <span class=""></span> </div> </div> </div>'); 
                           }
                           else if(vv.mssg_type == "quote")
                           {
                              $('#loaded_messages').find("#"+div_id).append(' <div class="message-wrapper"> <div id="6374c7ccc293320014d546e0" class="message "> <span class=""> <figure class="profile-image"> <img src="'+vv.sender_img+'" > <figcaption class="font-accent">S</figcaption> </figure> </span> <div class="message-content"> <div class="header"> <span class="sender">Me</span><time >'+formatAMPM(new Date(vv.timestamp))+'</time> <div></div> </div> <span class=""> <div> <p class="tbody-6">'+vv.message+'</p> <div class="_4aalYpY tbody-6" data-testid="brief-entry"> <article> <div class="W6rA1Yv" data-testid="brief-body"> <ul class="SJvuSVq"> <li class="BhSqh3g flex flex-between"> <b class="vtb+Dcs">Specification</b> <div class="ryQqgSG"> <section> <div class="GQtv-8L"> <div class="flex flex-center m-r-4"> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="#2E5DC5"> <path clip-rule="evenodd" fill-rule="evenodd" d="M4.421 2.415c-.945.43-1.171.87-1.171 1.085 0 .215.226.655 1.171 1.085.878.399 2.142.665 3.579.665 1.437 0 2.701-.266 3.579-.665.945-.43 1.171-.87 1.171-1.085 0-.215-.226-.655-1.171-1.085C10.7 2.016 9.437 1.75 8 1.75c-1.437 0-2.701.266-3.579.665zm-.62-1.366C4.914.543 6.399.25 8 .25c1.6 0 3.086.293 4.2.8 1.045.475 2.05 1.285 2.05 2.45 0 .73-.394 1.32-.944 1.775A.75.75 0 0 1 14.25 6v.5c0 .73-.393 1.32-.944 1.775A.75.75 0 0 1 14.25 9v.5c0 .73-.393 1.32-.944 1.775a.749.749 0 0 1 .944.725v.5c0 1.165-1.005 1.975-2.05 2.45-1.114.507-2.6.8-4.2.8s-3.086-.293-4.2-.8c-1.045-.475-2.05-1.285-2.05-2.45V12a.75.75 0 0 1 .944-.725c-.55-.456-.944-1.046-.944-1.775V9a.75.75 0 0 1 .944-.725C2.144 7.82 1.75 7.23 1.75 6.5V6a.75.75 0 0 1 .945-.725C2.144 4.82 1.75 4.23 1.75 3.5c0-1.165 1.005-1.975 2.05-2.45zm-.674 4.54A.74.74 0 0 1 3.25 6v.5c0 .216.226.656 1.171 1.085.877.399 2.142.665 3.579.665 1.437 0 2.702-.266 3.579-.665.945-.43 1.171-.87 1.171-1.085V6c0-.152.045-.294.123-.412a5.504 5.504 0 0 1-.674.363c-1.113.506-2.598.799-4.199.799-1.6 0-3.086-.293-4.2-.8a5.512 5.512 0 0 1-.673-.362zm0 3c.078.118.123.26.123.411v.5c0 .216.226.656 1.171 1.085.877.399 2.142.665 3.579.665 1.437 0 2.702-.266 3.579-.665.945-.43 1.171-.87 1.171-1.085V9c0-.152.045-.293.123-.411a5.51 5.51 0 0 1-.673.362c-1.114.506-2.6.799-4.2.799s-3.086-.293-4.2-.8a5.511 5.511 0 0 1-.673-.361zm0 3c.078.118.123.26.123.411v.5c0 .216.226.656 1.171 1.085.877.399 2.142.665 3.579.665 1.437 0 2.702-.266 3.579-.665.945-.43 1.171-.87 1.171-1.085V12c0-.152.045-.293.123-.411a5.517 5.517 0 0 1-.673.362c-1.114.506-2.6.799-4.2.799s-3.086-.293-4.2-.8a5.517 5.517 0 0 1-.673-.361z"></path> </svg> </div> <div> <p>Budget $ '+vv.req_budget+'</p> </div> </div> <div class="GQtv-8L"> <div class="flex flex-center m-r-4"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="#2E5DC5"> <path d="M8 .25A7.749 7.749 0 0 0 .25 8 7.749 7.749 0 0 0 8 15.75 7.749 7.749 0 0 0 15.75 8 7.749 7.749 0 0 0 8 .25Zm0 14A6.248 6.248 0 0 1 1.75 8 6.248 6.248 0 0 1 8 1.75 6.248 6.248 0 0 1 14.25 8 6.248 6.248 0 0 1 8 14.25Zm1.931-3.262L7.278 9.059a.377.377 0 0 1-.153-.303V3.625c0-.206.169-.375.375-.375h1c.206 0 .375.169.375.375v4.428l2.088 1.519a.375.375 0 0 1 .08.525l-.587.81a.378.378 0 0 1-.525.08Z"></path> </svg> </div> <div> <p>'+vv.req_time+' delivery ('+vv.req_due_date+')</p> </div> </div> </section> </div> </li> <li class="BhSqh3g flex flex-between"> <b class="vtb+Dcs">Criteria</b> <div class="ryQqgSG"></div> </li> </ul> <p class="p-t-12">'+vv.req_desc+'</p> </div> </article> </div> </div> </span> <span class=""></span> </div> </div> </div>');
                           }
                        }
                        else{
                           if(vv.mssg_type == "offer")
                           {
                              if(vv.offer_status == "ordered")
                              {
                                 btn_offer_txt = '<footer class="custom-package-footer flex flex-items-center"> <div class="package-buttons"><a class="FW1syM7 ZyiRdeA co-grey-1100 action-button tbody-default btn-order-no-thanks offer-decline-button bg-co-grey-300 decline_offer" data-hook="no-thanks" href="'+location_path+'/user/{{request.user.username}}/manage_orders/'+vv.order_no+'/activities" >View Order</a> </div> </footer>'
                              }
                              else if(vv.offer_status == "deleted")
                              {
                                 btn_offer_txt = '<footer class="custom-package-footer flex flex-items-center"> <div class="package-buttons"><button class="FW1syM7 ZyiRdeA co-grey-1100 action-button tbody-default btn-order-no-thanks offer-decline-button bg-co-grey-300 decline_offer" data-hook="no-thanks">Offer Declined</button> </div> </footer>'
                              }
                              else if(vv.offer_status == "active")
                              {
                                 btn_offer_txt = '<footer class="custom-package-footer flex flex-items-center"> <div class="package-buttons"><button class="FW1syM7 ZyiRdeA co-grey-1100 action-button tbody-default btn-order-no-thanks offer-decline-button bg-co-grey-300 decline_offer" data-hook="no-thanks" onclick="decline_onclick(this);" data-label="'+vv.offer_id+'" >Decline</button><a class="FW1syM7 L1yjt43 co-white action-button bg-co-green-700" data-label="'+vv.offer_id+'" target="_blank" href="/payments/0/'+ vv.offer_id+'">Accept</a></div> </footer>'
                              }                           
                              $('#loaded_messages').find("#"+div_id).append('<div class="message-wrapper"> <div id="6374d8a32a883f0001d7f4a3" class="message "> <span class=""> <a href="'+location_path+'/user/profile/'+vv.sender_username+'" target="_blank" rel="noopener noreferrer" class="profile-image-link"> <figure class="profile-image"> <img src="'+vv.sender_img+'" alt="b"> <figcaption class="font-accent"></figcaption> </figure> </a> </span> <div class="message-content"> <div class="header"> <a href="'+location_path+'/user/profile/'+vv.sender_username+'" target="_blank" class="sender" rel="noopener noreferrer">Me</a> </div> <span class=""> <div> <p class="title italic"> '+vv.message+'</p> <div class="+LNAmyM"> <div class="custom-offer-message-package custom-package-content" data-testid="custom-offer"> <header class="KUW+QwR _3YNlATc"> <div class="flex-center"> <h3 class="text-display-7"><a href="/gigs/'+vv.offer_sender+'/'+vv.gig_title+'" target="_blank">'+vv.gig_title+'</a></h3> </div> <div class="McOrFfb"><b class="GBwyMi1 _0-pU6pf">$ '+vv.offer_amount+'</b></div> </header> <div class="main"> <div class="description"> <div> <div class="fg5FMWv" style="height: auto;"> <p class="sanitized-text">'+vv.offer_desc+'</p> </div> </div> </div> <div class="package-content"> <h6 class="text-display-7 p-b-8">Your offer includes</h6> <div class="includes"> <div class="package-item flex flex-items-center tbody-default co-text-darker"> <span class="XQskgrQ icon" aria-hidden="true" style="width: 17px; height: 17px; fill: rgb(46, 93, 197);"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M4.50001 11.4999C6.40001 13.3999 9.60001 13.3999 11.5 11.4999C12.2 10.7999 12.7 9.7999 12.9 8.7999L14.9 9.0999C14.7 10.5999 14 11.8999 13 12.8999C10.3 15.5999 5.90001 15.5999 3.10001 12.8999L0.900012 15.0999L0.200012 8.6999L6.60001 9.3999L4.50001 11.4999Z"></path> <path d="M15.8 7.2999L9.40001 6.5999L11.5 4.4999C9.60001 2.5999 6.40001 2.5999 4.50001 4.4999C3.80001 5.1999 3.30001 6.1999 3.10001 7.1999L1.10001 6.8999C1.30001 5.3999 2.00001 4.0999 3.00001 3.0999C4.40001 1.6999 6.10001 1.0999 7.90001 1.0999C9.70001 1.0999 11.5 1.7999 12.8 3.0999L15 0.899902L15.8 7.2999Z"></path> </svg> </span> '+vv.offer_revision +'  Revisions </div> <div class="package-item flex flex-items-center tbody-default co-text-darker"> <span class="XQskgrQ icon" aria-hidden="true" style="width: 17px; height: 17px; fill: rgb(46, 93, 197);"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 14c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6z"></path> <path d="M9 4H7v5h5V7H9V4z"></path> </svg> </span> '+vv.offer_time+' Days Delivery </div> </div> </div> </div> '+ btn_offer_txt +'</div> </div> </div> </span> <span class=""></span> </div> </div> </div>'); 
                           }
                           else if(vv.mssg_type == "quote")
                           {
                              btn_quote_txt = '';
                              if(vv.offer_created_sta == "created")
                              {
                                 btn_quote_txt = '<footer class="custom-package-footer flex flex-items-center"> <div class="package-buttons quote_btn"><button class="FW1syM7 ZyiRdeA co-grey-1100 action-button tbody-default btn-order-no-thanks offer-decline-button bg-co-grey-300 decline_offer" data-hook="no-thanks"  >Offer Created</button></div> </footer>';
                              }
                              else if(vv.offer_created_sta == "active")
                              {
                                 btn_quote_txt = '<footer class="custom-package-footer flex flex-items-center"> <div class="package-buttons quote_btn"><button class="FW1syM7 ZyiRdeA co-grey-1100 action-button tbody-default btn-order-no-thanks offer-decline-button bg-co-grey-300 decline_offer" data-hook="no-thanks" onclick="create_offer(this);" data-username ="'+vv.receiver_name+'"  data-label="'+vv.request_id+'" >Create Offer</button></div> </footer>';
                              }
                              $('#loaded_messages').find("#"+div_id).append('<div class="message-wrapper"> <div id="6374c7ccc293320014d546e0" class="message "> <span class=""> <figure class="profile-image"> <img src="'+vv.sender_img+'" alt="s"> <figcaption class="font-accent">S</figcaption> </figure> </span> <div class="message-content"> <div class="header"> <span class="sender">'+vv.sender_username+'</span><time >'+formatAMPM(new Date(vv.timestamp))+'</time> <div></div> </div> <span class=""> <div> <p class="tbody-6">'+vv.message+'</p> <div class="_4aalYpY tbody-6" data-testid="brief-entry"> <article> <div class="W6rA1Yv" data-testid="brief-body"> <ul class="SJvuSVq"> <li class="BhSqh3g flex flex-between"> <b class="vtb+Dcs">Specification</b> <div class="ryQqgSG"> <section> <div class="GQtv-8L"> <div class="flex flex-center m-r-4"> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="#2E5DC5"> <path clip-rule="evenodd" fill-rule="evenodd" d="M4.421 2.415c-.945.43-1.171.87-1.171 1.085 0 .215.226.655 1.171 1.085.878.399 2.142.665 3.579.665 1.437 0 2.701-.266 3.579-.665.945-.43 1.171-.87 1.171-1.085 0-.215-.226-.655-1.171-1.085C10.7 2.016 9.437 1.75 8 1.75c-1.437 0-2.701.266-3.579.665zm-.62-1.366C4.914.543 6.399.25 8 .25c1.6 0 3.086.293 4.2.8 1.045.475 2.05 1.285 2.05 2.45 0 .73-.394 1.32-.944 1.775A.75.75 0 0 1 14.25 6v.5c0 .73-.393 1.32-.944 1.775A.75.75 0 0 1 14.25 9v.5c0 .73-.393 1.32-.944 1.775a.749.749 0 0 1 .944.725v.5c0 1.165-1.005 1.975-2.05 2.45-1.114.507-2.6.8-4.2.8s-3.086-.293-4.2-.8c-1.045-.475-2.05-1.285-2.05-2.45V12a.75.75 0 0 1 .944-.725c-.55-.456-.944-1.046-.944-1.775V9a.75.75 0 0 1 .944-.725C2.144 7.82 1.75 7.23 1.75 6.5V6a.75.75 0 0 1 .945-.725C2.144 4.82 1.75 4.23 1.75 3.5c0-1.165 1.005-1.975 2.05-2.45zm-.674 4.54A.74.74 0 0 1 3.25 6v.5c0 .216.226.656 1.171 1.085.877.399 2.142.665 3.579.665 1.437 0 2.702-.266 3.579-.665.945-.43 1.171-.87 1.171-1.085V6c0-.152.045-.294.123-.412a5.504 5.504 0 0 1-.674.363c-1.113.506-2.598.799-4.199.799-1.6 0-3.086-.293-4.2-.8a5.512 5.512 0 0 1-.673-.362zm0 3c.078.118.123.26.123.411v.5c0 .216.226.656 1.171 1.085.877.399 2.142.665 3.579.665 1.437 0 2.702-.266 3.579-.665.945-.43 1.171-.87 1.171-1.085V9c0-.152.045-.293.123-.411a5.51 5.51 0 0 1-.673.362c-1.114.506-2.6.799-4.2.799s-3.086-.293-4.2-.8a5.511 5.511 0 0 1-.673-.361zm0 3c.078.118.123.26.123.411v.5c0 .216.226.656 1.171 1.085.877.399 2.142.665 3.579.665 1.437 0 2.702-.266 3.579-.665.945-.43 1.171-.87 1.171-1.085V12c0-.152.045-.293.123-.411a5.517 5.517 0 0 1-.673.362c-1.114.506-2.6.799-4.2.799s-3.086-.293-4.2-.8a5.517 5.517 0 0 1-.673-.361z"></path> </svg> </div> <div> <p>Budget $ '+vv.req_budget+'</p> </div> </div> <div class="GQtv-8L"> <div class="flex flex-center m-r-4"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="#2E5DC5"> <path d="M8 .25A7.749 7.749 0 0 0 .25 8 7.749 7.749 0 0 0 8 15.75 7.749 7.749 0 0 0 15.75 8 7.749 7.749 0 0 0 8 .25Zm0 14A6.248 6.248 0 0 1 1.75 8 6.248 6.248 0 0 1 8 1.75 6.248 6.248 0 0 1 14.25 8 6.248 6.248 0 0 1 8 14.25Zm1.931-3.262L7.278 9.059a.377.377 0 0 1-.153-.303V3.625c0-.206.169-.375.375-.375h1c.206 0 .375.169.375.375v4.428l2.088 1.519a.375.375 0 0 1 .08.525l-.587.81a.378.378 0 0 1-.525.08Z"></path> </svg> </div> <div> <p>'+vv.req_time+' delivery ('+vv.req_due_date+')</p> </div> </div> </section> </div> </li> <li class="BhSqh3g flex flex-between"> <b class="vtb+Dcs">Criteria</b> <div class="ryQqgSG"></div> </li> </ul> <p class="p-t-12">'+vv.req_desc+'</p>'+btn_quote_txt+' </div> </article>  </div> </div> </span> <span class=""></span> </div> </div> </div>');
                           }
                        }
                     }
                     else
                     {
                        if('{{request.user.username}}' == vv.sender_username)
                        {
                           $('#loaded_messages').find("#"+div_id).append('<div class="message-wrapper"> <div id="632ead45c2781c000e9ce00f" class="message "> <span class=""> <figure class="profile-image"> <img src="'+vv.sender_img+'" alt=""> <figcaption class="font-accent"></figcaption> </figure> </span> <div class="message-content"> <div class="header"> <span class="sender">Me</span><time>'+formatAMPM(new Date(vv.timestamp))+'</time> <div></div> </div> <span class=""> <div> <div> <p class="message-body">'+vv.message+'</p></div> </div> </span> <span class=""></span> </div> </div> </div>');
                        }
                        else{
                           $('#loaded_messages').find("#"+div_id).append('<div class="message-wrapper"> <div id="632ead45c2781c000e9ce00f" class="message "> <span class=""> <figure class="profile-image"> <img src="'+vv.sender_img+'" alt=""> <figcaption class="font-accent"></figcaption> </figure> </span> <div class="message-content"> <div class="header"> <span class="sender">'+vv.sender_username+'</span><time>'+formatAMPM(new Date(vv.timestamp))+'</time> <div></div> </div> <span class=""> <div> <div> <p class="message-body">'+vv.message+'</p> </div> </div> </span> <span class=""></span> </div> </div> </div>');
                        }
                     }
                  }
               });
               $('#message_content').animate({
                  scrollTop: $('#message_content').offset().top - 20 
               }, 'slow');
               $("#message_ids").val(message_id.join(", "));
               if(message_id.length == 0){
                  $("#h_previous_mssg").hide();
               }
            }
         });
      }
   }
</script>
{% endblock %}