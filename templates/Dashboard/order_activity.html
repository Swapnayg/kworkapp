{% include  'base.html' %}
{% load static %}
{% block contentarea%}
<title>Letworkbedone - {{request.user.username}} / Shopping - Status of your Order</title>
<link rel="stylesheet" href="{% static 'assets/css/frontend/order_activity.css' %}" type="text/css" />
<div class="all_page page-flex__content pt0 m0">
    <div id="event_list" class="event-list js-event-list"></div>
    <input type="hidden"  value="{{seller_user_name}}" id="seller_username" />
    <input type="hidden"  value="{{buyer_user_name}}" id="buyer_username" />
    <input type="hidden"  value="{{conversation_id}}" id="conversation_id" />
    <input type="hidden"  value="" id="total_chat_count" />
    <input type="hidden"  value="" id="current_count" />
    <input type="hidden"  value="" id="message_ids" />
    <input type="hidden"  value="{{chat_words}}" id="chat_words_hidd" />
    <input type="hidden"  value="{{five_chat_words}}" id="five_chat_words_hidd" />
    <div id="fox_notification_block"></div>
    <div class="row justify-content-center mt-0" id="manage_gigs">
       <div class="col-9 text-center p-0 mt-3 mb-2">
          <div class="card px-0 pt-4 pb-0 mb-3"  id="manage_gigs_card">
             <div class="row">
                <div class="col-md-12 mx-0">
                    <ul class="nav nav-tabs" role="tablist">
                        <li><a href="#activetab" role="tab" class="active" data-toggle="tab">Activity </a></li>
                        <li><a href="#pendingtab" role="tab" data-toggle="tab">Details</a></li>
                        {% if req_check == 'yes' %}
                           <li><a href="#modificationtab" role="tab" data-toggle="tab">Requirements</a></li>
                        {% endif %}
                        {% if delivery == 'yes' %}
                        <li><a href="#deliverytab" role="tab" data-toggle="tab">Dellivery Details</a></li>
                        {% endif %}
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="activetab">
                            <div class="tab-activities">
                                <div class="focus-area show-on-large-screen in-progress">
                                   <div class="focus-wrapper">
                                      <div class="focus-message">
                                         <h3>Order started</h3>
                                         {% if req_check == 'yes' %}
                                             <div class="focus-body"><b>{{order_by.username}}</b> sent all the information you need so you can start working on this order. You got this!</div>
                                         {% endif %}
                                      </div>
                                   </div>
                                </div>
                                <div class="wrap-box">
                                 <h2 id="h_previous_mssg"><------------------------------------     <button onclick="loadPrevious_Mssg();">Load Previous Message</button>     ------------------------------------></h2>
                                   
                                    <div class="activities with-extras-loading" id="loaded_messages">
                                    </div>
                                    <div class="activities with-extras-loading" id="message_wrap_box">
                                   </div>
                                   {% if seller_gig.0.order_status == 'late' or seller_gig.0.order_status == 'delivered' or seller_gig.0.order_status == 'resolution' or seller_gig.0.order_status == 'progress' %}
                                   <div class="seller-message-box shared-message-box">
                                      <div class="rzAP5-N text-area-container m-b-16 flex flex-col">
                                         <div class="LsC-Zuk p-r-0 form-text-area">
                                          <textarea maxlength="{{message_char}}" placeholder="Type your message here" id="text_order_mssg"></textarea>
                                          <div class="help_div"> <div class="helptext_desc">Message should contain {{message_char}} characters minimum.</div> <span class="help_text_span"><i class="fa fa-question-circle" aria-hidden="true"></i></span> </div>
                                       </div>
                                         <span class="control-bar flex-end">
                                            <span class="text-counter" id="span_order_mssg">0 / {{message_char}}</span>
                                            <div class="e4rLWCQ _1DtaAoI upload-attachment-tooltip">
                                             <span class="FPMjOVo">
                                             <label class="ORLWF8p _7pUBXz- co-green-700 attachments-button p-0 YxOH7gm bg-co-white">
                                                <span class="attachment-icon" for="chat_file"></span>
                                                <input  type="file" id="chat_file"  accept="*" >
                                          </label>
                                          
                                          </span>
                                          </div>
                                            <div class="e4rLWCQ DQP4pgk emoji-picker p-r-24 laoJvCO"><span class="FPMjOVo">
                                          </span></div>
                                         </span>
                                      </div>
                                      <div class="errors m-t-16 co-red-700 text-body-2 flex flex-col" id="message_errors">Terms of Service reminder: Providing <span class="detected_mssg"></span> is only allowed if it is needed as part of the service. Otherwise, all communication must go through Letworkbedone</div>
                                      <div class="message-box-cta"> 
                                         <button class="ORLWF8p _0MkXbqi L9EM07f co-green-700 message-box-send" id="chat_message_send">Send</button>
                                        
                                      </div>
                                   </div>
                                   <div class="wrap-box" id="wrap_files_list">
                                       <div class="message-box-cta" id="files_list"> 
                                       </div>
                                    </div>
                                    <div class="wrap-box" id="wrap_progress_list">
                                       <div class="message-box-cta" id="file_progress_div"> 
                                       </div>
                                    </div>
                                    {% endif %}
                                </div>
                                {% if  seller_gig.0.order_status == 'completed' %}
                                    <div class="wrap-box">
                                       <div class="activity-date">
                                       {% if  seller_review.0.review_message.strip|length != 0 %}
                                       {% if current_user == "Buyer"  %}
                                       <section class="activity-wrap order-rated-by-buyer">
                                          <article class="LF267+J H1pvagJ PpAciwT">
                                             <div class="AuUenGR activity-collapsible-title-wrapper">
                                                <div class="CLdO82Y">
                                                   <label>
                                                      <span class="stamp order-rated-by-buyer">
                                                         
                                                      </span>
                                                      <p class="header-base rating-header"><span class="title-text">You left a {{seller_review.0.average_val|length }}-star review</span><i class="time-stamp"> {{seller_review.0.review_date|date:' M d, Y h:i a'}}</i></p>
                                                   </label>
                                                </div>
                                             </div>
                                             <div class="activity-collapsible-content">
                                                <div style="max-height: unset; overflow: unset;">
                                                   <div>
                                                      <article class="activity-body">
                                                         <div class="rating-activity"> 
                                                            <section class="card-wrap">
                                                               <header class="card-header"><span class="card-title">Your Review</span> </header>
                                                               <div class="card-content">
                                                                  <div class="user-message">
                                                                     <a href="/user/profile/{{seller_review.0.s_review_from_username}}" class="stamp link">
                                                                        <div class="user-profile-image"><label class="profile-pict" for="profile_image_3129758391266" style="width: 40px; height: 40px; font-size: 1em;"><img src="{{seller_review.0.s_review_from_img}}" class="profile-pict-img" alt="{{seller_review.0.s_review_from_username}}"></label></div>
                                                                     </a>
                                                                     <div class="message-column">
                                                                        <p>
                                                                        <div class="flex">
                                                                           <span class="username">Me</span>
                                                                           <div class="flex">
                                                                              <div class="orca-rating color-yellow tbody-6">
                                                                                 <div class="stars">
                                                                                    {% for avera in seller_review.0.average_val %}
                                                                                       <span class="zv900so orca-star" aria-hidden="true" style="width: 15px; height: 15px;">
                                                                                          <svg width="16" height="15" viewBox="0 0 16 15" xmlns="http://www.w3.org/2000/svg">
                                                                                             <path fill-rule="evenodd" clip-rule="evenodd" d="M16 5.81285C16 5.98299 15.875 6.14367 15.75 6.26654L12.2596 9.61248L13.0865 14.3384C13.0962 14.4045 13.0962 14.4612 13.0962 14.5274C13.0962 14.7732 12.9808 15 12.7019 15C12.5673 15 12.4327 14.9527 12.3173 14.8866L8 12.656L3.68269 14.8866C3.55769 14.9527 3.43269 15 3.29808 15C3.01923 15 2.89423 14.7732 2.89423 14.5274C2.89423 14.4612 2.90385 14.4045 2.91346 14.3384L3.74038 9.61248L0.240385 6.26654C0.125 6.14367 0 5.98299 0 5.81285C0 5.5293 0.298077 5.41588 0.538462 5.37807L5.36539 4.68809L7.52885 0.387524C7.61539 0.207939 7.77885 0 8 0C8.22115 0 8.38462 0.207939 8.47115 0.387524L10.6346 4.68809L15.4615 5.37807C15.6923 5.41588 16 5.5293 16 5.81285Z"></path>
                                                                                          </svg>
                                                                                       </span>
                                                                                    {% endfor %}
                                                                                 </div>
                                                                                 <b class="rating-score">{{seller_review.0.average_val |length}}</b>
                                                                              </div>
                                                                           </div>
                                                                        </div>
                                                                        </p>
                                                                        <p>{{seller_review.0.review_message }}</p>
                                                                     </div>
                                                                  </div>
                                                                  <ul>
                                                                     <li class="rating-row">
                                                                        <div class="rating-title">Communication With Seller</div>
                                                                        <div class="orca-rating color-yellow tbody-6">
                                                                           <div class="stars">
                                                                              {% for avera in seller_review.0.communication %}
                                                                              <span class="zv900so orca-star" aria-hidden="true" style="width: 15px; height: 15px;">
                                                                                 <svg width="16" height="15" viewBox="0 0 16 15" xmlns="http://www.w3.org/2000/svg">
                                                                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M16 5.81285C16 5.98299 15.875 6.14367 15.75 6.26654L12.2596 9.61248L13.0865 14.3384C13.0962 14.4045 13.0962 14.4612 13.0962 14.5274C13.0962 14.7732 12.9808 15 12.7019 15C12.5673 15 12.4327 14.9527 12.3173 14.8866L8 12.656L3.68269 14.8866C3.55769 14.9527 3.43269 15 3.29808 15C3.01923 15 2.89423 14.7732 2.89423 14.5274C2.89423 14.4612 2.90385 14.4045 2.91346 14.3384L3.74038 9.61248L0.240385 6.26654C0.125 6.14367 0 5.98299 0 5.81285C0 5.5293 0.298077 5.41588 0.538462 5.37807L5.36539 4.68809L7.52885 0.387524C7.61539 0.207939 7.77885 0 8 0C8.22115 0 8.38462 0.207939 8.47115 0.387524L10.6346 4.68809L15.4615 5.37807C15.6923 5.41588 16 5.5293 16 5.81285Z"></path>
                                                                                 </svg>
                                                                              </span>
                                                                              {% endfor %}
                                                                           </div>
                                                                           <b class="rating-score">{{seller_review.0.communication|length }}</b>
                                                                        </div>
                                                                     </li>
                                                                     <li class="rating-row">
                                                                        <div class="rating-title">Service as Described</div>
                                                                        <div class="orca-rating color-yellow tbody-6">
                                                                           <div class="stars">
                                                                              {% for avera in seller_review.0.recommendation %}
                                                                              <span class="zv900so orca-star" aria-hidden="true" style="width: 15px; height: 15px;">
                                                                                 <svg width="16" height="15" viewBox="0 0 16 15" xmlns="http://www.w3.org/2000/svg">
                                                                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M16 5.81285C16 5.98299 15.875 6.14367 15.75 6.26654L12.2596 9.61248L13.0865 14.3384C13.0962 14.4045 13.0962 14.4612 13.0962 14.5274C13.0962 14.7732 12.9808 15 12.7019 15C12.5673 15 12.4327 14.9527 12.3173 14.8866L8 12.656L3.68269 14.8866C3.55769 14.9527 3.43269 15 3.29808 15C3.01923 15 2.89423 14.7732 2.89423 14.5274C2.89423 14.4612 2.90385 14.4045 2.91346 14.3384L3.74038 9.61248L0.240385 6.26654C0.125 6.14367 0 5.98299 0 5.81285C0 5.5293 0.298077 5.41588 0.538462 5.37807L5.36539 4.68809L7.52885 0.387524C7.61539 0.207939 7.77885 0 8 0C8.22115 0 8.38462 0.207939 8.47115 0.387524L10.6346 4.68809L15.4615 5.37807C15.6923 5.41588 16 5.5293 16 5.81285Z"></path>
                                                                                 </svg>
                                                                              </span>
                                                                              {% endfor %}
                                                                           </div>
                                                                           <b class="rating-score">{{seller_review.0.recommendation|length }}</b>
                                                                        </div>
                                                                     </li>
                                                                     <li class="rating-row">
                                                                        <div class="rating-title">Buy Again or Recommend</div>
                                                                        <div class="orca-rating color-yellow tbody-6">
                                                                           <div class="stars">
                                                                              {% for avera in seller_review.0.service %}
                                                                                 <span class="zv900so orca-star" aria-hidden="true" style="width: 15px; height: 15px;">
                                                                                    <svg width="16" height="15" viewBox="0 0 16 15" xmlns="http://www.w3.org/2000/svg">
                                                                                       <path fill-rule="evenodd" clip-rule="evenodd" d="M16 5.81285C16 5.98299 15.875 6.14367 15.75 6.26654L12.2596 9.61248L13.0865 14.3384C13.0962 14.4045 13.0962 14.4612 13.0962 14.5274C13.0962 14.7732 12.9808 15 12.7019 15C12.5673 15 12.4327 14.9527 12.3173 14.8866L8 12.656L3.68269 14.8866C3.55769 14.9527 3.43269 15 3.29808 15C3.01923 15 2.89423 14.7732 2.89423 14.5274C2.89423 14.4612 2.90385 14.4045 2.91346 14.3384L3.74038 9.61248L0.240385 6.26654C0.125 6.14367 0 5.98299 0 5.81285C0 5.5293 0.298077 5.41588 0.538462 5.37807L5.36539 4.68809L7.52885 0.387524C7.61539 0.207939 7.77885 0 8 0C8.22115 0 8.38462 0.207939 8.47115 0.387524L10.6346 4.68809L15.4615 5.37807C15.6923 5.41588 16 5.5293 16 5.81285Z"></path>
                                                                                    </svg>
                                                                                 </span>
                                                                              {% endfor %}
                                                                           </div>
                                                                           <b class="rating-score">{{seller_review.0.service|length }}</b>
                                                                        </div>
                                                                     </li>
                                                                  </ul>
                                                                 {% if seller_review.0.seller_response|length == 0 %}
                                                                 {% if current_user == "Seller" %}
                                                                     <div class="activity-collapsible-content" id="response_div">
                                                                        <form id="form_response">
                                                                           <div class="LsC-Zuk p-r-0 form-text-area">
                                                                              <textarea maxlength="{{seller_resp_char}}" placeholder="give response for your review." id="text_response_mssg" required></textarea>
                                                                           </div>
                                                                           <span class="control-bar flex-end"><span class="text-counter" id="span_response_mssg">0 / {{seller_resp_char}}</span></span>
                                                                           <div class="col-lg-12" id="sub_resp_div">
                                                                              <input type="submit" class="mt-3 agqrXOY BvNepr1 r+NFCla co-white pay-button bg-co-green-700" id="btn_sub_response" value="Give Response">
                                                                           </div>
                                                                        </form>
                                                                     </div>
                                                                     {% endif %}
                                                                  {% else %}
                                                                     <div class="user-message response"  >
                                                                        <a href="/user/profile/{{seller_review.0.s_review_to_username}}" class="stamp link">
                                                                           <div class="user-profile-image"><label class="profile-pict" for="profile_image_3297531691274" style="width: 40px; height: 40px; font-size: 1em;"><img src="{{seller_review.0.s_review_to_img}}" class="profile-pict-img" alt="elasho"></label></div>
                                                                        </a>
                                                                        <div class="message-column">
                                                                        <p>
                                                                           <div class="flex"><span class="username"><span><a href="/user/profile/{{seller_review.0.s_review_to_username}}" class="username-url">{{seller_review.0.s_review_to_username}}</a></span>'s response:</span></div>
                                                                        </p>
                                                                        <p id="response_message">{{seller_review.0.seller_response}}</p>
                                                                        </div>
                                                                     </div>
                                                                     {% if buyer_review.0.review_message.strip|length == 0  %}
                                                                        {% if current_user == "Seller"  %}
                                                                        <div class="row tab7 mt-3 mb-5" >
                                                                           <div class="col-lg-12 seller_btn_review_div">
                                                                              <a class="mt-3 agqrXOY BvNepr1 r+NFCla co-white pay-button bg-co-green-700" href="/buyer_reviews/{{order_details.order_no}}" target="_self" id="seller_rev_btn">Give Feedback</a>
                                                                           </div>
                                                                        </div>
                                                                        {% endif %}
                                                                     {% endif %}
                                                                  {% endif %}
                                                               </div>
                                                            </section>
                                                         </div>
                                                      </article>
                                                   </div>
                                                </div>
                                             </div>
                                              <div id="seller_resp_div1">
                                                <div class="user-message response"  >
                                                   <a href="/user/profile/{{seller_review.0.s_review_to_username}}" class="stamp link">
                                                      <div class="user-profile-image"><label class="profile-pict" for="profile_image_3297531691274" style="width: 40px; height: 40px; font-size: 1em;"><img src="{{seller_review.0.s_review_to_img}}" class="profile-pict-img" alt="elasho"></label></div>
                                                   </a>
                                                   <div class="message-column">
                                                   <p>
                                                      <div class="flex"><span class="username"><span><a href="/user/profile/{{seller_review.0.s_review_to_username}}" class="username-url">{{seller_review.0.s_review_to_username}}</a></span>'s response:</span></div>
                                                   </p>
                                                   <p id="response_message">{{seller_review.0.seller_response}}</p>
                                                   </div>
                                                </div>
                                                <div class="row tab7 mt-3 mb-5" >
                                                   <div class="col-lg-12 seller_btn_review_div">
                                                      <a class="mt-3 agqrXOY BvNepr1 r+NFCla co-white pay-button bg-co-green-700" href="/buyer_reviews/{{order_details.order_no}}" target="_self" id="seller_rev_btn">Give Feedback</a>
                                                   </div>
                                                </div>
                                             </div>
                                          </article>
                                       </section>
                                       {% elif  current_user == "Seller"  %}
                                       <section class="activity-wrap order-rated-by-buyer">
                                          <article class="LF267+J H1pvagJ PpAciwT">
                                             <div class="AuUenGR activity-collapsible-title-wrapper">
                                                <div class="CLdO82Y">
                                                   <label>
                                                      <span class="stamp order-rated-by-buyer">
                                                         
                                                      </span>
                                                      <p class="header-base rating-header"><span class="title-text">{{seller_review.0.s_review_from_username|title}} left a {{seller_review.0.average_val|length }}-star review</span><i class="time-stamp"> {{seller_review.0.review_date|date:' M d, Y h:i a'}}</i></p>
                                                   </label>
                                                </div>
                                             </div>
                                             <div class="activity-collapsible-content">
                                                <div style="max-height: unset; overflow: unset;">
                                                   <div>
                                                      <article class="activity-body">
                                                         <div class="rating-activity"> 
                                                            <section class="card-wrap">
                                                               <header class="card-header"><span class="card-title">{{seller_review.0.s_review_from_username|title}} Review</span> </header>
                                                               <div class="card-content">
                                                                  <div class="user-message">
                                                                     <a href="/user/profile/{{seller_review.0.s_review_from_username}}" class="stamp link">
                                                                        <div class="user-profile-image"><label class="profile-pict" for="profile_image_3129758391266" style="width: 40px; height: 40px; font-size: 1em;"><img src="{{seller_review.0.s_review_from_img}}" class="profile-pict-img" alt="{{seller_review.0.s_review_from_username}}"></label></div>
                                                                     </a>
                                                                     <div class="message-column">
                                                                        <p>
                                                                        <div class="flex">
                                                                           <span class="username">{{seller_review.0.s_review_from_username }}</span>
                                                                           <div class="flex">
                                                                              <div class="orca-rating color-yellow tbody-6">
                                                                                 <div class="stars">
                                                                                    {% for avera in seller_review.0.average_val %}
                                                                                       <span class="zv900so orca-star" aria-hidden="true" style="width: 15px; height: 15px;">
                                                                                          <svg width="16" height="15" viewBox="0 0 16 15" xmlns="http://www.w3.org/2000/svg">
                                                                                             <path fill-rule="evenodd" clip-rule="evenodd" d="M16 5.81285C16 5.98299 15.875 6.14367 15.75 6.26654L12.2596 9.61248L13.0865 14.3384C13.0962 14.4045 13.0962 14.4612 13.0962 14.5274C13.0962 14.7732 12.9808 15 12.7019 15C12.5673 15 12.4327 14.9527 12.3173 14.8866L8 12.656L3.68269 14.8866C3.55769 14.9527 3.43269 15 3.29808 15C3.01923 15 2.89423 14.7732 2.89423 14.5274C2.89423 14.4612 2.90385 14.4045 2.91346 14.3384L3.74038 9.61248L0.240385 6.26654C0.125 6.14367 0 5.98299 0 5.81285C0 5.5293 0.298077 5.41588 0.538462 5.37807L5.36539 4.68809L7.52885 0.387524C7.61539 0.207939 7.77885 0 8 0C8.22115 0 8.38462 0.207939 8.47115 0.387524L10.6346 4.68809L15.4615 5.37807C15.6923 5.41588 16 5.5293 16 5.81285Z"></path>
                                                                                          </svg>
                                                                                       </span>
                                                                                    {% endfor %}
                                                                                 </div>
                                                                                 <b class="rating-score">{{seller_review.0.average_val |length}}</b>
                                                                              </div>
                                                                           </div>
                                                                        </div>
                                                                        </p>
                                                                        <p>{{seller_review.0.review_message }}</p>
                                                                     </div>
                                                                  </div>
                                                                  <ul>
                                                                     <li class="rating-row">
                                                                        <div class="rating-title">Communication With Seller</div>
                                                                        <div class="orca-rating color-yellow tbody-6">
                                                                           <div class="stars">
                                                                              {% for avera in seller_review.0.communication %}
                                                                              <span class="zv900so orca-star" aria-hidden="true" style="width: 15px; height: 15px;">
                                                                                 <svg width="16" height="15" viewBox="0 0 16 15" xmlns="http://www.w3.org/2000/svg">
                                                                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M16 5.81285C16 5.98299 15.875 6.14367 15.75 6.26654L12.2596 9.61248L13.0865 14.3384C13.0962 14.4045 13.0962 14.4612 13.0962 14.5274C13.0962 14.7732 12.9808 15 12.7019 15C12.5673 15 12.4327 14.9527 12.3173 14.8866L8 12.656L3.68269 14.8866C3.55769 14.9527 3.43269 15 3.29808 15C3.01923 15 2.89423 14.7732 2.89423 14.5274C2.89423 14.4612 2.90385 14.4045 2.91346 14.3384L3.74038 9.61248L0.240385 6.26654C0.125 6.14367 0 5.98299 0 5.81285C0 5.5293 0.298077 5.41588 0.538462 5.37807L5.36539 4.68809L7.52885 0.387524C7.61539 0.207939 7.77885 0 8 0C8.22115 0 8.38462 0.207939 8.47115 0.387524L10.6346 4.68809L15.4615 5.37807C15.6923 5.41588 16 5.5293 16 5.81285Z"></path>
                                                                                 </svg>
                                                                              </span>
                                                                              {% endfor %}
                                                                           </div>
                                                                           <b class="rating-score">{{seller_review.0.communication|length }}</b>
                                                                        </div>
                                                                     </li>
                                                                     <li class="rating-row">
                                                                        <div class="rating-title">Service as Described</div>
                                                                        <div class="orca-rating color-yellow tbody-6">
                                                                           <div class="stars">
                                                                              {% for avera in seller_review.0.recommendation %}
                                                                              <span class="zv900so orca-star" aria-hidden="true" style="width: 15px; height: 15px;">
                                                                                 <svg width="16" height="15" viewBox="0 0 16 15" xmlns="http://www.w3.org/2000/svg">
                                                                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M16 5.81285C16 5.98299 15.875 6.14367 15.75 6.26654L12.2596 9.61248L13.0865 14.3384C13.0962 14.4045 13.0962 14.4612 13.0962 14.5274C13.0962 14.7732 12.9808 15 12.7019 15C12.5673 15 12.4327 14.9527 12.3173 14.8866L8 12.656L3.68269 14.8866C3.55769 14.9527 3.43269 15 3.29808 15C3.01923 15 2.89423 14.7732 2.89423 14.5274C2.89423 14.4612 2.90385 14.4045 2.91346 14.3384L3.74038 9.61248L0.240385 6.26654C0.125 6.14367 0 5.98299 0 5.81285C0 5.5293 0.298077 5.41588 0.538462 5.37807L5.36539 4.68809L7.52885 0.387524C7.61539 0.207939 7.77885 0 8 0C8.22115 0 8.38462 0.207939 8.47115 0.387524L10.6346 4.68809L15.4615 5.37807C15.6923 5.41588 16 5.5293 16 5.81285Z"></path>
                                                                                 </svg>
                                                                              </span>
                                                                              {% endfor %}
                                                                           </div>
                                                                           <b class="rating-score">{{seller_review.0.recommendation|length }}</b>
                                                                        </div>
                                                                     </li>
                                                                     <li class="rating-row">
                                                                        <div class="rating-title">Buy Again or Recommend</div>
                                                                        <div class="orca-rating color-yellow tbody-6">
                                                                           <div class="stars">
                                                                              {% for avera in seller_review.0.service %}
                                                                                 <span class="zv900so orca-star" aria-hidden="true" style="width: 15px; height: 15px;">
                                                                                    <svg width="16" height="15" viewBox="0 0 16 15" xmlns="http://www.w3.org/2000/svg">
                                                                                       <path fill-rule="evenodd" clip-rule="evenodd" d="M16 5.81285C16 5.98299 15.875 6.14367 15.75 6.26654L12.2596 9.61248L13.0865 14.3384C13.0962 14.4045 13.0962 14.4612 13.0962 14.5274C13.0962 14.7732 12.9808 15 12.7019 15C12.5673 15 12.4327 14.9527 12.3173 14.8866L8 12.656L3.68269 14.8866C3.55769 14.9527 3.43269 15 3.29808 15C3.01923 15 2.89423 14.7732 2.89423 14.5274C2.89423 14.4612 2.90385 14.4045 2.91346 14.3384L3.74038 9.61248L0.240385 6.26654C0.125 6.14367 0 5.98299 0 5.81285C0 5.5293 0.298077 5.41588 0.538462 5.37807L5.36539 4.68809L7.52885 0.387524C7.61539 0.207939 7.77885 0 8 0C8.22115 0 8.38462 0.207939 8.47115 0.387524L10.6346 4.68809L15.4615 5.37807C15.6923 5.41588 16 5.5293 16 5.81285Z"></path>
                                                                                    </svg>
                                                                                 </span>
                                                                              {% endfor %}
                                                                           </div>
                                                                           <b class="rating-score">{{seller_review.0.service|length }}</b>
                                                                        </div>
                                                                     </li>
                                                                  </ul>
                                                                 {% if seller_review.0.seller_response|length == 0 %}
                                                                     <div class="activity-collapsible-content" id="response_div">
                                                                        <form id="form_response">
                                                                           <div class="LsC-Zuk p-r-0 form-text-area">
                                                                              <textarea maxlength="{{seller_resp_char}}" placeholder="give response for your review." id="text_response_mssg" required></textarea>
                                                                           </div>
                                                                           <span class="control-bar flex-end"><span class="text-counter" id="span_response_mssg">0 / {{seller_resp_char}}</span></span>
                                                                           <div class="col-lg-12" id="sub_resp_div">
                                                                              <input type="submit" class="mt-3 agqrXOY BvNepr1 r+NFCla co-white pay-button bg-co-green-700" id="btn_sub_response" value="Give Response">
                                                                           </div>
                                                                        </form>
                                                                     </div>
                                                                  {% else %}
                                                                     <div class="user-message response"  >
                                                                        <a href="/user/profile/{{seller_review.0.s_review_to_username}}" class="stamp link">
                                                                           <div class="user-profile-image"><label class="profile-pict" for="profile_image_3297531691274" style="width: 40px; height: 40px; font-size: 1em;"><img src="{{seller_review.0.s_review_to_img}}" class="profile-pict-img" alt="elasho"></label></div>
                                                                        </a>
                                                                        <div class="message-column">
                                                                        <p>
                                                                           <div class="flex"><span class="username"><span><a href="/user/profile/{{seller_review.0.s_review_to_username}}" class="username-url">Your</a></span>'s response:</span></div>
                                                                        </p>
                                                                        <p id="response_message">{{seller_review.0.seller_response}}</p>
                                                                        </div>
                                                                     </div>
                                                                     {% if buyer_review.0.review_message.strip|length == 0  %}
                                                                        {% if current_user == "Seller"  %}
                                                                        <div class="row tab7 mt-3 mb-5" >
                                                                           <div class="col-lg-12 seller_btn_review_div">
                                                                              <a class="mt-3 agqrXOY BvNepr1 r+NFCla co-white pay-button bg-co-green-700" href="/buyer_reviews/{{order_details.order_no}}" target="_self" id="seller_rev_btn">Give Feedback</a>
                                                                           </div>
                                                                        </div>
                                                                        {% endif %}
                                                                     {% endif %}
                                                                  {% endif %}
                                                               </div>
                                                            </section>
                                                         </div>
                                                      </article>
                                                   </div>
                                                </div>
                                             </div>
                                              <div id="seller_resp_div1">
                                                <div class="user-message response"  >
                                                   <a href="/user/profile/{{seller_review.0.s_review_to_username}}" class="stamp link">
                                                      <div class="user-profile-image"><label class="profile-pict" for="profile_image_3297531691274" style="width: 40px; height: 40px; font-size: 1em;"><img src="{{seller_review.0.s_review_to_img}}" class="profile-pict-img" alt="elasho"></label></div>
                                                   </a>
                                                   <div class="message-column">
                                                   <p>
                                                      <div class="flex"><span class="username"><span><a href="/user/profile/{{seller_review.0.s_review_to_username}}" class="username-url">Your</a></span>'s response:</span></div>
                                                   </p>
                                                   <p id="response_message">{{seller_review.0.seller_response}}</p>
                                                   </div>
                                                </div>
                                                <div class="row tab7 mt-3 mb-5" >
                                                   <div class="col-lg-12 seller_btn_review_div">
                                                      <a class="mt-3 agqrXOY BvNepr1 r+NFCla co-white pay-button bg-co-green-700" href="/buyer_reviews/{{order_details.order_no}}" target="_self" id="seller_rev_btn">Give Feedback</a>
                                                   </div>
                                                </div>
                                             </div>
                                          </article>
                                       </section>
                                       {% endif %}
                                       {% else %}  
                                          {% if current_user == "Buyer" %}
                                          <div class="row tab7 mt-3 mb-5" >
                                             <div class="col-lg-12 buyer_btn_review_div">
                                                <a class="mt-3 agqrXOY BvNepr1 r+NFCla co-white pay-button bg-co-green-700" href="/seller_reviews/{{order_details.order_no}}" target="_self" id="buyer_rev_btn">Give Feedback</a>
                                             </div>
                                          </div>
                                          {% endif %}
                                       {% endif %} 
                                       {% if current_user == "Buyer"  %} 
                                       {% if  buyer_review|length != 0 %}
                                          <section class="activity-wrap order-rated-by-seller">
                                             <article class="LF267+J H1pvagJ PpAciwT">
                                             <div class="AuUenGR activity-collapsible-title-wrapper">
                                                <div class="CLdO82Y">
                                                   <label>
                                                      <span class="stamp order-rated-by-seller"></span>
                                                      <p class="header-base rating-header"><span class="title-text"><span><a href="/user/profile/{{buyer_review.0.b_review_from_username}}" class="username-url">{{buyer_review.0.b_review_from_username}}</a></span> left you a {{buyer_review.0.average_val|length}}-star review</span><i class="time-stamp">{{ buyer_review.0.review_date|date:"M d, h:i A" }}</i></p>
                                                   </label>
                                                </div>
                                                <div class="aTcRZG+ activity-collapsible-chevron-wrapper">
                                                   <span class="lFICM06 qwVjRQp" aria-hidden="true" style="width: 14px; height: 14px;">
                                                      <svg width="8" height="16" viewBox="0 0 8 16" xmlns="http://www.w3.org/2000/svg">
                                                         <path d="M0.772126 1.19065L0.153407 1.80934C0.00696973 1.95578 0.00696973 2.19322 0.153407 2.33969L5.80025 8L0.153407 13.6603C0.00696973 13.8067 0.00696973 14.0442 0.153407 14.1907L0.772126 14.8094C0.918563 14.9558 1.156 14.9558 1.30247 14.8094L7.84666 8.26519C7.99309 8.11875 7.99309 7.88131 7.84666 7.73484L1.30247 1.19065C1.156 1.04419 0.918563 1.04419 0.772126 1.19065Z"></path>
                                                      </svg>
                                                   </span>
                                                </div>
                                             </div>
                                             <div class="activity-collapsible-content">
                                                <div style="max-height: unset; overflow: unset;">
                                                   <div>
                                                      <article class="activity-body">
                                                         <div class="rating-activity">
                                                            <section class="card-wrap">
                                                               <header class="card-header"><span class="card-title">{{ buyer_review.0.b_review_from_username}}'s Review</span> </header>
                                                               <div class="card-content">
                                                                  <div class="user-message">
                                                                     <a href="/user/profile/{{buyer_review.0.b_review_from_username}}" class="stamp link">
                                                                        <div class="user-profile-image"><label class="profile-pict" for="profile_image_8597941691280" style="width: 40px; height: 40px; font-size: 1em;"><img src="{{ buyer_review.0.b_review_from_img}}" class="profile-pict-img" alt="{{buyer_review.0.b_review_from_username}}"></label></div>
                                                                     </a>
                                                                     <div class="message-column">
                                                                        <p>
                                                                        <div class="flex">
                                                                           <span class="username"><span><a href="/user/profile/{{buyer_review.0.b_review_from_username}}" class="username-url">{{buyer_review.0.b_review_from_username}}</a></span>'s message</span>
                                                                           <div class="flex">
                                                                              <div class="orca-rating color-yellow tbody-6">
                                                                                 <div class="stars">
                                                                                    {% for review in buyer_review.0.average_val %}
                                                                                    <span class="zv900so orca-star" aria-hidden="true" style="width: 15px; height: 15px;">
                                                                                       <svg width="16" height="15" viewBox="0 0 16 15" xmlns="http://www.w3.org/2000/svg">
                                                                                          <path fill-rule="evenodd" clip-rule="evenodd" d="M16 5.81285C16 5.98299 15.875 6.14367 15.75 6.26654L12.2596 9.61248L13.0865 14.3384C13.0962 14.4045 13.0962 14.4612 13.0962 14.5274C13.0962 14.7732 12.9808 15 12.7019 15C12.5673 15 12.4327 14.9527 12.3173 14.8866L8 12.656L3.68269 14.8866C3.55769 14.9527 3.43269 15 3.29808 15C3.01923 15 2.89423 14.7732 2.89423 14.5274C2.89423 14.4612 2.90385 14.4045 2.91346 14.3384L3.74038 9.61248L0.240385 6.26654C0.125 6.14367 0 5.98299 0 5.81285C0 5.5293 0.298077 5.41588 0.538462 5.37807L5.36539 4.68809L7.52885 0.387524C7.61539 0.207939 7.77885 0 8 0C8.22115 0 8.38462 0.207939 8.47115 0.387524L10.6346 4.68809L15.4615 5.37807C15.6923 5.41588 16 5.5293 16 5.81285Z"></path>
                                                                                       </svg>
                                                                                    </span>
                                                                                    {% endfor %}
                                                                                 </div>
                                                                                 <b class="rating-score">{{buyer_review.0.average_val|length}}</b>
                                                                              </div>
                                                                           </div>
                                                                        </div>
                                                                        </p>
                                                                        <p>{{buyer_review.0.review_message}}
                                                                        </p>
                                                                     </div>
                                                                  </div>
                                                               </div>
                                                            </section>
                                                         </div>
                                                      </article>
                                                   </div>
                                                </div>
                                             </div>
                                             </article>
                                          </section>
                                       {% endif %}
                                       {% else %} 
                                       {% if  buyer_review|length != 0 %}
                                          <section class="activity-wrap order-rated-by-seller">
                                             <article class="LF267+J H1pvagJ PpAciwT">
                                             <div class="AuUenGR activity-collapsible-title-wrapper">
                                                <div class="CLdO82Y">
                                                   <label>
                                                      <span class="stamp order-rated-by-seller"></span>
                                                      <p class="header-base rating-header"><span class="title-text"><span><a href="/user/profile/{{buyer_review.0.b_review_from_username}}" class="username-url">You</a></span> left you a {{buyer_review.0.average_val|length}}-star review</span><i class="time-stamp">{{ buyer_review.0.review_date|date:"M d, h:i A" }}</i></p>
                                                   </label>
                                                </div>
                                                <div class="aTcRZG+ activity-collapsible-chevron-wrapper">
                                                   <span class="lFICM06 qwVjRQp" aria-hidden="true" style="width: 14px; height: 14px;">
                                                      <svg width="8" height="16" viewBox="0 0 8 16" xmlns="http://www.w3.org/2000/svg">
                                                         <path d="M0.772126 1.19065L0.153407 1.80934C0.00696973 1.95578 0.00696973 2.19322 0.153407 2.33969L5.80025 8L0.153407 13.6603C0.00696973 13.8067 0.00696973 14.0442 0.153407 14.1907L0.772126 14.8094C0.918563 14.9558 1.156 14.9558 1.30247 14.8094L7.84666 8.26519C7.99309 8.11875 7.99309 7.88131 7.84666 7.73484L1.30247 1.19065C1.156 1.04419 0.918563 1.04419 0.772126 1.19065Z"></path>
                                                      </svg>
                                                   </span>
                                                </div>
                                             </div>
                                             <div class="activity-collapsible-content">
                                                <div style="max-height: unset; overflow: unset;">
                                                   <div>
                                                      <article class="activity-body">
                                                         <div class="rating-activity">
                                                            <section class="card-wrap">
                                                               <header class="card-header"><span class="card-title">Your's Review</span> </header>
                                                               <div class="card-content">
                                                                  <div class="user-message">
                                                                     <a href="/user/profile/{{buyer_review.0.b_review_from_username}}" class="stamp link">
                                                                        <div class="user-profile-image"><label class="profile-pict" for="profile_image_8597941691280" style="width: 40px; height: 40px; font-size: 1em;"><img src="{{ buyer_review.0.b_review_from_img}}" class="profile-pict-img" alt="{{buyer_review.0.b_review_from_username}}"></label></div>
                                                                     </a>
                                                                     <div class="message-column">
                                                                        <p>
                                                                        <div class="flex">
                                                                           <span class="username"><span><a href="/user/profile/{{buyer_review.0.b_review_from_username}}" class="username-url">Your</a></span>'s message</span>
                                                                           <div class="flex">
                                                                              <div class="orca-rating color-yellow tbody-6">
                                                                                 <div class="stars">
                                                                                    {% for review in buyer_review.0.average_val %}
                                                                                    <span class="zv900so orca-star" aria-hidden="true" style="width: 15px; height: 15px;">
                                                                                       <svg width="16" height="15" viewBox="0 0 16 15" xmlns="http://www.w3.org/2000/svg">
                                                                                          <path fill-rule="evenodd" clip-rule="evenodd" d="M16 5.81285C16 5.98299 15.875 6.14367 15.75 6.26654L12.2596 9.61248L13.0865 14.3384C13.0962 14.4045 13.0962 14.4612 13.0962 14.5274C13.0962 14.7732 12.9808 15 12.7019 15C12.5673 15 12.4327 14.9527 12.3173 14.8866L8 12.656L3.68269 14.8866C3.55769 14.9527 3.43269 15 3.29808 15C3.01923 15 2.89423 14.7732 2.89423 14.5274C2.89423 14.4612 2.90385 14.4045 2.91346 14.3384L3.74038 9.61248L0.240385 6.26654C0.125 6.14367 0 5.98299 0 5.81285C0 5.5293 0.298077 5.41588 0.538462 5.37807L5.36539 4.68809L7.52885 0.387524C7.61539 0.207939 7.77885 0 8 0C8.22115 0 8.38462 0.207939 8.47115 0.387524L10.6346 4.68809L15.4615 5.37807C15.6923 5.41588 16 5.5293 16 5.81285Z"></path>
                                                                                       </svg>
                                                                                    </span>
                                                                                    {% endfor %}
                                                                                 </div>
                                                                                 <b class="rating-score">{{buyer_review.0.average_val|length}}</b>
                                                                              </div>
                                                                           </div>
                                                                        </div>
                                                                        </p>
                                                                        <p>{{buyer_review.0.review_message}}
                                                                        </p>
                                                                     </div>
                                                                  </div>
                                                               </div>
                                                            </section>
                                                         </div>
                                                      </article>
                                                   </div>
                                                </div>
                                             </div>
                                             </article>
                                          </section>
                                       {% endif %}
                                       {% endif %} 
                                       </div>
                                    </div>
                                {% endif %}  
                                
                                <footer class="inbox-link">
                                    <div>
                                       {% if  current_user == "Buyer" %}
                                          View <a class="blue-link" onclick="inbox_click('{{order_to.username}}');"> conversation </a> with {{order_to.username}} in your inbox
                                       {% elif  current_user == "Seller" %}
                                          View <a class="blue-link" onclick="inbox_click('{{order_by.username}}');"> conversation </a> with {{order_by.username}} in your inbox
                                       {% endif %}
                                       
                                    </div>
                                 </footer>
                             </div>
                        </div>
                        <div class="tab-pane" id="pendingtab">
                            <div class="order-details-tab wrap-box full-details-tab">
                                <div class="milestones-wrapper">
                                   <div class="header">
                                      <div class="info">
                                         <a class="gig-title tbody-6" title="{{seller_gig.0.gig_title}}" href="/gigs/{{seller_gig.0.gig_username}}/{{seller_gig.0.gig_title}}">{{seller_gig.0.gig_title}}</a>
                                         <div><span>Buyer:&nbsp;<a href="/user/profile/{{order_by.username}}">{{order_by.username}}</a> </span><span class="separator">|</span><span>Date ordered&nbsp;<i class="start-date">{{ order_details.order_date|date:"M d, h:i A" }}</i></span></div>
                                      </div>
                                      <span class="total-price">
                                         <p>Total price</p>
                                         <span class="price">${{buyer_price}}</span>
                                      </span>
                                   </div>
                                   <div class="order-number">Order number <span>#{{seller_gig.0.order_no}}</span></div>
                                   <div class="order-description">
                                      <div class="">{{offer_details.offer_desc}}</div>
                                   </div>
                                   <div class="order-table order-table-full-view">
                                      <header>
                                         <div class="table-row header-row"><span class="header-cell">Item</span><span class="header-cell">Qty.</span><span class="header-cell">Duration</span><span class="header-cell">Price</span></div>
                                      </header>
                                      <div class="table-body">
                                         <div class="table-row">
                                            <span class="package-cell">
                                               <h4 class="text-body-2">{{seller_gig.0.gig_title}}</h4>
                                               <ul>
                                                  <li class="flex p-b-4">
                                                     <span class="lFICM06 check-icon" aria-hidden="true" style="width: 16px; height: 16px;">
                                                        <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                                                           <path d="M13.6202 2.6083L5.4001 10.8284L2.37973 7.80805C2.23329 7.66161 1.99585 7.66161 1.84939 7.80805L0.96551 8.69193C0.819073 8.83836 0.819073 9.0758 0.96551 9.22227L5.13492 13.3917C5.28135 13.5381 5.51879 13.5381 5.66526 13.3917L15.0344 4.02252C15.1809 3.87608 15.1809 3.63865 15.0344 3.49218L14.1505 2.6083C14.0041 2.46186 13.7667 2.46186 13.6202 2.6083Z"></path>
                                                        </svg>
                                                     </span>
                                                     <div class="" style="line-height:75px;">{{offer_details.no_revisions}} Revisions</div>
                                                         {% for extra in offer_extra %}
                                                            {% if extra.value != 'true' %}
                                                               <span class="lFICM06 check-icon" aria-hidden="true" style="width: 16px; height: 16px;">
                                                                  <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                                                                     <path d="M13.6202 2.6083L5.4001 10.8284L2.37973 7.80805C2.23329 7.66161 1.99585 7.66161 1.84939 7.80805L0.96551 8.69193C0.819073 8.83836 0.819073 9.0758 0.96551 9.22227L5.13492 13.3917C5.28135 13.5381 5.51879 13.5381 5.66526 13.3917L15.0344 4.02252C15.1809 3.87608 15.1809 3.63865 15.0344 3.49218L14.1505 2.6083C14.0041 2.46186 13.7667 2.46186 13.6202 2.6083Z"></path>
                                                                  </svg>
                                                               </span>
                                                               <div class="" style="line-height:75px;">{{extra.value}} - {{extra.name|title}}</div>
                                                            {% else %}
                                                               <span class="lFICM06 check-icon" aria-hidden="true" style="width: 16px; height: 16px;">
                                                                  <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                                                                     <path d="M13.6202 2.6083L5.4001 10.8284L2.37973 7.80805C2.23329 7.66161 1.99585 7.66161 1.84939 7.80805L0.96551 8.69193C0.819073 8.83836 0.819073 9.0758 0.96551 9.22227L5.13492 13.3917C5.28135 13.5381 5.51879 13.5381 5.66526 13.3917L15.0344 4.02252C15.1809 3.87608 15.1809 3.63865 15.0344 3.49218L14.1505 2.6083C14.0041 2.46186 13.7667 2.46186 13.6202 2.6083Z"></path>
                                                                  </svg>
                                                               </span>
                                                               <div class="" style="line-height:75px;">{{extra.name|title}}</div>
                                                            {% endif %}
                                                         {% endfor %}
                                                  </li>
                                               </ul>
                                            </span>
                                            <span class="quantity-cell">1</span><span class="">{{offer_details.offer_time}} days</span><span>${{seller_gig.0.gig_offer_amount}}</span>
                                         </div>
                                      </div>
                                      {% if extra_offer|length != 0 %}
                                      <header>
                                       <div class="table-row header-row"><span class="header-cell" style="text-align:left;">Extra Gigs</span></div>
                                       {% for extra_off in extra_offer %}
                                       {% if extra_off.gig_extra_package.extra_gig_title|length != 0 %}
                                       <div class="table-body">
                                          <div class="table-row">
                                             <span class="package-cell">
                                                <h4 class="text-body-2">{{extra_off.gig_extra_package.extra_gig_title}}</h4>
                                                <ul>
                                                   <li class="flex p-b-4">
                                                      <span class="lFICM06 check-icon" aria-hidden="true" style="width: 16px; height: 16px;">
                                                         <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M13.6202 2.6083L5.4001 10.8284L2.37973 7.80805C2.23329 7.66161 1.99585 7.66161 1.84939 7.80805L0.96551 8.69193C0.819073 8.83836 0.819073 9.0758 0.96551 9.22227L5.13492 13.3917C5.28135 13.5381 5.51879 13.5381 5.66526 13.3917L15.0344 4.02252C15.1809 3.87608 15.1809 3.63865 15.0344 3.49218L14.1505 2.6083C14.0041 2.46186 13.7667 2.46186 13.6202 2.6083Z"></path>
                                                         </svg>
                                                      </span>
                                                      
                                                   </li>
                                                </ul>
                                             </span>
                                             <span class="quantity-cell">1</span><span class="">{{extra_off.gig_extra_package.extra_gig_duration}} days</span><span>${{extra_off.gig_extra_package.extra_gig_price}}</span>
                                          </div>
                                       </div>
                                       {% else %}
                                       <div class="table-body">
                                          <div class="table-row">
                                             <span class="package-cell">
                                                <h4 class="text-body-2">Extra Delivery</h4>
                                                <ul>
                                                   <li class="flex p-b-4">
                                                      <span class="lFICM06 check-icon" aria-hidden="true" style="width: 16px; height: 16px;">
                                                         <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M13.6202 2.6083L5.4001 10.8284L2.37973 7.80805C2.23329 7.66161 1.99585 7.66161 1.84939 7.80805L0.96551 8.69193C0.819073 8.83836 0.819073 9.0758 0.96551 9.22227L5.13492 13.3917C5.28135 13.5381 5.51879 13.5381 5.66526 13.3917L15.0344 4.02252C15.1809 3.87608 15.1809 3.63865 15.0344 3.49218L14.1505 2.6083C14.0041 2.46186 13.7667 2.46186 13.6202 2.6083Z"></path>
                                                         </svg>
                                                      </span>
                                                      
                                                   </li>
                                                </ul>
                                             </span>
                                             <span class="quantity-cell">1</span><span class="">{{extra_off.gig_extra_delivery.delivery_in}} days</span><span>${{extra_off.gig_extra_delivery.extra_price}}</span>
                                          </div>
                                       </div>
                                       {% endif %}
                                       {% endfor %}
                                    </header>
                                    {% endif %}
                                      <footer>
                                         <div class="table-row"><span>total</span><span></span><span>${{seller_gig.0.order_amount}}</span></div>
                                      </footer>
                                   </div>
                                </div>
                             </div>
                        </div>
                        <div class="tab-pane" id="modificationtab">
                            <div class="requirements-tab">
                              {% if requirements|length != 0 %}
                                <div class="answered-requirements single">
                                   <ol class="answered-list">
                                    {% for req_det in requirements %}
                                       {% if req_det.default_req == True %}
                                          <li>
                                             <h6 class="text-display-7">{{req_det.requirement_ques}} </h6>
                                             <p>DETAILS PROVIDED </p>
                                          </li>
                                      {% else %}
                                          <li>
                                             <h6 class="text-display-7">{{req_det.requirement_ques}} </h6>
                                             <p>{{req_det.requirement_ans}}  </p>
                                             <div class="requirment_imags">
                                             {% if req_det.req_documents|length != 0 %}
                                             <div class="attachments-preview-component"><div class="thumbnails-header"><h3>ATTACHMENTS</h3></div>
                                             <ul class="attchments-container">
                                                {% for doc in req_det.req_documents %}
                                                <li class="thumbnail-preview" onclick="attachfile_onclick(this);" title="{{doc.doc}}" data-label= "/media/buyer_requirements/{{doc.doc.strip}}"><a class="thumbnail-link" href="/media/buyer_requirements/{{doc.doc.strip}}" target="_blank"><span class="fa fa-file-o fileicon" ></span></a><div class="action-bar flex flex-between"><div class="flex flex-center"><div class="attachment-name-container"><p class="attachment-name" title="'+value1+'">...{{doc.doc|slice:'20:'}}</p></div><span class="attachment-size"></span></div><div class="flex flex-center m-l-8"><a href="'+file_path+'" download class="download-button m-r-8"><span><i class="fa fa-download" aria-hidden="true"></i></span></a></div></div></li>
                                                {% endfor %}
                                             </ul></div>
                                             {% endif %}
                                             <div>
                                          </li>
                                       {% endif %}
                                    {% endfor %}
                                   </ol>
                                </div>
                              {% else %}
                              <div class="answered-requirements single">
                                 <ol class="answered-list">
                                    <li>
                                       <h6 class="text-display-7">{{req_det.requirement_ques}} </h6>
                                       <p>No Requirements Requested. </p>
                                    </li>
                                 </ol>
                              </div>
                              {% endif %}
                             </div>
                        </div>
                        <div class="tab-pane deliverytab" id="deliverytab">
                           <div class="requirements-tab">
                           <div class="answered-requirements single">
                              <p>
                                 {{delivery_details.0.delivery_message}}
                              </p>
                              <div class="delivery_images">
                                 {% if delivery_details.0.del_documents|length != 0 %}
                                    <div class="attachments-preview-component"><div class="thumbnails-header"><h3>ATTACHMENTS</h3></div>
                                    <ul class="attchments-container">
                                       {% for doc in delivery_details.0.del_documents %}
                                       <li class="thumbnail-preview" onclick="attachfile_onclick(this);" title="{{doc.doc}}" data-label= "/media/delivery/{{doc.doc.strip}}"><a class="thumbnail-link" href="/media/delivery/{{doc.doc.strip}}" target="_blank"><span class="fa fa-file-o fileicon" ></span></a><div class="action-bar flex flex-between"><div class="flex flex-center"><div class="attachment-name-container"><p class="attachment-name" title="'+value1+'">...{{doc.doc|slice:'20:'}}</p></div><span class="attachment-size"></span></div><div class="flex flex-center m-l-8"><a href="'+file_path+'" download class="download-button m-r-8"><span><i class="fa fa-download" aria-hidden="true"></i></span></a></div></div></li>
                                       {% endfor %}
                                    </ul></div>
                                 {% endif %}
                              </div>
                           </div>
                           <div class="info">
                              <div><span>Delivered by:&nbsp;<a href="/user/profile/{{delivery_details.0.delivered_by_user}}">{{delivery_details.0.delivered_by_user}}</a> </span><span class="separator">|</span><span>Date delivered&nbsp;<i class="start-date">{{ delivery_details.0.delivery_date|date:"M d, h:i A" }}</i></span></div>
                           </div>
                        </div>
                       </div>
                    </div>
                    
                </div>     
             </div>
          </div>
       </div>
       <div class="col-3 text-center p-0 mt-3 mb-2">
         
        <div class="col-12-xs col-4-md col-3-lg sidebar">
         
            {% if seller_gig.0.order_status == 'late' or  seller_gig.0.order_status == 'resolution' or seller_gig.0.order_status == 'progress' or seller_gig.0.order_status == 'delivered' %}
            <div class="wrap-box m-b-16 sidebar-padding">
              
               <div class="delivery-countdown">
                  <header>
                     <h6 class="co-grey-1100 header-text m-r-4 countdown-title">Time left to deliver</h6> 
                  </header>
                  <div class="flex-center flex-between m-t-12 m-b-16" id="time_indicator">
                     {% if seller_gig.0.formatted_due_date != 'failed' %}
                        <div class="flipper" data-datetime="{{seller_gig.0.formatted_due_date}} 00:00:00" data-template="dd|HH|ii|ss" data-labels="Days|Hours|Minutes|Seconds"
                        data-reverse="true"  id="due_timer"></div>
                     {% else %} 
                     <div class="flipper red_mark" > 
                        <div class="flipper-group flipper-dd"><label>Days</label><div class="flipper-digit reverse" data-value="0"><div class="digit-next"></div><div class="digit-bottom">0</div><div class="digit-top2">0</div><div class="digit-top">0</div><div class="digit-face active">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">3</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div></div><div class="flipper-delimiter"></div><div class="flipper-digit reverse" data-value="1"><div class="digit-next"></div><div class="digit-bottom">0</div><div class="digit-top2">0</div><div class="digit-top">0</div><div class="digit-face">0</div><div class="digit-face active">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div></div></div>  
                        <div class="flipper-group flipper-delimiter">:</div>
                        <div class="flipper-group flipper-dd"><label>Hours</label><div class="flipper-digit reverse" data-value="0"><div class="digit-next"></div><div class="digit-bottom">0</div><div class="digit-top2">0</div><div class="digit-top">0</div><div class="digit-face active">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">3</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div></div><div class="flipper-delimiter"></div><div class="flipper-digit reverse" data-value="1"><div class="digit-next"></div><div class="digit-bottom">0</div><div class="digit-top2">0</div><div class="digit-top">0</div><div class="digit-face">0</div><div class="digit-face active">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div></div></div>  
                        <div class="flipper-group flipper-delimiter">:</div>
                        <div class="flipper-group flipper-dd"><label>Minutes</label><div class="flipper-digit reverse" data-value="0"><div class="digit-next"></div><div class="digit-bottom">0</div><div class="digit-top2">0</div><div class="digit-top">0</div><div class="digit-face active">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">3</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div></div><div class="flipper-delimiter"></div><div class="flipper-digit reverse" data-value="1"><div class="digit-next"></div><div class="digit-bottom">0</div><div class="digit-top2">0</div><div class="digit-top">0</div><div class="digit-face">0</div><div class="digit-face active">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div></div></div>  
                        <div class="flipper-group flipper-delimiter">:</div>
                        <div class="flipper-group flipper-dd"><label>Seconds</label><div class="flipper-digit reverse" data-value="0"><div class="digit-next"></div><div class="digit-bottom">0</div><div class="digit-top2">0</div><div class="digit-top">0</div><div class="digit-face active">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">3</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div></div><div class="flipper-delimiter"></div><div class="flipper-digit reverse" data-value="1"><div class="digit-next"></div><div class="digit-bottom">0</div><div class="digit-top2">0</div><div class="digit-top">0</div><div class="digit-face">0</div><div class="digit-face active">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div><div class="digit-face">0</div></div></div>  
                     </div>
                     {% endif %}                 
                  </div>
                  {% if request.user.username == order_to.username %}
                  {% if delivery != 'yes' %}
                     <div class="m-t-12"><button class="ORLWF8p _0MkXbqi i6NB5Ls co-white delivery-button bg-co-green-700" id="btn_delivery_now">Deliver Now</button></div> 
                  {% else %} 
                     <div class="m-t-12"><button class="ORLWF8p _0MkXbqi i6NB5Ls co-white delivery-button bg-co-green-700" id="btn_delivery_now">Deliver Again</button></div> 
                  {% endif %} 
                  {% endif %}
               </div>
            </div>
            {% endif %}
            
            <div class="wrap-box m-b-16 p-0">
               <div class="has-shadow">
                  <aside class="order-summary sidebar-padding">
                     <article class="LF267+J H1pvagJ PpAciwT order-summary-collapsible-container">
                        <div class="AuUenGR collapsible-title-wrapper">
                           <div class="CLdO82Y collapsible-title">
                              <header class="summary-header" id="order_details">
                                 <header class="flex-between m-b-4 header-menu">
                                    <h6 class="co-grey-1100 header-text">Order Details</h6>
                                 </header>
                                 <div class="flex-start gig-header m-t-4">
                                    <a href="/gigs/{{seller_gig.0.gig_user}}/{{seller_gig.0.gig_title}}" class="gig-image-link"><img src="{{seller_gig.0.gig_image}}" alt="Late" class="gig-image"></a>
                                    <div class="flex-around m-l-12 gig-title-text-container">
                                       <a class="gig-title tbody-6" title="I will build your web applications with no bound of limits welcome" href="/gigs/{{seller_gig.0.gig_username}}/{{seller_gig.0.gig_title}}">{{seller_gig.0.gig_title |title}}</a>
                                       <div class="status flex-start">
                                          {% if seller_gig.0.order_status == 'late' %}
                                             <div class="order-status late_delivery_no_res">Late</div>
                                          {% elif  seller_gig.0.order_status == "resolution" %}
                                             <div class="order-status in_resolution">Resolution Opened</div>
                                          {% elif  seller_gig.0.order_status == "delivered" %}
                                             <div class="order-status in_progress">Delivered</div>
                                          {% elif  seller_gig.0.order_status == "completed" %}
                                             <div class="order-status in_progress">Completed</div>
                                          {% elif  seller_gig.0.order_status == "progress" %}
                                             <div class="order-status in_progress">In progress</div>
                                          {% elif  seller_gig.0.order_status == "cancel" %}
                                             <div class="order-status in_progress">Cancelled</div>
                                          {% endif %}
                                          
                                       </div>
                                    </div>
                                 </div>
                              </header>
                           </div>
                         
                        </div>
                        <div class="collapsible-content">
                           <ul class="summary-content m-t-16 m-b-16">
                              <li>
                                 Ordered by
                                 <div class="flex-center">
                                   
                                    <a href="/user/profile/{{order_by.username}}" target="_blank" class="name-data data-column">{{order_by.username |title}}</a>
                                 </div>
                              </li>
                              <li>Delivery date<span class="data-column"><i>{{ seller_gig.0.due_date|date:"M d, h:i A" }}</i></span></li>
                              <li>Total price<span class="data-column price">${{buyer_price}}</span></li>
                              <li>Order number<span class="data-column">#{{seller_gig.0.order_no}}</span></li>
                           </ul>
                        </div>
                     </article>
                  </aside>
                  <div class="order-tracker sidebar-padding">
                     <article class="LF267+J order-tracker-collapsible-container">
                        <div class="AuUenGR collapsible-title-wrapper">
                           <div class="CLdO82Y">
                              <header class=" p-b-0">
                                 <h6 class="co-grey-1100 header-text">Track Order</h6>
                              </header>
                           </div>
                           
                        </div>
                     </article>
                     <ul class="sidebar-padding p-t-0 p-b-0">
                        <li class="tracker-station is-complete">
                           <div class="circle"></div>
                           <div class="description">
                              <h4>Order placed</h4>
                           </div>
                        </li>
                        <li class="tracker-station is-complete">
                           <div class="circle"></div>
                           <div class="description">
                              <h4>Requirements submitted </h4>
                           </div>
                        </li>
                        {% if seller_gig.0.order_status == "cancel" %}
                        
                        <li class="tracker-station is-complete">
                           <div class="circle"></div>
                           <div class="description">
                              <h4>Order in progress</h4>
                           </div>
                        </li>
                        <li class="tracker-station is-active">
                           <div class="circle"></div>
                           <div class="description">
                              <h4>Order Cancelled</h4>
                           </div>
                        </li>
                        {% elif delivery == 'yes' %}
                           {% if seller_gig.0.order_status == 'delivered' %}
                              <li class="tracker-station is-complete">
                                 <div class="circle"></div>
                                 <div class="description">
                                    <h4>Order in progress</h4>
                                 </div>
                              </li>
                              <li class="tracker-station is-active">
                                 <div class="circle"></div>
                                 <div class="description">
                                    <h4>Review delivery</h4>
                                 </div>
                              </li>
                           {% elif  seller_gig.0.order_status == 'completed' %}
                              <li class="tracker-station is-complete">
                                 <div class="circle"></div>
                                 <div class="description">
                                 <h4>Order in progress</h4>
                                 </div>
                              </li>
                              <li class="tracker-station is-complete">
                                 <div class="circle"></div>
                                 <div class="description">
                                    <h4>Review delivery</h4>
                                 </div>
                              </li>
                              <li class="tracker-station is-active">
                                 <div class="circle"></div>
                                    <div class="description">
                                       <h4>Completed order</h4>
                                    </div>
                              </li>
                           {% endif %}  
                           {% elif seller_gig.0.order_status == 'late' or  seller_gig.0.order_status == 'resolution' or seller_gig.0.order_status == 'progress' or seller_gig.0.order_status == 'delivered' %}
                              <li class="tracker-station is-active">
                                 <div class="circle"></div>
                                 <div class="description">
                                    <h4>Order in progress</h4>
                                 </div>
                              </li>
                        {% endif %}
                     </ul>
                  </div>
               </div>
            </div>
            <aside class="order-summary sidebar-padding wrap-box box-shadow-z2" id="faq_ques">
               <h3 class="tbody-5 text-semi-bold">Support</h3>
               <ul class="support-list">
                  <li class="item-wrapper">
                     <a href="/faq" target="_blank" rel="noreferrer" class="link p-t-16 p-b-16">
                        <span class="lFICM06 item-icon" aria-hidden="true" style="width: 16px; height: 16px;">
                           <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd" clip-rule="evenodd" d="M8 16C12.4183 16 16 12.4183 16 8C16 3.58172 12.4183 0 8 0C3.58172 0 0 3.58172 0 8C0 12.4183 3.58172 16 8 16ZM6.66669 6.2222C6.66669 5.99407 6.74244 5.63209 6.94361 5.35269C7.11215 5.11861 7.40085 4.88886 8.00003 4.88886C8.73426 4.88886 9.11567 5.27671 9.24475 5.66556C9.38071 6.07511 9.26479 6.53293 8.84029 6.81593C8.13871 7.28365 7.62193 7.73677 7.34968 8.37204C7.10944 8.93259 7.11027 9.54684 7.11105 10.1244L7.11114 10.2222H8.88892C8.88892 9.49449 8.90421 9.25784 8.98371 9.07235C9.04479 8.92984 9.19468 8.71629 9.82643 8.29513C10.9709 7.53217 11.2994 6.21221 10.932 5.10547C10.5577 3.97803 9.48801 3.11108 8.00003 3.11108C6.82143 3.11108 5.99902 3.62208 5.50089 4.31392C5.03539 4.96045 4.88892 5.70958 4.88892 6.2222H6.66669ZM8.88886 12.8889V11.1111H7.11108V12.8889H8.88886Z"></path>
                           </svg>
                        </span>
                        <div class="item item-faq">
                           <div class="item-title tbody-5">FAQs</div>
                           <div class="subtitle tbody-6">Find needed answers.</div>
                        </div>
                        <span class="lFICM06 list-chevron" aria-hidden="true" style="width: 16px; height: 16px;">
                           <svg width="8" height="16" viewBox="0 0 8 16" xmlns="http://www.w3.org/2000/svg">
                              <path d="M0.772126 1.19065L0.153407 1.80934C0.00696973 1.95578 0.00696973 2.19322 0.153407 2.33969L5.80025 8L0.153407 13.6603C0.00696973 13.8067 0.00696973 14.0442 0.153407 14.1907L0.772126 14.8094C0.918563 14.9558 1.156 14.9558 1.30247 14.8094L7.84666 8.26519C7.99309 8.11875 7.99309 7.88131 7.84666 7.73484L1.30247 1.19065C1.156 1.04419 0.918563 1.04419 0.772126 1.19065Z"></path>
                           </svg>
                        </span>
                     </a>
                  </li>
                  {% if seller_gig.0.order_status == 'late' or  seller_gig.0.order_status == 'resolution' or seller_gig.0.order_status == 'progress' or seller_gig.0.order_status == 'delivered' %}
                  <li class="item-wrapper">
                     <a href="/user/{{order_by.username}}/manage_orders/{{order_details.order_no}}/resolution" class="link p-t-16">
                        <span class="lFICM06 item-icon" aria-hidden="true" style="width: 16px; height: 16px;">
                           <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                              <path d="M8 0C3.6 0 0 3.6 0 8C0 12.4 3.6 16 8 16C12.4 16 16 12.4 16 8C16 3.6 12.4 0 8 0ZM8 10C6.9 10 6 9.1 6 8C6 6.9 6.9 6 8 6C9.1 6 10 6.9 10 8C10 9.1 9.1 10 8 10ZM8 2C8.9 2 9.8 2.2 10.6 2.6L9.044 4.156C8.283 3.949 7.717 3.949 6.955 4.156L5.4 2.6C6.2 2.2 7.1 2 8 2ZM2 8C2 7.1 2.2 6.2 2.6 5.4L4.156 6.956C3.949 7.717 3.949 8.283 4.156 9.045L2.6 10.6C2.2 9.8 2 8.9 2 8ZM8 14C7.1 14 6.2 13.8 5.4 13.4L6.956 11.844C7.717 12.051 8.283 12.051 9.045 11.844L10.6 13.4C9.8 13.8 8.9 14 8 14ZM13.4 10.6L11.844 9.044C12.051 8.283 12.051 7.717 11.844 6.955L13.4 5.4C13.8 6.2 14 7.1 14 8C14 8.9 13.8 9.8 13.4 10.6Z"></path>
                           </svg>
                        </span>
                        <div class="item item-resolution">
                           <div class="item-title tbody-5">Resolution Center</div>
                           <div class="subtitle tbody-6">Resolve order issues.</div>
                        </div>
                        <span class="lFICM06 list-chevron" aria-hidden="true" style="width: 16px; height: 16px;">
                           <svg width="8" height="16" viewBox="0 0 8 16" xmlns="http://www.w3.org/2000/svg">
                              <path d="M0.772126 1.19065L0.153407 1.80934C0.00696973 1.95578 0.00696973 2.19322 0.153407 2.33969L5.80025 8L0.153407 13.6603C0.00696973 13.8067 0.00696973 14.0442 0.153407 14.1907L0.772126 14.8094C0.918563 14.9558 1.156 14.9558 1.30247 14.8094L7.84666 8.26519C7.99309 8.11875 7.99309 7.88131 7.84666 7.73484L1.30247 1.19065C1.156 1.04419 0.918563 1.04419 0.772126 1.19065Z"></path>
                           </svg>
                        </span>
                     </a>
                  </li>
                  {% endif %}
               </ul>
            </aside>
         </div>
        </div
    </div>
 </div>

 <div class="modal" id="modal_delivery" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false" aria-labelledby="myModalLabel">
   <div class="modal-dialog modal-lg" role="document">
     <div class="modal-content">
       <div class="modal-header">
           <h1>Deliver your work</h1>
         <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
       </div>
       <div class="modal-body">
         <div class="row tab1" id="publish_social_div">
            <div class="col-lg-11 main_delivery_content">
               <div class="order-page">
                  <div class="seller">
                     <div class="delivery-form">
                        <div class="rzAP5-N text-area-container m-b-16 flex flex-col">
                           <div class="LsC-Zuk p-r-0 form-text-area"><textarea maxlength="{{delivery_char}}" placeholder="Describe your delivery in details" id="text_delivery_messsg" required></textarea>
                              
                           </div>
                           <span class="control-bar flex-end"><span class="text-counter"   id="span_delivery_messsg">0 / {{delivery_char}}</span></span>
                        </div>
                        <div class="attachment-buttons">
                           <div class="e4rLWCQ _1DtaAoI upload-attachment-tooltip">
                              <span class="FPMjOVo">
                              <label for="delivery_file" class="ORLWF8p T2YhX76 co-grey-1100 attachments-button bg-co-grey-300" delay="120" content="[object Object]" position="top" boxclassname="LIc0-hX" boxcontentclassname="l9wFBjm">
                                 <input  type="file" id="delivery_file"  accept="*" >
                                 <span class="_1AB8XqH upload-button-icon" aria-hidden="true" style="width: 14px; height: 14px;">
                                    <svg width="13" height="14" viewBox="0 0 13 14" xmlns="http://www.w3.org/2000/svg">
                                       <path fill-rule="evenodd" clip-rule="evenodd" d="M1.23276 12.7969C0.691092 12.2865 0.326868 11.6803 0.140086 10.9785C-0.0466954 10.2767 -0.0466954 9.57943 0.140086 8.88672C0.326868 8.19401 0.691092 7.59245 1.23276 7.08203L7.53664 0.902344C7.92888 0.519531 8.4005 0.255208 8.95151 0.109375C9.50251 -0.0364583 10.0535 -0.0364583 10.6045 0.109375C11.1555 0.255208 11.6365 0.524089 12.0474 0.916016C12.4583 1.30794 12.7385 1.77279 12.8879 2.31055C13.0374 2.84831 13.0374 3.38607 12.8879 3.92383C12.7385 4.46159 12.4583 4.93099 12.0474 5.33203L6.75216 10.5273C6.30388 10.9466 5.77155 11.1562 5.15517 11.1562C4.53879 11.1562 4.00647 10.9421 3.55819 10.5137C3.10991 10.0853 2.88578 9.57031 2.88578 8.96875C2.88578 8.36719 3.10991 7.84766 3.55819 7.41016L8.06897 3.00781C8.125 2.95312 8.19971 2.92578 8.2931 2.92578C8.38649 2.92578 8.46121 2.95312 8.51724 3.00781L8.99354 3.47266C9.06825 3.54557 9.1056 3.6276 9.1056 3.71875C9.1056 3.8099 9.06825 3.88281 8.99354 3.9375L4.51078 8.33984C4.32399 8.50391 4.2306 8.70898 4.2306 8.95508C4.2306 9.20117 4.32399 9.41081 4.51078 9.58398C4.69756 9.75716 4.91703 9.84375 5.16918 9.84375C5.42134 9.84375 5.63147 9.76172 5.79957 9.59766L11.1228 4.40234C11.4777 4.05599 11.6552 3.63216 11.6552 3.13086C11.6552 2.62956 11.4731 2.20117 11.1088 1.8457C10.7446 1.49023 10.3057 1.3125 9.79203 1.3125C9.27838 1.3125 8.83477 1.48568 8.46121 1.83203L2.15733 7.98438C1.61566 8.53125 1.34483 9.18294 1.34483 9.93945C1.34483 10.696 1.62033 11.3431 2.17134 11.8809C2.72234 12.4186 3.38542 12.6875 4.16056 12.6875C4.9357 12.6875 5.60345 12.4141 6.16379 11.8672L11.6272 6.50781C11.7019 6.45312 11.7859 6.42578 11.8793 6.42578C11.9727 6.42578 12.0474 6.45312 12.1034 6.50781L12.5797 6.97266C12.6545 7.04557 12.6918 7.1276 12.6918 7.21875C12.6918 7.3099 12.6545 7.38281 12.5797 7.4375L7.11638 12.7969C6.57471 13.3255 5.94899 13.681 5.23922 13.8633C4.52945 14.0456 3.81501 14.0456 3.09591 13.8633C2.3768 13.681 1.75575 13.3255 1.23276 12.7969Z"></path>
                                    </svg>
                                 </span>
                                 Upload work
                              </label>
                           </span>
                        </div>
                        </div>
                        <div class="_2g7EPin custom-order-package-tooltip" id="image_list">
    
                        </div>  
                        <div class="_2g7EPin custom-order-package-tooltip" id="d_file_progress_div">
    
                        </div>   
                        <div class="error-message">
                           <label class="error"> Please describe your delivery message.</label>
                        </div>
                     </div>
                     <div class="buttons-containers flex-end"><button class="ORLWF8p _7pUBXz- co-green-700 YxOH7gm bg-co-white" id="btn_save_draft">Save Draft</button><button class="ORLWF8p _0MkXbqi co-white bg-co-green-700" id="btn_delivery_submit">Deliver</button></div>
                  </div>
               </div>
            </div>
       </div>
     </div>
   </div>
 </div>
</div>


<div class="modal" id="modal_cancel" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false" aria-labelledby="myModalLabel">
   <div class="modal-dialog modal-lg" role="document">
     <div class="modal-content">
       <div class="modal-header">
           <h1>Request Cancellation Wizard</h1>
         <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
       </div>
       <div class="modal-body">
         <div class="row tab1" id="publish_social_div">
            <div class="col-lg-11 main_delivery_content">
               <div class="order-page">
                  <div class="seller">
                     <div class="cancel-form">
                        <input type="hidden" id="resl_id" value="">
                        <input type="hidden" id="resl_type" value="">
                        <div class="rzAP5-N text-area-container m-b-16 flex flex-col">
                           <div class="LsC-Zuk p-r-0 form-text-area"><textarea maxlength="{{cancel_char}}" placeholder="Describe your cancellation in details" id="text_cancel_messsg" required></textarea>
                              
                           </div>
                           <span class="control-bar flex-end"><span class="text-counter"   id="span_cancel_messsg">0 / {{cancel_char}}</span></span>
                        </div>
                      
                        </div>
                      
                       
                        <div class="canl-error-message">
                           <label class="error"> Please describe your cancellation message.</label>
                        </div>
                     </div>
                     <div class="buttons-containers flex-end">
					 <button class="ORLWF8p _0MkXbqi co-white bg-co-green-700" id="btn_cancel_submit">Submit</button></div>
                  </div>
               </div>
            </div>
       </div>
     </div>
   </div>
 </div>
</div>
{% if  current_user == "Buyer" %}
      {% include  'Dashboard/base_buyer.html' %}
{% elif  current_user == "Seller" %}
      {% include  'Dashboard/base_seller.html' %}
{% endif %}

<script src="{% static 'assets/js/select2.min.js' %}"></script>
<script src="{% static 'assets/js/jquery.flipper-responsive.js' %}"></script>
<link rel="stylesheet" type="text/css" media="screen" href="{% static 'assets/css/frontend/jquery.emojipicker.css' %}" />
<script src="{% static 'assets/js/jquery.emojipicker.js' %}"></script>
<link rel="stylesheet" type="text/css" media="screen" href="{% static 'assets/css/frontend/jquery.emojipicker.tw.css' %}" />
<script src="{% static 'assets/js/jquery.emojis.js' %}"></script>
<style>
   #btn_save_draft:disabled, #btn_delivery_submit:disabled, #btn_cancel_submit:disabled{
      cursor: not-allowed;
      cursor: -moz-not-allowed;
      cursor: -webkit-not-allowed;
  }
   .order-summary .status .in_resolution
   {
      font-size:8px !important;
   }
   a.username-url,.user-message p
   {
      text-transform:capitalize;
   }
</style>
<script>
   function formatDate(date) {
      var monthNames =  ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'June', 'July', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'];
      var hours = date.getHours();
      var minutes = date.getMinutes();
      var _date = date.getDate();
      var month = date.getMonth();
      var year = date.getFullYear();
      var d = new Date();
      var curr_year = d.getFullYear();    
      var ampm = hours >= 12 ? 'pm' : 'am';
      hours = hours % 12;
      hours = hours ? hours : 12; // the hour '0' should be '12'
      minutes = minutes < 10 ? '0'+minutes : minutes;
      var strTime = '';
      strTime =  monthNames[month] + " " + _date+ ", " + year ;  
      return strTime;
    }

    const relativeTimePeriods = [
    [31536000, 'year'],
    [2419200, 'month'],
    [604800, 'week'],
    [86400, 'day'],
    [3600, 'hour'],
    [60, 'minute'],
    [1, 'second']
];

function relativeTime(date, isUtc=false) {
    if (!(date instanceof Date)) date = new Date(date * 1000);
    var seconds = (new Date() - date) / 1000;
    seconds = parseInt(seconds) - parseInt(12606);
    for (let [secondsPer, name] of relativeTimePeriods) {
        if (seconds >= secondsPer) {
            const amount = Math.floor(seconds / secondsPer);
            return `${amount} ${name}${amount ? 's' : ''} ago`;
        }
    }
    return 'Just now';
}
   
   function formatAMPM(date) {
      var monthNames =  ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'June', 'July', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'];
      var hours = date.getHours();
      var minutes = date.getMinutes();
      var _date = date.getDate();
      var month = date.getMonth();
      var year = date.getFullYear();
      var d = new Date();
      var curr_year = d.getFullYear();   
      var curr_month = d.getMonth(); 
      var curr_day = d.getDate(); 
      var ampm = hours >= 12 ? 'pm' : 'am';
      hours = hours % 12;
      hours = hours ? hours : 12; // the hour '0' should be '12'
      minutes = minutes < 10 ? '0'+minutes : minutes;
      var strTime = '';
      if(curr_year != year)
      {
         strTime =  monthNames[month] + " " + _date+ ", " + year + hours + ':' + minutes + ' ' + ampm; 
      }
      else if(curr_year == year  && curr_month == month && curr_day == _date )
      {
         strTime = relativeTime(date)
      }
      else{
         strTime = monthNames[month]  + " " + _date+ ", " + hours + ':' + minutes + ' ' + ampm;  
      }   
      return strTime;
    }
    function get_url_text(text_format)
    {
       var exp = /(?:(?:https?|ftp|file):\/\/|www\.|ftp\.)(?:\([-A-Z0-9+&@#/%=~_|$?!:,.]*\)|[-A-Z0-9+&@#/%=~_|$?!:,.])*(?:\([-A-Z0-9+&@#/%=~_|$?!:,.]*\)|[A-Z0-9+&@#/%=~_|$])/ig;
       var replaced_text = text_format.replace(exp, function(url) {
          if (url.startsWith("www.")) {
             url = "https://"+url;
          }else{
             url = url;
          }
          clean_url = url.replace(/https?:\/\//gi,'');
          return '<a href="' + url + '" target="_blank">' + clean_url + '</a>';
       });
       return replaced_text;
    }
   $(document).ready(function(){
      $("#message_errors").hide();
      $("#seller_resp_div1").hide();
      jsonObj1 = eval($("#chat_words_hidd").val());
      five_jsonObj1 = eval($("#five_chat_words_hidd").val());
      $.ajax({
         type:"GET",
         url: "/get_all_order_messages/",
         data: {"conver_id":$("#conversation_id").val(),"order_no":'{{order_details.order_no}}',"current_count":10,"id_list":"start"},
         success: function(data) 
         {
            if(parseInt(data.total_count) < 10)
            {
               $("#h_previous_mssg").hide();
            }
            else{
               $("#h_previous_mssg").show();
            }
            $("#total_chat_count").val(data.total_count);
            $("#current_count").val(data.current_count);
            $("#message_ids").val(data.message_ids);
            array_list = $("#message_ids").val().split(",");

            $.each(data.data, function(i, v) {
               array_list = jQuery.grep(array_list, function(value) {
                  return value !=  v.mssg_id;
               });
               if(v.attachment != "None" && v.res_type == null)
               {
                  attachments = v.attachment.trim().split(",");
                  attachment_txt = '<div class="attachments-preview-component"><div class="thumbnails-header"><h3>ATTACHMENTS</h3></div><ul class="attchments-container">';
                  $.each(attachments, function (key, value) {
                     if(value.trim().length != 0)
                     {
                        file_path = '/media/order_files/'+value.trim();
                        attachment_txt += '<li class="thumbnail-preview" onclick="attachfile_onclick(this);" title="'+value+'" data-label= "'+file_path+'"><a class="thumbnail-link" href="'+file_path+'" target="_blank"><span class="fa fa-file-o fileicon" ></span></a><div class="action-bar flex flex-between"><div class="flex flex-center"><div class="attachment-name-container"><p class="attachment-name" title="'+value+'">...'+value.slice(-20)+'</p></div><span class="attachment-size"></span></div><div class="flex flex-center m-l-8"><a href="'+file_path+'" download class="download-button m-r-8"><span><i class="fa fa-download" aria-hidden="true"></i></span></a></div></div></li>';
                     }
                  });
                  attachment_txt += '</ul></div>';
                  if('{{request.user.username}}' == v.sender_username)
                  {
                     $("#message_wrap_box").append('<section class="activity-wrap is-message message-sent"> <article class="LF267+J H1pvagJ PpAciwT"> <div class="AuUenGR activity-collapsible-title-wrapper"> <div class="CLdO82Y"> <label> <a href="/user/profile/'+v.sender_username+'" class="stamp link message-sent"> <div class="user-profile-image"> <label class="profile-pict" for="profile_image_8475174845636" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a> <p class="header-base "><span class="title-text"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span> sent you a message</span><i class="time-stamp">'+formatAMPM(new Date(v.timestamp))+'</i></p> </label> </div> </div> <div class="activity-collapsible-content"> <article class="activity-body"> <div style="max-height: unset; overflow: unset;"> <div> <div class="body-with-attachments"> <p class="message-content">'+ get_url_text(v.message) +'</p>'+attachment_txt+' </div> </div> </div> </article> </div> </article> </section>');
                  }
                  else{
                     $("#message_wrap_box").append('<section class="activity-wrap is-message message-received"> <article class="LF267+J H1pvagJ PpAciwT"> <div class="AuUenGR activity-collapsible-title-wrapper"> <div class="CLdO82Y"> <label> <a href="/user/profile/'+v.sender_username+'" class="stamp link message-sent"> <div class="user-profile-image"> <label class="profile-pict" for="profile_image_8475174845636" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a> <p class="header-base "><span class="title-text"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span> sent you a message</span><i class="time-stamp">'+formatAMPM(new Date(v.timestamp))+'</i></p> </label> </div> </div> <div class="activity-collapsible-content"> <article class="activity-body"> <div style="max-height: unset; overflow: unset;"> <div> <div class="body-with-attachments"> <p class="message-content">'+ get_url_text(v.message) +'</p> '+attachment_txt+' </div> </div> </div> </article> </div> </article> </section>');
                  } 
               }
               else{
                  if(v.mssg_type != "chat")
                  {
                     if('{{request.user.username}}' == v.reciever_username)
                     {
                        classtype = ''
                        message_type = ''
                        extensionmssg = ''
                        deliverymssg = ''
                        req_type= ''
                        buttons_txt = ''
                        cancel_mssg = ''
                        if(v.res_type.trim() == "cancel")
                        {
                           extensionmssg = ''
                           deliverymssg = ''
                           req_type= "cancel"
                           cancel_mssg = ''
                           if(v.res_status.trim() == "accepted")
                           {
                              classtype = '<span class="stamp order-completed"></span>'
                              message_type = 'Your order was cancelled'
                           }
                           else if(v.res_status.trim() == "rejected"){
                              classtype = '<span class="stamp resolution-declined mutual-cancellation"><span class="lFICM06 stamp-icon" aria-hidden="true" style="width: 18px; height: 18px;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 0.25C3.71875 0.25 0.25 3.71875 0.25 8C0.25 12.2812 3.71875 15.75 8 15.75C12.2812 15.75 15.75 12.2812 15.75 8C15.75 3.71875 12.2812 0.25 8 0.25ZM11.8 10.0344C11.9469 10.1813 11.9469 10.4187 11.8 10.5656L10.5625 11.8C10.4156 11.9469 10.1781 11.9469 10.0312 11.8L8 9.75L5.96562 11.8C5.81875 11.9469 5.58125 11.9469 5.43437 11.8L4.2 10.5625C4.05312 10.4156 4.05312 10.1781 4.2 10.0312L6.25 8L4.2 5.96562C4.05312 5.81875 4.05312 5.58125 4.2 5.43437L5.4375 4.19688C5.58437 4.05 5.82188 4.05 5.96875 4.19688L8 6.25L10.0344 4.2C10.1813 4.05312 10.4187 4.05312 10.5656 4.2L11.8031 5.4375C11.95 5.58437 11.95 5.82188 11.8031 5.96875L9.75 8L11.8 10.0344Z"></path></svg></span></span>'
                              message_type = 'You decided not to cancel this order'
                              if(v.cancel_mssg.trim().length != 0)
                              {
                                 cancel_mssg = '<div class="activity-collapsible-content cancel_div"><div style="max-height: unset; overflow: unset;"><div><article class="activity-body"><section class="card-wrap revision-request"><header class="card-header"><span class="card-title">Rejected Message</span> </header><div class="card-content"><div class="user-message"><a href="/user/profile/'+v.sender_username+'" class="stamp link"><div class="user-profile-image"><label class="profile-pict" for="profile_image_2825267375510" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a><div class="message-column"><p><div class="flex"><span class="username"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span>s message</span></div></p><p> '+v.cancel_mssg+'</p></div></div></div></section></article></div></div></div>'
                              }
                           }
                           else if(v.res_status.trim() == "pending"){
                              classtype = '<span class="stamp resolution-opened mutual-cancellation"></span>'
                              message_type = '<a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a>  asked to cancel this order'
                              buttons_txt = '<div class="HRhxExy ZBfSqH+ gCuoMYn" role="alert"> <span class="zv900so uB+IefT GManzyj" aria-hidden="true" style="width: 16px; height: 16px;"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M8 0C3.6 0 0 3.6 0 8C0 12.4 3.6 16 8 16C12.4 16 16 12.4 16 8C16 3.6 12.4 0 8 0ZM8 12C7.4 12 7 11.6 7 11C7 10.4 7.4 10 8 10C8.6 10 9 10.4 9 11C9 11.6 8.6 12 8 12ZM9 9H7V4H9V9Z"></path> </svg> </span> <div class="IjzCHAs"> <div> <p>You must respond by '+formatAMPM(new Date(v.res_last_date))+' or this order will be canceled</p> </div> </div> </div><div class="extend-actions"><button class="ORLWF8p T2YhX76 co-grey-1100 bg-co-grey-300" data-label="'+v.res_id+'" data-text="'+v.res_type+'" onclick="res_declineClick(this);">Decline</button><button class="ORLWF8p _0MkXbqi co-white bg-co-green-700" data-label="'+v.res_id+'" data-text="'+v.res_type+'" data-prev-date="'+v.res_prev_date+'" data-next-date="'+v.res_next_date+'" onclick="res_acceptClick(this);">Accept Request</button></div>';
                           }
                        }
                        else if(v.res_type.trim() == "extention")
                        {
                           req_type= "extention"
                           deliverymssg = ''
                           cancel_mssg = ''
                           extensionmssg = '<div class="dates-comparison"> <div class=""> <p>Original date</p> <p>'+formatDate(new Date(v.res_prev_date)) +'</p> </div> <span class="lFICM06 dates-arrow" aria-hidden="true" style="width: 16px; height: 16px;"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M9.92332 2.96885C9.63854 2.66807 9.1768 2.66807 8.89202 2.96885C8.60723 3.26963 8.60723 3.75729 8.89202 4.05807L11.6958 7.01931H1.48616C1.08341 7.01931 0.756918 7.36413 0.756918 7.7895C0.756918 8.21487 1.08341 8.5597 1.48616 8.5597H11.8436L8.89202 11.677C8.60723 11.9778 8.60723 12.4654 8.89202 12.7662C9.1768 13.067 9.63854 13.067 9.92332 12.7662L14.0459 8.41213C14.3307 8.11135 14.3307 7.62369 14.0459 7.32291L13.977 7.25011C13.9737 7.24661 13.9704 7.24315 13.9671 7.23972L9.92332 2.96885Z"></path> </svg> </span> <div class="irrelevant-date"> <p>New date</p> <p>'+formatDate(new Date(v.res_next_date))  +'</p> </div></div>';
                           if(v.res_status.trim() == "accepted")
                           {
                              classtype = '<span class="stamp order-completed"></span>'
                              message_type = '<a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a> agreed to extend the delivery date'
                           }
                           else if(v.res_status.trim() == "rejected"){
                              classtype = '<span class="stamp resolution-declined extend-delivery"><span class="lFICM06 stamp-icon" aria-hidden="true" style="width: 18px; height: 18px;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 0.25C3.71875 0.25 0.25 3.71875 0.25 8C0.25 12.2812 3.71875 15.75 8 15.75C12.2812 15.75 15.75 12.2812 15.75 8C15.75 3.71875 12.2812 0.25 8 0.25ZM11.8 10.0344C11.9469 10.1813 11.9469 10.4187 11.8 10.5656L10.5625 11.8C10.4156 11.9469 10.1781 11.9469 10.0312 11.8L8 9.75L5.96562 11.8C5.81875 11.9469 5.58125 11.9469 5.43437 11.8L4.2 10.5625C4.05312 10.4156 4.05312 10.1781 4.2 10.0312L6.25 8L4.2 5.96562C4.05312 5.81875 4.05312 5.58125 4.2 5.43437L5.4375 4.19688C5.58437 4.05 5.82188 4.05 5.96875 4.19688L8 6.25L10.0344 4.2C10.1813 4.05312 10.4187 4.05312 10.5656 4.2L11.8031 5.4375C11.95 5.58437 11.95 5.82188 11.8031 5.96875L9.75 8L11.8 10.0344Z"></path></svg></span></span>'
                              message_type = '<a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a> decided not to extend the delivery date'
                              if(v.cancel_mssg.trim().length != 0)
                              {
                                 cancel_mssg = '<div class="activity-collapsible-content cancel_div"><div style="max-height: unset; overflow: unset;"><div><article class="activity-body"><section class="card-wrap revision-request"><header class="card-header"><span class="card-title">Rejected Message</span> </header><div class="card-content"><div class="user-message"><a href="/user/profile/'+v.sender_username+'" class="stamp link"><div class="user-profile-image"><label class="profile-pict" for="profile_image_2825267375510" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a><div class="message-column"><p><div class="flex"><span class="username"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span>s message</span></div></p><p> '+v.cancel_mssg+'</p></div></div></div></section></article></div></div></div>'
                              }
                           }
                           else if(v.res_status.trim() == "pending"){
                              classtype = '<span class="stamp resolution-opened extend-delivery"></span>'
                              message_type = '<a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a> requested to extend the delivery date';
                              buttons_txt = '<div class="HRhxExy ZBfSqH+ gCuoMYn" role="alert"> <span class="zv900so uB+IefT GManzyj" aria-hidden="true" style="width: 16px; height: 16px;"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M8 0C3.6 0 0 3.6 0 8C0 12.4 3.6 16 8 16C12.4 16 16 12.4 16 8C16 3.6 12.4 0 8 0ZM8 12C7.4 12 7 11.6 7 11C7 10.4 7.4 10 8 10C8.6 10 9 10.4 9 11C9 11.6 8.6 12 8 12ZM9 9H7V4H9V9Z"></path> </svg> </span> <div class="IjzCHAs"> <div> <p>You must respond by '+formatAMPM(new Date(v.res_last_date))+' or this order will be automatically extended</p> </div> </div> </div><div class="extend-actions"><button class="ORLWF8p T2YhX76 co-grey-1100 bg-co-grey-300" data-label="'+v.res_id+'" data-text="'+v.res_type+'" onclick="res_declineClick(this);">Decline</button><button class="ORLWF8p _0MkXbqi co-white bg-co-green-700" data-label="'+v.res_id+'" data-text="'+v.res_type+'" data-prev-date="'+v.res_prev_date+'" data-next-date="'+v.res_next_date+'" onclick="res_acceptClick(this);">Accept Request</button></div>';
                           }
                        }
                        else if(v.res_type.trim() == "delivered")
                        {
                           extensionmssg = ''
                           cancel_mssg = ''
                           del_attachment_txt = ''
                           if(v.del_images.trim().length != 0)
                           {
                              del_attachments = v.del_images.trim().split(",");
                              del_attachment_txt = '<div class="attachments-preview-component"><div class="thumbnails-header"><h3>ATTACHMENTS</h3></div><ul class="attchments-container">';
                              $.each(del_attachments, function (key, value1) {
                              if(value1.trim().length != 0)
                              {
                                 file_path = '/media/delivery/'+value1.trim();
                                 del_attachment_txt += '<li class="thumbnail-preview" onclick="attachfile_onclick(this);" title="'+value+'" data-label= "'+file_path+'"><a class="thumbnail-link" href="'+file_path+'" target="_blank"><span class="fa fa-file-o fileicon" ></span></a><div class="action-bar flex flex-between"><div class="flex flex-center"><div class="attachment-name-container"><p class="attachment-name" title="'+value1+'">...'+value1.slice(-20)+'</p></div><span class="attachment-size"></span></div><div class="flex flex-center m-l-8"><a href="'+file_path+'" download class="download-button m-r-8"><span><i class="fa fa-download" aria-hidden="true"></i></span></a></div></div></li>';
                              }
                              });
                              del_attachment_txt += '</ul></div>';
                           }
                           deliverymssg = '<div class="activity-collapsible-content delivery_content"> <div style="max-height: unset; overflow: unset;"> <div> <article class="activity-body"> <section class="card-wrap delivery-card old-revision-copy"> <header class="card-header"><span class="card-title">Delivery #'+v.delivery_No+'</span> </header> <div class="card-content"> <div class="user-message"> <a href="/user/profile/'+v.sender_username+'" class="stamp link"> <div class="user-profile-image"><label class="profile-pict" for="profile_image_2405330232899" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div> </a> <div class="message-column"> <p> <div class="flex"><span class="username">'+v.sender_username+'</span></div> </p> <p>'+v.del_descrp+'</p> '+del_attachment_txt+' </div> </div>  </div> </section> </article> </div> </div></div>'
                           if(v.res_status.trim() == "accepted")
                           {
                              classtype = '<span class="stamp delivery-received"></span>'
                              message_type = 'Your order was completed'
                           }
                           else if(v.res_status.trim() == "rejected"){
                              classtype = '<span class="stamp resolution-declined delivery-received"><span class="lFICM06 stamp-icon" aria-hidden="true" style="width: 18px; height: 18px;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 0.25C3.71875 0.25 0.25 3.71875 0.25 8C0.25 12.2812 3.71875 15.75 8 15.75C12.2812 15.75 15.75 12.2812 15.75 8C15.75 3.71875 12.2812 0.25 8 0.25ZM11.8 10.0344C11.9469 10.1813 11.9469 10.4187 11.8 10.5656L10.5625 11.8C10.4156 11.9469 10.1781 11.9469 10.0312 11.8L8 9.75L5.96562 11.8C5.81875 11.9469 5.58125 11.9469 5.43437 11.8L4.2 10.5625C4.05312 10.4156 4.05312 10.1781 4.2 10.0312L6.25 8L4.2 5.96562C4.05312 5.81875 4.05312 5.58125 4.2 5.43437L5.4375 4.19688C5.58437 4.05 5.82188 4.05 5.96875 4.19688L8 6.25L10.0344 4.2C10.1813 4.05312 10.4187 4.05312 10.5656 4.2L11.8031 5.4375C11.95 5.58437 11.95 5.82188 11.8031 5.96875L9.75 8L11.8 10.0344Z"></path></svg></span></span>'
                              message_type = 'Sorry your delivery was rejected'
                              if(v.cancel_mssg.trim().length != 0)
                              {
                                 cancel_mssg = '<div class="activity-collapsible-content cancel_div"><div style="max-height: unset; overflow: unset;"><div><article class="activity-body"><section class="card-wrap revision-request"><header class="card-header"><span class="card-title">Rejected Message</span> </header><div class="card-content"><div class="user-message"><a href="/user/profile/'+v.sender_username+'" class="stamp link"><div class="user-profile-image"><label class="profile-pict" for="profile_image_2825267375510" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a><div class="message-column"><p><div class="flex"><span class="username"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span>s message</span></div></p><p> '+v.cancel_mssg+'</p></div></div></div></section></article></div></div></div>'
                              }
                           }
                           else if(v.res_status.trim() == "pending"){
                              classtype = '<span class="stamp resolution-opened delivery-received"></span>'
                              message_type =  '<a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a>  delivered your order';
                              buttons_txt = '<div class="HRhxExy ZBfSqH+ gCuoMYn" role="alert"> <span class="zv900so uB+IefT GManzyj" aria-hidden="true" style="width: 16px; height: 16px;"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M8 0C3.6 0 0 3.6 0 8C0 12.4 3.6 16 8 16C12.4 16 16 12.4 16 8C16 3.6 12.4 0 8 0ZM8 12C7.4 12 7 11.6 7 11C7 10.4 7.4 10 8 10C8.6 10 9 10.4 9 11C9 11.6 8.6 12 8 12ZM9 9H7V4H9V9Z"></path> </svg> </span> <div class="IjzCHAs"> <div> <p>You must respond by '+formatAMPM(new Date(v.res_last_date))+' or this order will be automatically marked as completed</p> </div> </div> </div><div class="extend-actions"><button class="ORLWF8p T2YhX76 co-grey-1100 bg-co-grey-300" data-label="'+v.res_id+'" data-text="'+v.res_type+'" onclick="res_declineClick(this);">Request Revision</button><button class="ORLWF8p _0MkXbqi co-white bg-co-green-700" data-label="'+v.res_id+'" data-text="'+v.res_type+'" data-prev-date="'+v.res_prev_date+'" data-next-date="'+v.res_next_date+'" onclick="res_acceptClick(this);">Mark As Completed</button></div>';
                           } 
                        }
                        else if(v.res_type.trim() == "completed")
                        {
                           classtype = '<span class="stamp order-completed"></span>'
                           message_type = 'Your order was completed'
                           deliverymssg = ''
                           extensionmssg = ''
                           cancel_mssg = ''
                        }
                        $("#message_wrap_box").append('<section class="activity-wrap resolution-opened"> <article class="LF267+J H1pvagJ PpAciwT"> <div class="AuUenGR activity-collapsible-title-wrapper"> <div class="CLdO82Y"> <label> '+classtype+'<p class="header-base "><span class="title-text"><span>'+message_type+'</span></span><i class="time-stamp">'+formatAMPM(new Date(v.mssg_time))+'</i></p> </label> </div> </div> <div class="activity-collapsible-content"> <div style="max-height: unset; overflow: unset;"> <div> <article class="activity-body"> <section class="card-wrap resolution mutual-cancellation-section"> <div class="card-content"> <div class="user-message"> <a href="user/profile/'+v.reciever_username+'" class="stamp link"> <div class="user-profile-image"><label class="profile-pict" for="profile_image_9928531938024" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.reciever_img+'" class="profile-pict-img" alt="'+v.reciever_username+'"></label></div> </a> <div class="message-column"> <p> <div class="flex"><span class="username"><span><a href="/user/profile/'+v.reciever_username+'" class="username-url">'+v.reciever_username+'</a></span></span></div> </p> <p>'+ get_url_text(v.res_message) +'</p> '+ extensionmssg + deliverymssg + cancel_mssg + '  </div> </div>  '+buttons_txt+' </div> </section> </article> </div> </div> </div> </article></section>');
                     }
                     else{
                        classtype = ''
                        message_type = ''
                        extensionmssg = ''
                        deliverymssg = ''
                        cancel_mssg = ''
                        if(v.res_type.trim() == "cancel")
                        {
                           extensionmssg = ''
                           deliverymssg = ''
                           cancel_mssg = ''
                           if(v.res_status.trim() == "accepted")
                           {
                              classtype = '<span class="stamp order-completed"></span>'
                              message_type = '<a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a> order was cancelled'
                           }
                           else if(v.res_status.trim() == "rejected"){
                              classtype = '<span class="stamp resolution-declined mutual-cancellation"><span class="lFICM06 stamp-icon" aria-hidden="true" style="width: 18px; height: 18px;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 0.25C3.71875 0.25 0.25 3.71875 0.25 8C0.25 12.2812 3.71875 15.75 8 15.75C12.2812 15.75 15.75 12.2812 15.75 8C15.75 3.71875 12.2812 0.25 8 0.25ZM11.8 10.0344C11.9469 10.1813 11.9469 10.4187 11.8 10.5656L10.5625 11.8C10.4156 11.9469 10.1781 11.9469 10.0312 11.8L8 9.75L5.96562 11.8C5.81875 11.9469 5.58125 11.9469 5.43437 11.8L4.2 10.5625C4.05312 10.4156 4.05312 10.1781 4.2 10.0312L6.25 8L4.2 5.96562C4.05312 5.81875 4.05312 5.58125 4.2 5.43437L5.4375 4.19688C5.58437 4.05 5.82188 4.05 5.96875 4.19688L8 6.25L10.0344 4.2C10.1813 4.05312 10.4187 4.05312 10.5656 4.2L11.8031 5.4375C11.95 5.58437 11.95 5.82188 11.8031 5.96875L9.75 8L11.8 10.0344Z"></path></svg></span></span>'
                              message_type = '<a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a> decided not to cancel this order'
                              if(v.cancel_mssg.trim().length != 0)
                              {
                                 cancel_mssg = '<div class="activity-collapsible-content cancel_div"><div style="max-height: unset; overflow: unset;"><div><article class="activity-body"><section class="card-wrap revision-request"><header class="card-header"><span class="card-title">Rejected Message</span> </header><div class="card-content"><div class="user-message"><a href="/user/profile/'+v.sender_username+'" class="stamp link"><div class="user-profile-image"><label class="profile-pict" for="profile_image_2825267375510" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a><div class="message-column"><p><div class="flex"><span class="username"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span>s message</span></div></p><p> '+v.cancel_mssg+'</p></div></div></div></section></article></div></div></div>'
                              }
                           }
                           else if(v.res_status.trim() == "pending"){
                              classtype = '<span class="stamp resolution-opened mutual-cancellation"></span>'
                              message_type = '<a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a>  asked to cancel this order'
                           }
                        }
                        else if(v.res_type.trim() == "extention")
                        {
                           deliverymssg = ''
                           cancel_mssg = ''
                           extensionmssg = '<div class="dates-comparison"> <div class=""> <p>Original date</p> <p>'+formatDate(new Date(v.res_prev_date)) +'</p> </div> <span class="lFICM06 dates-arrow" aria-hidden="true" style="width: 16px; height: 16px;"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M9.92332 2.96885C9.63854 2.66807 9.1768 2.66807 8.89202 2.96885C8.60723 3.26963 8.60723 3.75729 8.89202 4.05807L11.6958 7.01931H1.48616C1.08341 7.01931 0.756918 7.36413 0.756918 7.7895C0.756918 8.21487 1.08341 8.5597 1.48616 8.5597H11.8436L8.89202 11.677C8.60723 11.9778 8.60723 12.4654 8.89202 12.7662C9.1768 13.067 9.63854 13.067 9.92332 12.7662L14.0459 8.41213C14.3307 8.11135 14.3307 7.62369 14.0459 7.32291L13.977 7.25011C13.9737 7.24661 13.9704 7.24315 13.9671 7.23972L9.92332 2.96885Z"></path> </svg> </span> <div class="irrelevant-date"> <p>New date</p> <p>'+ formatDate(new Date(v.res_next_date)) +'</p> </div></div>';
                           if(v.res_status.trim() == "accepted")
                           {
                              classtype = '<span class="stamp order-completed"></span>'                              
                              message_type = '<a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a> agreed to extend the delivery date'
                           }
                           else if(v.res_status.trim() == "rejected"){
                              classtype = '<span class="stamp resolution-declined extend-delivery"><span class="lFICM06 stamp-icon" aria-hidden="true" style="width: 18px; height: 18px;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 0.25C3.71875 0.25 0.25 3.71875 0.25 8C0.25 12.2812 3.71875 15.75 8 15.75C12.2812 15.75 15.75 12.2812 15.75 8C15.75 3.71875 12.2812 0.25 8 0.25ZM11.8 10.0344C11.9469 10.1813 11.9469 10.4187 11.8 10.5656L10.5625 11.8C10.4156 11.9469 10.1781 11.9469 10.0312 11.8L8 9.75L5.96562 11.8C5.81875 11.9469 5.58125 11.9469 5.43437 11.8L4.2 10.5625C4.05312 10.4156 4.05312 10.1781 4.2 10.0312L6.25 8L4.2 5.96562C4.05312 5.81875 4.05312 5.58125 4.2 5.43437L5.4375 4.19688C5.58437 4.05 5.82188 4.05 5.96875 4.19688L8 6.25L10.0344 4.2C10.1813 4.05312 10.4187 4.05312 10.5656 4.2L11.8031 5.4375C11.95 5.58437 11.95 5.82188 11.8031 5.96875L9.75 8L11.8 10.0344Z"></path></svg></span></span>'
                              message_type = 'You decided not to extend the delivery date'
                              if(v.cancel_mssg.trim().length != 0)
                              {
                                 cancel_mssg = '<div class="activity-collapsible-content cancel_div"><div style="max-height: unset; overflow: unset;"><div><article class="activity-body"><section class="card-wrap revision-request"><header class="card-header"><span class="card-title">Rejected Message</span> </header><div class="card-content"><div class="user-message"><a href="/user/profile/'+v.sender_username+'" class="stamp link"><div class="user-profile-image"><label class="profile-pict" for="profile_image_2825267375510" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a><div class="message-column"><p><div class="flex"><span class="username"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span>s message</span></div></p><p> '+v.cancel_mssg+'</p></div></div></div></section></article></div></div></div>'
                              }
                           }
                           else if(v.res_status.trim() == "pending"){
                              classtype = '<span class="stamp resolution-opened extend-delivery"></span>'
                              message_type = 'You requested to extend the delivery date'
                           }
                        }
                        else if(v.res_type.trim() == "delivered")
                        {
                           extensionmssg = ''
                           cancel_mssg = ''
                           del_attachment_txt  = ''
                           if(v.del_images.trim().length != 0)
                           {
                              del_attachments = v.del_images.trim().split(",");
                              del_attachment_txt = '<div class="attachments-preview-component"><div class="thumbnails-header"><h3>ATTACHMENTS</h3></div><ul class="attchments-container">';
                              $.each(del_attachments, function (key, value1) {
                              if(value1.trim().length != 0)
                              {
                                 file_path = '/media/delivery/'+value1.trim();
                                 del_attachment_txt += '<li class="thumbnail-preview" onclick="attachfile_onclick(this);" title="'+value+'" data-label= "'+file_path+'"><a class="thumbnail-link" href="'+file_path+'" target="_blank"><span class="fa fa-file-o fileicon" ></span></a><div class="action-bar flex flex-between"><div class="flex flex-center"><div class="attachment-name-container"><p class="attachment-name" title="'+value1+'">...'+value1.slice(-20)+'</p></div><span class="attachment-size"></span></div><div class="flex flex-center m-l-8"><a href="'+file_path+'" download class="download-button m-r-8"><span><i class="fa fa-download" aria-hidden="true"></i></span></a></div></div></li>';
                              }
                              });
                              del_attachment_txt += '</ul></div>';
                           }
                           deliverymssg = '<div class="activity-collapsible-content delivery_content"> <div style="max-height: unset; overflow: unset;"> <div> <article class="activity-body"> <section class="card-wrap delivery-card old-revision-copy"> <header class="card-header"><span class="card-title">Delivery #'+v.delivery_No+'</span> </header> <div class="card-content"> <div class="user-message"> <a href="/user/profile/'+v.sender_username+'" class="stamp link"> <div class="user-profile-image"><label class="profile-pict" for="profile_image_2405330232899" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div> </a> <div class="message-column"> <p> <div class="flex"><span class="username">Me</span></div> </p> <p>'+v.del_descrp+'</p> '+del_attachment_txt+' </div> </div> <div class="warning-note auto-complete"> <span class="lFICM06 note-icon" aria-hidden="true" style="width: 18px; height: 18px;"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M8 0.25C3.71875 0.25 0.25 3.71875 0.25 8C0.25 12.2812 3.71875 15.75 8 15.75C12.2812 15.75 15.75 12.2812 15.75 8C15.75 3.71875 12.2812 0.25 8 0.25ZM8 14.25C4.54688 14.25 1.75 11.4531 1.75 8C1.75 4.54688 4.54688 1.75 8 1.75C11.4531 1.75 14.25 4.54688 14.25 8C14.25 11.4531 11.4531 14.25 8 14.25ZM9.93125 10.9875L7.27812 9.05937C7.18125 8.9875 7.125 8.875 7.125 8.75625V3.625C7.125 3.41875 7.29375 3.25 7.5 3.25H8.5C8.70625 3.25 8.875 3.41875 8.875 3.625V8.05313L10.9625 9.57187C11.1312 9.69375 11.1656 9.92813 11.0437 10.0969L10.4563 10.9062C10.3344 11.0719 10.1 11.1094 9.93125 10.9875Z"></path> </svg> </span> <p class="tbody-6"><span class="note-text"><a href="/user/profile/'+v.reciever_username+'" class="username-url">'+v.reciever_username+'</a> has until <b>'+formatAMPM(new Date(v.res_last_date))+'</b> to approve this delivery or request a revision. After this date, the order will be finalized and marked as complete.</span></p> </div> </div> </section> </article> </div> </div></div>'
                           if(v.res_status.trim() == "accepted")
                           {
                              classtype = '<span class="stamp delivery-received"></span>'
                              message_type = 'Your order was completed'
                           }
                           else if(v.res_status.trim() == "rejected"){
                              classtype = '<span class="stamp resolution-declined delivery-received"><span class="lFICM06 stamp-icon" aria-hidden="true" style="width: 18px; height: 18px;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 0.25C3.71875 0.25 0.25 3.71875 0.25 8C0.25 12.2812 3.71875 15.75 8 15.75C12.2812 15.75 15.75 12.2812 15.75 8C15.75 3.71875 12.2812 0.25 8 0.25ZM11.8 10.0344C11.9469 10.1813 11.9469 10.4187 11.8 10.5656L10.5625 11.8C10.4156 11.9469 10.1781 11.9469 10.0312 11.8L8 9.75L5.96562 11.8C5.81875 11.9469 5.58125 11.9469 5.43437 11.8L4.2 10.5625C4.05312 10.4156 4.05312 10.1781 4.2 10.0312L6.25 8L4.2 5.96562C4.05312 5.81875 4.05312 5.58125 4.2 5.43437L5.4375 4.19688C5.58437 4.05 5.82188 4.05 5.96875 4.19688L8 6.25L10.0344 4.2C10.1813 4.05312 10.4187 4.05312 10.5656 4.2L11.8031 5.4375C11.95 5.58437 11.95 5.82188 11.8031 5.96875L9.75 8L11.8 10.0344Z"></path></svg></span></span>'
                              message_type = 'Sorry your delivery was rejected'
                              if(v.cancel_mssg.trim().length != 0)
                              {
                                 cancel_mssg = '<div class="activity-collapsible-content cancel_div"><div style="max-height: unset; overflow: unset;"><div><article class="activity-body"><section class="card-wrap revision-request"><header class="card-header"><span class="card-title">Rejected Message</span> </header><div class="card-content"><div class="user-message"><a href="/user/profile/'+v.sender_username+'" class="stamp link"><div class="user-profile-image"><label class="profile-pict" for="profile_image_2825267375510" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a><div class="message-column"><p><div class="flex"><span class="username"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span>s message</span></div></p><p> '+v.cancel_mssg+'</p></div></div></div></section></article></div></div></div>'
                              }
                           }
                           else if(v.res_status.trim() == "pending"){
                              classtype = '<span class="stamp resolution-opened delivery-received"></span>'
                              message_type =  'You delivered the order'
                           } 
                        }
                        else if(v.res_type.trim() == "completed")
                        {
                           classtype = '<span class="stamp order-completed"></span>'
                           message_type = 'Your order was completed'
                           deliverymssg = ''
                           extensionmssg = ''
                        }
                        $("#message_wrap_box").append('<section class="activity-wrap resolution-withdrawn"><article class="LF267+J H1pvagJ PpAciwT"><div class="AuUenGR activity-collapsible-title-wrapper"><div class="CLdO82Y"><label> '+classtype+'<p class="header-base "><span class="title-text">'+message_type+'</span><i class="time-stamp">'+formatAMPM(new Date(v.mssg_time))+'</i></p></label></div></div><div class="activity-collapsible-content"><div style="max-height: unset; overflow: unset;"><div><article class="activity-body"><section class="card-wrap resolution mutual-cancellation-section"><div class="card-content"><div class="user-message"><a href="user/profile/'+v.reciever_username+'" class="stamp link"><div class="user-profile-image"><label class="profile-pict" for="profile_image_7171343538020" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.reciever_img+'" class="profile-pict-img" alt="'+v.reciever_username+'"></label></div></a><div class="message-column"><p><div class="flex"><span class="username"><span><a href="/user/profile/'+v.reciever_username+'" class="username-url">'+v.reciever_username+'</a></span></span></div></p><p>'+ get_url_text(v.res_message) +'</p> '+ extensionmssg + deliverymssg + cancel_mssg +'</div></div></div></section></article></div></div></div></article></section>');
                     }
                  }
                  else
                  {
                     if('{{request.user.username}}' == v.sender_username)
                     {
                        $("#message_wrap_box").append('<section class="activity-wrap is-message message-received"> <article class="LF267+J H1pvagJ PpAciwT"> <div class="AuUenGR activity-collapsible-title-wrapper"> <div class="CLdO82Y"> <label> <a href="/user/profile/'+v.sender_username+'" class="stamp link message-sent"> <div class="user-profile-image"> <label class="profile-pict" for="profile_image_8475174845636" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a> <p class="header-base "><span class="title-text"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span> sent you a message</span><i class="time-stamp">'+formatAMPM(new Date(v.timestamp))+'</i></p> </label> </div> </div> <div class="activity-collapsible-content"> <article class="activity-body"> <div style="max-height: unset; overflow: unset;"> <div> <div class="body-with-attachments"> <p class="message-content">'+ get_url_text(v.message) +'</p> </div> </div> </div> </article> </div> </article> </section>');
                     }
                     else{
                        $("#message_wrap_box").append('<section class="activity-wrap is-message message-received"> <article class="LF267+J H1pvagJ PpAciwT"> <div class="AuUenGR activity-collapsible-title-wrapper"> <div class="CLdO82Y"> <label> <a href="/user/profile/'+v.sender_username+'" class="stamp link message-sent"> <div class="user-profile-image"> <label class="profile-pict" for="profile_image_8475174845636" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a> <p class="header-base "><span class="title-text"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span> sent you a message</span><i class="time-stamp">'+formatAMPM(new Date(v.timestamp))+'</i></p> </label> </div> </div> <div class="activity-collapsible-content"> <article class="activity-body"> <div style="max-height: unset; overflow: unset;"> <div> <div class="body-with-attachments"> <p class="message-content">'+ get_url_text(v.message)+'</p> </div> </div> </div> </article> </div> </article> </section>');
                     }
                  }
               }
            });
            $("#message_ids").val(array_list.join(", "));
         }
      });
      $(".help_div").hover(function (e) {
         $('.helptext_desc').toggle();
     });
      $('#due_timer').flipper('init');
      $(".error-message").hide();
      $( "#btn_delivery_now" ).click(function() {
         $("#text_delivery_messsg").val("");
         $('#delivery_file').val('') ;
         $("#modal_delivery").modal('show');

      });
      $('#text_order_mssg').emojiPicker({
         position: 'right'
      });

      $("#text_delivery_messsg").on("paste keyup", function(e){ 
         setTimeout(function() {  
            var thisChars = $("#text_delivery_messsg").val().trim().replace(/{.*}/g, '').length; 
            var maxlength = $("#text_delivery_messsg").attr("maxlength");
            if(thisChars > maxlength) 
            {
               var CharsToDel = (thisChars-maxlength); 
               $("#text_delivery_messsg").val($("#text_delivery_messsg").val().trim().substring(0,e.value.length-CharsToDel)); 
            }else{
               $("#span_delivery_messsg").text( maxlength - thisChars + " /"+maxlength  +" max" ); 
            }
      }, 500);  
      }); 

      $("#form_response").submit(function(e)
      {
         e.preventDefault();
         $.ajax({
            type:"GET",
            url: "/post_seller_response/",
            data: {"seller_rev_id":'{{seller_review.0.review_id}}',"seller_rev_response":$("#text_response_mssg").val()},
            success: function(data) 
            {
               if(data == "sucess")
               {
                  $("#response_message").text($("#text_response_mssg").val());
                  $("#response_div").hide();
                  $("#seller_resp_div1").show();
               }
            }
         });
      });
      $("#text_response_mssg").on("paste keyup", function(e){ 
         setTimeout(function() {  
         var thisChars = $("#text_response_mssg").val().trim().replace(/{.*}/g, '').length; 
         var maxlength = $("#text_response_mssg").attr("maxlength");
         if(thisChars > maxlength) 
         {
            var CharsToDel = (thisChars-maxlength); 
            $("#text_response_mssg").val($("#text_response_mssg").val().trim().substring(0,this.value.length-CharsToDel)); 
         }else{
            $("#span_response_mssg").text( maxlength - thisChars + " /"+maxlength  +" max" ); 
         }
      }, 500); 
      }); 

      $("#text_cancel_messsg").on("paste keyup", function(e){ 
         setTimeout(function() {  
         var thisChars = $("#text_cancel_messsg").val().trim().replace(/{.*}/g, '').length; 
         var maxlength = $("#text_cancel_messsg").attr("maxlength");
         if(thisChars > maxlength) 
         {
            var CharsToDel = (thisChars-maxlength); 
            $("#text_cancel_messsg").val($("#text_cancel_messsg").val().trim().substring(0,$("#text_cancel_messsg").val().trim().length-CharsToDel)); 
         }else{
            $("#span_cancel_messsg").text( maxlength - thisChars + " /"+maxlength  +" max" ); 
         }
      }, 500);  
      });
      $("#text_order_mssg").on("paste keyup", function(e){ 
         setTimeout(function() {  
         var thisChars = $("#text_order_mssg").val().trim().replace(/{.*}/g, '').length; 
         var maxlength =  $("#text_order_mssg").attr("maxlength");
         messages =  jsonObj1.some(substring=> $("#text_order_mssg").val().trim().includes(substring));
         if(messages == true)
         {
            array_string =  five_jsonObj1.join(", ");
            $("#message_errors").show();
            $(".detected_mssg").text(array_string);
         }
         else{
            $("#message_errors").hide();
            $(".detected_mssg").text("");
         }
         if(thisChars > maxlength) 
         {
            var CharsToDel = (thisChars-maxlength); 
            $("#text_order_mssg").val( $("#text_order_mssg").val().trim().substring(0, $("#text_order_mssg").val().trim().length-CharsToDel)); 
         }else{
            $("#span_order_mssg").text( maxlength - thisChars + " /"+maxlength  +" max" ); 
         }
      }, 500);  
      }); 
      
      $("#btn_save_draft").click(function(){
         order_mssg = $("#text_delivery_messsg").val();
         if(order_mssg.length != 0)
         {
            $(".error-message").hide();
            imgList= '';
            $(".delivery-form").find(".imagediv").each(function(ev){ 
               imgList = imgList +", "+  $(this).find('.img_file_name').val();
           });
           $("#btn_save_draft").prop("disabled",true);
            $.ajax({
               type:"POST",
               url: "/post_draft_object/",
               data: {"delivery_message":order_mssg,"delivery_images":imgList,"order_no":'{{order_details.order_no}}'},
               success: function(data) 
               {
                  $("#btn_save_draft").prop("disabled",false);
                  $("#modal_delivery").modal('hide');
                  location.reload();
               }
            });
         }
         else{
            $(".error-message").show();
         }
      });
      $("#btn_cancel_submit").click(function(){
         if($("#text_cancel_messsg").val().trim().length != 0)
         {
            $("#btn_cancel_submit").prop("disabled",true);
            $(".canl-error-message").hide();
            $.ajax({
               type:"GET",
               url: "/post_decline_click/",
               data: {"res_id":$("#resl_id").val(),"res_type":$("#resl_type").val(),"res_text":$("#text_cancel_messsg").val()},
               success: function(data) 
               {
                  $("#btn_cancel_submit").prop("disabled",false);
                  location.reload();
               }
            });
         }else{
            $(".canl-error-message").show();
         }
      });
      $("#btn_delivery_submit").click(function(){
         order_mssg = $("#text_delivery_messsg").val();
         if(order_mssg.length != 0)
         {
            $(".error-message").hide();
            imgList= '';
            $(".delivery-form").find(".imagediv").each(function(ev){ 
                imgList = imgList +", "+  $(this).find('.img_file_name').val();
            });
            $("#btn_delivery_submit").prop("disabled",true);
            $.ajax({
               type:"POST",
               url: "/post_delivered_object/",
               data: {"delivery_message":order_mssg,"delivery_images":imgList,"order_no":'{{order_details.order_no}}'},
               success: function(data) 
               {
                  $("#btn_delivery_submit").prop("disabled",false);
                  $("#modal_delivery").modal('hide');
                  location.reload();
               }
            });
         }
         else{
            $(".error-message").show();
         }
      });

      const get = (selector, root = document) => root.querySelector(selector);
      let attachment;
      const roomName = $("#conversation_id").val();
      const chatSocket = new WebSocket(
        'ws://'
        + window.location.host
        + '/ws/order_chat/'
        + roomName
        + '/'
      );
      var buyer_user = $("#buyer_username").val();
      var seller_user = $("#seller_username").val();
      chatSocket.onmessage = e => {
         const data = JSON.parse(e.data);
         $("#text_order_mssg").val("");
         $("#files_list").empty();
         $("#message_errors").hide();
         if(data.attachment.length != 0)
         {
            attachments = data.attachment.trim().split(",");
            attachment_txt = '<div class="attachments-preview-component"><div class="thumbnails-header"><h3>ATTACHMENTS</h3></div><ul class="attchments-container">';
            $.each(attachments, function (key, value) {
               if(value.trim().length != 0)
               {
                  file_path = '/media/order_files/'+value.trim();
                  attachment_txt += '<li class="thumbnail-preview" onclick="attachfile_onclick(this);" title="'+value+'" data-label= "'+file_path+'"><a class="thumbnail-link" href="'+file_path+'" target="_blank"><span class="fa fa-file-o fileicon" ></span></a><div class="action-bar flex flex-between"><div class="flex flex-center"><div class="attachment-name-container"><p class="attachment-name" title="'+value+'">...'+value.slice(-20)+'</p></div><span class="attachment-size"></span></div><div class="flex flex-center m-l-8"><a href="'+file_path+'" download class="download-button m-r-8"><span><i class="fa fa-download" aria-hidden="true"></i></span></a></div></div></li>';
               }
            });
            attachment_txt += '</ul></div>';
         }
         else{
            attachment_txt = ''
         }
         if('{{request.user.username}}' == data.sender)
         {
            $("#message_wrap_box").append(' <section class="activity-wrap is-message message-sent"> <article class="LF267+J H1pvagJ PpAciwT"> <div class="AuUenGR activity-collapsible-title-wrapper"> <div class="CLdO82Y"> <label> <a href="/beinganaatiidu1?source=order_page_user_stamp_link" class="stamp link message-sent"> <div class="user-profile-image"> <label class="profile-pict" for="profile_image_8475174845636" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+data.sender_img+'" class="profile-pict-img" alt="beinganaatiidu1"></label></div></a> <p class="header-base "><span class="title-text"><span><a href="/user/profile/'+data.sender+'" class="username-url">'+data.sender+'</a></span> sent you a message</span><i class="time-stamp">'+formatAMPM(new Date(data.time))+'</i></p> </label> </div> </div> <div class="activity-collapsible-content"> <article class="activity-body"> <div style="max-height: unset; overflow: unset;"> <div> <div class="body-with-attachments"> <p class="message-content">'+ get_url_text(data.message) +'</p>'+attachment_txt+'  </div> </div> </div> </article> </div> </article> </section>');
         }
         else 
         {
            $("#message_wrap_box").append(' <section class="activity-wrap is-message message-sent"> <article class="LF267+J H1pvagJ PpAciwT"> <div class="AuUenGR activity-collapsible-title-wrapper"> <div class="CLdO82Y"> <label> <a href="/beinganaatiidu1?source=order_page_user_stamp_link" class="stamp link message-sent"> <div class="user-profile-image"> <label class="profile-pict" for="profile_image_8475174845636" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+data.sender_img+'" class="profile-pict-img" alt="beinganaatiidu1"></label></div></a> <p class="header-base "><span class="title-text"><span><a href="/user/profile/'+data.sender+'" class="username-url">'+data.sender+'</a></span> sent you a message</span><i class="time-stamp">'+formatAMPM(new Date(data.time))+'</i></p> </label> </div> </div> <div class="activity-collapsible-content"> <article class="activity-body"> <div style="max-height: unset; overflow: unset;"> <div> <div class="body-with-attachments"> <p class="message-content">'+ get_url_text(data.message) +'</p> '+attachment_txt+' </div> </div> </div> </article> </div> </article> </section>');
         }
      };
      chatSocket.onclose = e => console.error(e);
      $( "#chat_message_send" ).click(function() {
         event.preventDefault();
         if($("#text_order_mssg").val().trim().length  != 0)
         {
            let message;
            imgList= '';
            $("#files_list").find('.imagediv').each(function(ev){ 
               imgList = imgList +", "+  $(this).find('.img_file_name').val();
            });
            const msgText = $("#text_order_mssg").val().trim();
            sender_mssg = '';
            receiver_mssg = '';
            if('{{request.user.username}}' == buyer_user)
            {
               sender_mssg = buyer_user;
               receiver_mssg = seller_user;
            }            
            else if('{{request.user.username}}' == seller_user)
            {
               sender_mssg = seller_user;
               receiver_mssg = buyer_user;
            }
            message = JSON.stringify({
               'message': msgText,
               'recepient': receiver_mssg,
               'sender': sender_mssg,   
               'order_no': '{{seller_gig.0.order_no}}' ,
               'attachment': imgList,
               'time': Date.now()
            });
            chatSocket.send(message);
         }
         else{
            $(".help_div").removeClass("min_width").addClass("error_help");
            $(".help_div").show();
            $(".help_div").find(".helptext_desc").text('This field is required.').addClass("min_width");
         }
      });
   class FileUpload {
      constructor(input) {
         this.input = input
         this.max_length = 1024 * 1024 * 2;
      }
      create_progress_bar() {
         var progress = `<div class="file-icon">
                              <i class="fa fa-file-o" aria-hidden="true"></i>
                          </div>
                          <div class="file-details">
                              <p class="filename"></p>
                              <div class="progress" style="margin-top: 5px;">
                                  <div class="progress-bar bg-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                  </div>
                              </div>
                          </div>`
         document.getElementById('file_progress_div').innerHTML = progress
      }
      upload() {
         this.create_progress_bar();
         this.initFileUpload();
      }
      initFileUpload() {
         this.file = this.input.files[0];
         this.upload_file(0, null);
      }
      upload_file(start, model_id) {
         var end;
         var self = this;
         var existingPath = model_id;
         var formData = new FormData();
         var nextChunk = start + this.max_length + 1;
         var currentChunk = this.file.slice(start, nextChunk);
         var uploadedChunk = start + currentChunk.size
         if (uploadedChunk >= this.file.size) {
            end = 1;
         } else {
            end = 0;
         }
         formData.append('file', currentChunk)
         formData.append('filename', this.file.name)
         $('.filename').text(this.file.name)
         formData.append('end', end)
         formData.append('existingPath', existingPath);
         formData.append('nextSlice', nextChunk);
         $.ajax({
            xhr: function () {
               var xhr = new XMLHttpRequest();
               xhr.upload.addEventListener('progress', function (e) {
               if (e.lengthComputable) {
                  if (self.file.size < self.max_length) {
                     var percent = Math.round((e.loaded / e.total) * 100);
                  } else {
                     var percent = Math.round((uploadedChunk / self.file.size) * 100);
                  }
                  $('.progress-bar').css('width', percent + '%')
                  $('.progress-bar').text(percent + '%')
               }
            });
            return xhr;
         },
         url: '/post_order_upload/',
         type: 'POST',
         dataType: 'json',
         cache: false,
         processData: false,
         contentType: false,
         data: formData,
         error: function (xhr) {
            console.log(xhr.statusText);
         },
         success: function (res) {
            if (nextChunk < self.file.size) {
               existingPath = res.existingPath
               self.upload_file(nextChunk, existingPath);
               $("#chat_message_send").prop("disabled",true);
            } else {
               $("#file_progress_div").empty();
               var no_of_imgs = $("#files_list").find(".imagediv").length;
               $("#files_list").append('<div class="mssg_img'+(no_of_imgs+1)+' imagediv" id="mssg_img'+(no_of_imgs+1)+'"><input type="hidden" value="'+res.existingPath+'" class="img_file_name"> <span class= "fa fa-file-o fileicon"><i class="fa fa-trash" onclick="post_img_message_delete(this);" data-label="mssg_img'+(no_of_imgs+1)+' "></i></span><span class="file_name">...'+res.existingPath.slice(-20)+'</span></div>');
               $("#chat_message_send").prop("disabled",false);
            }
         }
      });
   };
  }

   $("#chat_file").change(function() {
      var uploader = new FileUpload(document.querySelector('#chat_file'));
      var filesize = ((this.files[0].size/1024)/1024).toFixed(4);
      if(Math.ceil(filesize) <= 300)
      {
         uploader.upload();
      }
      else{
         alert("max file size is 300MB.")
      }
   });


   class FileUpload_deliery {
      constructor(input) {
          this.input = input
          this.max_length = 1024 * 1024 * 10;
      }
      create_progress_bar() {
          var progress = `<div class="file-icon">
                              <i class="fa fa-file-o" aria-hidden="true"></i>
                          </div>
                          <div class="file-details">
                              <p class="filename"></p>
                              <div class="progress" style="margin-top: 5px;">
                                  <div class="progress-bar bg-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                  </div>
                              </div>
                          </div>`
          document.getElementById('d_file_progress_div').innerHTML = progress
      }
      upload() {
          this.create_progress_bar();
          this.initFileUpload();
      }
  
      initFileUpload() {
          this.file = this.input.files[0];
          this.upload_file(0, null);
      }
      upload_file(start, model_id) {
          var end;
          var self = this;
          var existingPath = model_id;
          var formData = new FormData();
          var nextChunk = start + this.max_length + 1;
          var currentChunk = this.file.slice(start, nextChunk);
          var uploadedChunk = start + currentChunk.size
          if (uploadedChunk >= this.file.size) {
              end = 1;
          } else {
              end = 0;
          }
          formData.append('file', currentChunk)
          formData.append('filename', this.file.name)
          $('.filename').text(this.file.name)
          formData.append('end', end)
          formData.append('existingPath', existingPath);
          formData.append('nextSlice', nextChunk);
          $.ajax({
              xhr: function () {
                  var xhr = new XMLHttpRequest();
                  xhr.upload.addEventListener('progress', function (e) {
                      if (e.lengthComputable) {
                          if (self.file.size < self.max_length) {
                              var percent = Math.round((e.loaded / e.total) * 100);
                          } else {
                              var percent = Math.round((uploadedChunk / self.file.size) * 100);
                          }
                          $('.progress-bar').css('width', percent + '%')
                          $('.progress-bar').text(percent + '%')
                      }
                  });
                  return xhr;
              },
              url: '/post_delivery_order_upload/',
              type: 'POST',
              dataType: 'json',
              cache: false,
              processData: false,
              contentType: false,
              data: formData,
              error: function (xhr) {
               console.log(xhr.statusText);
              },
              success: function (res) {
                  if (nextChunk < self.file.size) {
                      existingPath = res.existingPath
                      self.upload_file(nextChunk, existingPath);
                      $("#btn_delivery_submit").prop("disabled",true);
                  } else {
                     $("#d_file_progress_div").empty();
                     var no_of_imgs = $("#image_list").find(".imagediv").length;
                      $("#image_list").append('<div class="del_mssg_img'+(no_of_imgs+1)+' imagediv" id="del_mssg_img'+(no_of_imgs+1)+'"><input type="hidden" value="'+res.existingPath+'" class="img_file_name"> <span class= "fa fa-file-o fileicon"><i class="fa fa-trash" onclick="post_img_del_message_delete(this);" data-label="del_mssg_img'+(no_of_imgs+1)+' "></i></span><span class="file_name">...'+res.existingPath.slice(-20)+'</span></div>');
                      $("#btn_delivery_submit").prop("disabled",false);
                  }
              }
          });
      };
  }
   $("#delivery_file").change(function() {
      var uploader = new FileUpload_deliery(document.querySelector('#delivery_file'));
      var filesize = ((this.files[0].size/1024)/1024).toFixed(4);
      if(Math.ceil(filesize) <= 300)
      {
         uploader.upload();
      }
      else{
         alert("max file size is 300MB.")
      }
      
   });  
});
   function post_img_message_delete(ev)
   {
      div_id = $(ev).attr("data-label");
      $("#files_list").find("#" +div_id).remove();
   }
   function post_img_del_message_delete(ev)
   {
      div_id = $(ev).attr("data-label");
      $("#image_list").find("#" +div_id).remove();
   }
   function res_acceptClick(ev)
   {
      var prev_date = '' ;
      var next_date = '' ;
      if($(ev).attr("data-text") == "extention")
      {
         prev_date = $(ev).attr("data-prev-date");
         next_date = $(ev).attr("data-next-date");
      }
      else if($(ev).attr("data-text") == "cancel")
      {
         prev_date = new Date();
         next_date = new Date();
      }
      $.ajax({
         type:"GET",
         url: "/post_accept_click/",
         data: {"res_id":$(ev).attr("data-label"),"res_type":$(ev).attr("data-text"),"pre_date": prev_date, "next_date":next_date},
         success: function(data) 
         {
            if($(ev).attr("data-text") == "delivered")
            {
               location_href =  $(location).attr('href').split("/");
               window.location.href = location_href[0]+"//"+location_href[2] + "/seller_reviews/{{order_details.order_no}}"
            }
            else{
               location.reload();
            } 
		   }
		});
   }

   function res_declineClick(ev)
   {
      $("#resl_id").val($(ev).attr("data-label"));
      $("#resl_type").val($(ev).attr("data-text"));
      $(".canl-error-message").hide();
      $("#modal_cancel").modal('show');
   }
   function attachfile_onclick(ev)
   {
      location_href =  $(location).attr('href').split("/");
      window.open( location_href[0]+"//"+location_href[2] + $(ev).attr("data-label"),"_blank");
   }
   function inbox_click(username)
   {
      $.ajax({
         type:"GET",
         url: "/post_check_conver/",
         data: {'initiator':'{{request.user.username}}','receiver':username},
         success: function(data) 
         {  
            location_href =  $(location).attr('href').split("/");
            window.location.href = location_href[0]+"//"+location_href[2] +"/inbox/"+ username;
         }   
     });
      
   }
   function loadPrevious_Mssg()
   {
      newArray= []
      total_val = $("#total_chat_count").val();
      curre_val = $("#current_count").val();
      message_id = $("#message_ids").val().split(",");
      if(parseInt(curre_val) < parseInt(total_val))
      {
        
         if(message_id.length > 9){
            curre_val = parseInt(curre_val)+ 10;
            newArray = message_id.slice(0,10);
         }
         else{
            curre_val =  parseInt(curre_val)+ message_id.length;
            newArray = message_id;
         }
      $.ajax({
         type:"GET",
         url: "/get_all_order_messages/",
         data: {"conver_id":$("#conversation_id").val(),"order_no":'{{order_details.order_no}}',"current_count":parseInt(curre_val),"id_list":newArray.join(", ").toString()},
         success: function(data) 
         {
            div_id = 'div_messg_wrap_counter'+curre_val;
            $('#loaded_messages').prepend('<div id="div_messg_wrap_counter'+curre_val+'"></div>');    
            $("#total_chat_count").val(data.total_count);
            $("#current_count").val(data.current_count);
            $.each(data.data, function(i, v) {
               message_id = jQuery.grep(message_id, function(value) {
                  return value !=  v.mssg_id;
               }); 
               if(v.attachment != "None" && v.res_type == null)
               {
                  attachments = v.attachment.trim().split(",");
                  attachment_txt = '<div class="attachments-preview-component"><div class="thumbnails-header"><h3>ATTACHMENTS</h3></div><ul class="attchments-container">';
                  $.each(attachments, function (key, value) {
                     if(value.trim().length != 0)
                     {
                        file_path = '/media/order_files/'+value.trim();
                        attachment_txt += '<li class="thumbnail-preview" onclick="attachfile_onclick(this);" title="'+value+'" data-label= "'+file_path+'"><a class="thumbnail-link" href="'+file_path+'" target="_blank"><span class="fa fa-file-o fileicon" ></span></a><div class="action-bar flex flex-between"><div class="flex flex-center"><div class="attachment-name-container"><p class="attachment-name" title="'+value+'">...'+value.slice(-20)+'</p></div><span class="attachment-size"></span></div><div class="flex flex-center m-l-8"><a href="'+file_path+'" download class="download-button m-r-8"><span><i class="fa fa-download" aria-hidden="true"></i></span></a></div></div></li>';
                     }
                  });
                  attachment_txt += '</ul></div>';
                  if('{{request.user.username}}' == v.sender_username)
                  {
                     $('#loaded_messages').find("#"+div_id).append('<section class="activity-wrap is-message message-sent"> <article class="LF267+J H1pvagJ PpAciwT"> <div class="AuUenGR activity-collapsible-title-wrapper"> <div class="CLdO82Y"> <label> <a href="/user/profile/'+v.sender_username+'" class="stamp link message-sent"> <div class="user-profile-image"> <label class="profile-pict" for="profile_image_8475174845636" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a> <p class="header-base "><span class="title-text"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span> sent you a message</span><i class="time-stamp">'+formatAMPM(new Date(v.timestamp))+'</i></p> </label> </div> </div> <div class="activity-collapsible-content"> <article class="activity-body"> <div style="max-height: unset; overflow: unset;"> <div> <div class="body-with-attachments"> <p class="message-content">'+ get_url_text(v.message) +'</p>'+attachment_txt+' </div> </div> </div> </article> </div> </article> </section>');
                  }
                  else{
                     $('#loaded_messages').find("#"+div_id).append('<section class="activity-wrap is-message message-received"> <article class="LF267+J H1pvagJ PpAciwT"> <div class="AuUenGR activity-collapsible-title-wrapper"> <div class="CLdO82Y"> <label> <a href="/user/profile/'+v.sender_username+'" class="stamp link message-sent"> <div class="user-profile-image"> <label class="profile-pict" for="profile_image_8475174845636" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a> <p class="header-base "><span class="title-text"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span> sent you a message</span><i class="time-stamp">'+formatAMPM(new Date(v.timestamp))+'</i></p> </label> </div> </div> <div class="activity-collapsible-content"> <article class="activity-body"> <div style="max-height: unset; overflow: unset;"> <div> <div class="body-with-attachments"> <p class="message-content">'+get_url_text(v.message)+'</p> '+attachment_txt+' </div> </div> </div> </article> </div> </article> </section>');
                  } 
               }
               else{
                  if(v.mssg_type != "chat")
                  {
                     if('{{request.user.username}}' == v.reciever_username)
                     {
                        classtype = ''
                        message_type = ''
                        extensionmssg = ''
                        deliverymssg = ''
                        req_type= ''
                        buttons_txt = ''
                        cancel_mssg = ''
                        if(v.res_type.trim() == "cancel")
                        {
                           extensionmssg = ''
                           deliverymssg = ''
                           req_type= "cancel"
                           cancel_mssg = ''
                           if(v.res_status.trim() == "accepted")
                           {
                              classtype = '<span class="stamp order-completed"></span>'
                              message_type = 'Your order was cancelled'
                           }
                           else if(v.res_status.trim() == "rejected"){
                              classtype = '<span class="stamp resolution-declined mutual-cancellation"><span class="lFICM06 stamp-icon" aria-hidden="true" style="width: 18px; height: 18px;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 0.25C3.71875 0.25 0.25 3.71875 0.25 8C0.25 12.2812 3.71875 15.75 8 15.75C12.2812 15.75 15.75 12.2812 15.75 8C15.75 3.71875 12.2812 0.25 8 0.25ZM11.8 10.0344C11.9469 10.1813 11.9469 10.4187 11.8 10.5656L10.5625 11.8C10.4156 11.9469 10.1781 11.9469 10.0312 11.8L8 9.75L5.96562 11.8C5.81875 11.9469 5.58125 11.9469 5.43437 11.8L4.2 10.5625C4.05312 10.4156 4.05312 10.1781 4.2 10.0312L6.25 8L4.2 5.96562C4.05312 5.81875 4.05312 5.58125 4.2 5.43437L5.4375 4.19688C5.58437 4.05 5.82188 4.05 5.96875 4.19688L8 6.25L10.0344 4.2C10.1813 4.05312 10.4187 4.05312 10.5656 4.2L11.8031 5.4375C11.95 5.58437 11.95 5.82188 11.8031 5.96875L9.75 8L11.8 10.0344Z"></path></svg></span></span>'
                              message_type = 'You decided not to cancel this order'
                              if(v.cancel_mssg.trim().length != 0)
                              {
                                 cancel_mssg = '<div class="activity-collapsible-content cancel_div"><div style="max-height: unset; overflow: unset;"><div><article class="activity-body"><section class="card-wrap revision-request"><header class="card-header"><span class="card-title">Rejected Message</span> </header><div class="card-content"><div class="user-message"><a href="/user/profile/'+v.sender_username+'" class="stamp link"><div class="user-profile-image"><label class="profile-pict" for="profile_image_2825267375510" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a><div class="message-column"><p><div class="flex"><span class="username"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span>s message</span></div></p><p> '+v.cancel_mssg+'</p></div></div></div></section></article></div></div></div>'
                              }
                           }
                           else if(v.res_status.trim() == "pending"){
                              classtype = '<span class="stamp resolution-opened mutual-cancellation"></span>'
                              message_type = '<a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a>  asked to cancel this order'
                              buttons_txt = '<div class="HRhxExy ZBfSqH+ gCuoMYn" role="alert"> <span class="zv900so uB+IefT GManzyj" aria-hidden="true" style="width: 16px; height: 16px;"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M8 0C3.6 0 0 3.6 0 8C0 12.4 3.6 16 8 16C12.4 16 16 12.4 16 8C16 3.6 12.4 0 8 0ZM8 12C7.4 12 7 11.6 7 11C7 10.4 7.4 10 8 10C8.6 10 9 10.4 9 11C9 11.6 8.6 12 8 12ZM9 9H7V4H9V9Z"></path> </svg> </span> <div class="IjzCHAs"> <div> <p>You must respond by '+formatAMPM(new Date(v.res_last_date))+' or this order will be canceled</p> </div> </div> </div><div class="extend-actions"><button class="ORLWF8p T2YhX76 co-grey-1100 bg-co-grey-300" data-label="'+v.res_id+'" data-text="'+v.res_type+'" onclick="res_declineClick(this);">Decline</button><button class="ORLWF8p _0MkXbqi co-white bg-co-green-700" data-label="'+v.res_id+'" data-text="'+v.res_type+'" data-prev-date="'+v.res_prev_date+'" data-next-date="'+v.res_next_date+'" onclick="res_acceptClick(this);">Accept Request</button></div>';
                           }
                        }
                        else if(v.res_type.trim() == "extention")
                        {
                           req_type= "extention"
                           deliverymssg = ''
                           cancel_mssg = ''
                           extensionmssg = '<div class="dates-comparison"> <div class=""> <p>Original date</p> <p>'+formatDate(new Date(v.res_prev_date)) +'</p> </div> <span class="lFICM06 dates-arrow" aria-hidden="true" style="width: 16px; height: 16px;"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M9.92332 2.96885C9.63854 2.66807 9.1768 2.66807 8.89202 2.96885C8.60723 3.26963 8.60723 3.75729 8.89202 4.05807L11.6958 7.01931H1.48616C1.08341 7.01931 0.756918 7.36413 0.756918 7.7895C0.756918 8.21487 1.08341 8.5597 1.48616 8.5597H11.8436L8.89202 11.677C8.60723 11.9778 8.60723 12.4654 8.89202 12.7662C9.1768 13.067 9.63854 13.067 9.92332 12.7662L14.0459 8.41213C14.3307 8.11135 14.3307 7.62369 14.0459 7.32291L13.977 7.25011C13.9737 7.24661 13.9704 7.24315 13.9671 7.23972L9.92332 2.96885Z"></path> </svg> </span> <div class="irrelevant-date"> <p>New date</p> <p>'+formatDate(new Date(v.res_next_date))  +'</p> </div></div>';
                           if(v.res_status.trim() == "accepted")
                           {
                              classtype = '<span class="stamp order-completed"></span>'
                              message_type = '<a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a> agreed to extend the delivery date'
                           }
                           else if(v.res_status.trim() == "rejected"){
                              classtype = '<span class="stamp resolution-declined extend-delivery"><span class="lFICM06 stamp-icon" aria-hidden="true" style="width: 18px; height: 18px;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 0.25C3.71875 0.25 0.25 3.71875 0.25 8C0.25 12.2812 3.71875 15.75 8 15.75C12.2812 15.75 15.75 12.2812 15.75 8C15.75 3.71875 12.2812 0.25 8 0.25ZM11.8 10.0344C11.9469 10.1813 11.9469 10.4187 11.8 10.5656L10.5625 11.8C10.4156 11.9469 10.1781 11.9469 10.0312 11.8L8 9.75L5.96562 11.8C5.81875 11.9469 5.58125 11.9469 5.43437 11.8L4.2 10.5625C4.05312 10.4156 4.05312 10.1781 4.2 10.0312L6.25 8L4.2 5.96562C4.05312 5.81875 4.05312 5.58125 4.2 5.43437L5.4375 4.19688C5.58437 4.05 5.82188 4.05 5.96875 4.19688L8 6.25L10.0344 4.2C10.1813 4.05312 10.4187 4.05312 10.5656 4.2L11.8031 5.4375C11.95 5.58437 11.95 5.82188 11.8031 5.96875L9.75 8L11.8 10.0344Z"></path></svg></span></span>'
                              message_type = '<a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a> decided not to extend the delivery date'
                              if(v.cancel_mssg.trim().length != 0)
                              {
                                 cancel_mssg = '<div class="activity-collapsible-content cancel_div"><div style="max-height: unset; overflow: unset;"><div><article class="activity-body"><section class="card-wrap revision-request"><header class="card-header"><span class="card-title">Rejected Message</span> </header><div class="card-content"><div class="user-message"><a href="/user/profile/'+v.sender_username+'" class="stamp link"><div class="user-profile-image"><label class="profile-pict" for="profile_image_2825267375510" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a><div class="message-column"><p><div class="flex"><span class="username"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span>s message</span></div></p><p> '+v.cancel_mssg+'</p></div></div></div></section></article></div></div></div>'
                              }
                           }
                           else if(v.res_status.trim() == "pending"){
                              classtype = '<span class="stamp resolution-opened extend-delivery"></span>'
                              message_type = '<a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a> requested to extend the delivery date';
                              buttons_txt = '<div class="HRhxExy ZBfSqH+ gCuoMYn" role="alert"> <span class="zv900so uB+IefT GManzyj" aria-hidden="true" style="width: 16px; height: 16px;"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M8 0C3.6 0 0 3.6 0 8C0 12.4 3.6 16 8 16C12.4 16 16 12.4 16 8C16 3.6 12.4 0 8 0ZM8 12C7.4 12 7 11.6 7 11C7 10.4 7.4 10 8 10C8.6 10 9 10.4 9 11C9 11.6 8.6 12 8 12ZM9 9H7V4H9V9Z"></path> </svg> </span> <div class="IjzCHAs"> <div> <p>You must respond by '+formatAMPM(new Date(v.res_last_date))+' or this order will be automatically extended</p> </div> </div> </div><div class="extend-actions"><button class="ORLWF8p T2YhX76 co-grey-1100 bg-co-grey-300" data-label="'+v.res_id+'" data-text="'+v.res_type+'" onclick="res_declineClick(this);">Decline</button><button class="ORLWF8p _0MkXbqi co-white bg-co-green-700" data-label="'+v.res_id+'" data-text="'+v.res_type+'" data-prev-date="'+v.res_prev_date+'" data-next-date="'+v.res_next_date+'" onclick="res_acceptClick(this);">Accept Request</button></div>';
                           }
                        }
                        else if(v.res_type.trim() == "delivered")
                        {
                           extensionmssg = ''
                           cancel_mssg = ''
                           del_attachment_txt = ''
                           if(v.del_images.trim().length != 0)
                           {
                              del_attachments = v.del_images.trim().split(",");
                              del_attachment_txt = '<div class="attachments-preview-component"><div class="thumbnails-header"><h3>ATTACHMENTS</h3></div><ul class="attchments-container">';
                              $.each(del_attachments, function (key, value1) {
                              if(value1.trim().length != 0)
                              {
                                 file_path = '/media/delivery/'+value1.trim();
                                 del_attachment_txt += '<li class="thumbnail-preview" onclick="attachfile_onclick(this);" title="'+value+'" data-label= "'+file_path+'"><a class="thumbnail-link" href="'+file_path+'" target="_blank"><span class="fa fa-file-o fileicon" ></span></a><div class="action-bar flex flex-between"><div class="flex flex-center"><div class="attachment-name-container"><p class="attachment-name" title="'+value1+'">...'+value1.slice(-20)+'</p></div><span class="attachment-size"></span></div><div class="flex flex-center m-l-8"><a href="'+file_path+'" download class="download-button m-r-8"><span><i class="fa fa-download" aria-hidden="true"></i></span></a></div></div></li>';
                              }
                              });
                              del_attachment_txt += '</ul></div>';
                           }
                           deliverymssg = '<div class="activity-collapsible-content delivery_content"> <div style="max-height: unset; overflow: unset;"> <div> <article class="activity-body"> <section class="card-wrap delivery-card old-revision-copy"> <header class="card-header"><span class="card-title">Delivery #'+v.delivery_No+'</span> </header> <div class="card-content"> <div class="user-message"> <a href="/user/profile/'+v.sender_username+'" class="stamp link"> <div class="user-profile-image"><label class="profile-pict" for="profile_image_2405330232899" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div> </a> <div class="message-column"> <p> <div class="flex"><span class="username">'+v.sender_username+'</span></div> </p> <p>'+v.del_descrp+'</p> '+del_attachment_txt+' </div> </div>  </div> </section> </article> </div> </div></div>'
                           if(v.res_status.trim() == "accepted")
                           {
                              classtype = '<span class="stamp delivery-received"></span>'
                              message_type = 'Your order was completed'
                           }
                           else if(v.res_status.trim() == "rejected"){
                              classtype = '<span class="stamp resolution-declined delivery-received"><span class="lFICM06 stamp-icon" aria-hidden="true" style="width: 18px; height: 18px;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 0.25C3.71875 0.25 0.25 3.71875 0.25 8C0.25 12.2812 3.71875 15.75 8 15.75C12.2812 15.75 15.75 12.2812 15.75 8C15.75 3.71875 12.2812 0.25 8 0.25ZM11.8 10.0344C11.9469 10.1813 11.9469 10.4187 11.8 10.5656L10.5625 11.8C10.4156 11.9469 10.1781 11.9469 10.0312 11.8L8 9.75L5.96562 11.8C5.81875 11.9469 5.58125 11.9469 5.43437 11.8L4.2 10.5625C4.05312 10.4156 4.05312 10.1781 4.2 10.0312L6.25 8L4.2 5.96562C4.05312 5.81875 4.05312 5.58125 4.2 5.43437L5.4375 4.19688C5.58437 4.05 5.82188 4.05 5.96875 4.19688L8 6.25L10.0344 4.2C10.1813 4.05312 10.4187 4.05312 10.5656 4.2L11.8031 5.4375C11.95 5.58437 11.95 5.82188 11.8031 5.96875L9.75 8L11.8 10.0344Z"></path></svg></span></span>'
                              message_type = 'Sorry your delivery was rejected'
                              if(v.cancel_mssg.trim().length != 0)
                              {
                                 cancel_mssg = '<div class="activity-collapsible-content cancel_div"><div style="max-height: unset; overflow: unset;"><div><article class="activity-body"><section class="card-wrap revision-request"><header class="card-header"><span class="card-title">Rejected Message</span> </header><div class="card-content"><div class="user-message"><a href="/user/profile/'+v.sender_username+'" class="stamp link"><div class="user-profile-image"><label class="profile-pict" for="profile_image_2825267375510" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a><div class="message-column"><p><div class="flex"><span class="username"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span>s message</span></div></p><p> '+v.cancel_mssg+'</p></div></div></div></section></article></div></div></div>'
                              }
                           }
                           else if(v.res_status.trim() == "pending"){
                              classtype = '<span class="stamp resolution-opened delivery-received"></span>'
                              message_type =  '<a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a>  delivered your order';
                              buttons_txt = '<div class="HRhxExy ZBfSqH+ gCuoMYn" role="alert"> <span class="zv900so uB+IefT GManzyj" aria-hidden="true" style="width: 16px; height: 16px;"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M8 0C3.6 0 0 3.6 0 8C0 12.4 3.6 16 8 16C12.4 16 16 12.4 16 8C16 3.6 12.4 0 8 0ZM8 12C7.4 12 7 11.6 7 11C7 10.4 7.4 10 8 10C8.6 10 9 10.4 9 11C9 11.6 8.6 12 8 12ZM9 9H7V4H9V9Z"></path> </svg> </span> <div class="IjzCHAs"> <div> <p>You must respond by '+formatAMPM(new Date(v.res_last_date))+' or this order will be automatically marked as completed</p> </div> </div> </div><div class="extend-actions"><button class="ORLWF8p T2YhX76 co-grey-1100 bg-co-grey-300" data-label="'+v.res_id+'" data-text="'+v.res_type+'" onclick="res_declineClick(this);">Request Revision</button><button class="ORLWF8p _0MkXbqi co-white bg-co-green-700" data-label="'+v.res_id+'" data-text="'+v.res_type+'" data-prev-date="'+v.res_prev_date+'" data-next-date="'+v.res_next_date+'" onclick="res_acceptClick(this);">Mark As Completed</button></div>';
                           } 
                        }
                        else if(v.res_type.trim() == "completed")
                        {
                           classtype = '<span class="stamp order-completed"></span>'
                           message_type = 'Your order was completed'
                           deliverymssg = ''
                           extensionmssg = ''
                           cancel_mssg = ''
                        }
                        $('#loaded_messages').find("#"+div_id).append('<section class="activity-wrap resolution-opened"> <article class="LF267+J H1pvagJ PpAciwT"> <div class="AuUenGR activity-collapsible-title-wrapper"> <div class="CLdO82Y"> <label> '+classtype+'<p class="header-base "><span class="title-text"><span>'+message_type+'</span></span><i class="time-stamp">'+formatAMPM(new Date(v.mssg_time))+'</i></p> </label> </div> </div> <div class="activity-collapsible-content"> <div style="max-height: unset; overflow: unset;"> <div> <article class="activity-body"> <section class="card-wrap resolution mutual-cancellation-section"> <div class="card-content"> <div class="user-message"> <a href="user/profile/'+v.reciever_username+'" class="stamp link"> <div class="user-profile-image"><label class="profile-pict" for="profile_image_9928531938024" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.reciever_img+'" class="profile-pict-img" alt="'+v.reciever_username+'"></label></div> </a> <div class="message-column"> <p> <div class="flex"><span class="username"><span><a href="/user/profile/'+v.reciever_username+'" class="username-url">'+v.reciever_username+'</a></span></span></div> </p> <p>'+get_url_text(v.res_message)+'</p> '+ extensionmssg + deliverymssg + cancel_mssg + '  </div> </div>  '+buttons_txt+' </div> </section> </article> </div> </div> </div> </article></section>');
                     }
                     else{
                        classtype = ''
                        message_type = ''
                        extensionmssg = ''
                        deliverymssg = ''
                        cancel_mssg = ''
                        if(v.res_type.trim() == "cancel")
                        {
                           extensionmssg = ''
                           deliverymssg = ''
                           cancel_mssg = ''
                           if(v.res_status.trim() == "accepted")
                           {
                              classtype = '<span class="stamp order-completed"></span>'
                              message_type = '<a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a> order was cancelled'
                           }
                           else if(v.res_status.trim() == "rejected"){
                              classtype = '<span class="stamp resolution-declined mutual-cancellation"><span class="lFICM06 stamp-icon" aria-hidden="true" style="width: 18px; height: 18px;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 0.25C3.71875 0.25 0.25 3.71875 0.25 8C0.25 12.2812 3.71875 15.75 8 15.75C12.2812 15.75 15.75 12.2812 15.75 8C15.75 3.71875 12.2812 0.25 8 0.25ZM11.8 10.0344C11.9469 10.1813 11.9469 10.4187 11.8 10.5656L10.5625 11.8C10.4156 11.9469 10.1781 11.9469 10.0312 11.8L8 9.75L5.96562 11.8C5.81875 11.9469 5.58125 11.9469 5.43437 11.8L4.2 10.5625C4.05312 10.4156 4.05312 10.1781 4.2 10.0312L6.25 8L4.2 5.96562C4.05312 5.81875 4.05312 5.58125 4.2 5.43437L5.4375 4.19688C5.58437 4.05 5.82188 4.05 5.96875 4.19688L8 6.25L10.0344 4.2C10.1813 4.05312 10.4187 4.05312 10.5656 4.2L11.8031 5.4375C11.95 5.58437 11.95 5.82188 11.8031 5.96875L9.75 8L11.8 10.0344Z"></path></svg></span></span>'
                              message_type = '<a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a> decided not to cancel this order'
                              if(v.cancel_mssg.trim().length != 0)
                              {
                                 cancel_mssg = '<div class="activity-collapsible-content cancel_div"><div style="max-height: unset; overflow: unset;"><div><article class="activity-body"><section class="card-wrap revision-request"><header class="card-header"><span class="card-title">Rejected Message</span> </header><div class="card-content"><div class="user-message"><a href="/user/profile/'+v.sender_username+'" class="stamp link"><div class="user-profile-image"><label class="profile-pict" for="profile_image_2825267375510" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a><div class="message-column"><p><div class="flex"><span class="username"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span>s message</span></div></p><p> '+v.cancel_mssg+'</p></div></div></div></section></article></div></div></div>'
                              }
                           }
                           else if(v.res_status.trim() == "pending"){
                              classtype = '<span class="stamp resolution-opened mutual-cancellation"></span>'
                              message_type = '<a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a>  asked to cancel this order'
                           }
                        }
                        else if(v.res_type.trim() == "extention")
                        {
                           deliverymssg = ''
                           cancel_mssg = ''
                           extensionmssg = '<div class="dates-comparison"> <div class=""> <p>Original date</p> <p>'+formatDate(new Date(v.res_prev_date)) +'</p> </div> <span class="lFICM06 dates-arrow" aria-hidden="true" style="width: 16px; height: 16px;"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M9.92332 2.96885C9.63854 2.66807 9.1768 2.66807 8.89202 2.96885C8.60723 3.26963 8.60723 3.75729 8.89202 4.05807L11.6958 7.01931H1.48616C1.08341 7.01931 0.756918 7.36413 0.756918 7.7895C0.756918 8.21487 1.08341 8.5597 1.48616 8.5597H11.8436L8.89202 11.677C8.60723 11.9778 8.60723 12.4654 8.89202 12.7662C9.1768 13.067 9.63854 13.067 9.92332 12.7662L14.0459 8.41213C14.3307 8.11135 14.3307 7.62369 14.0459 7.32291L13.977 7.25011C13.9737 7.24661 13.9704 7.24315 13.9671 7.23972L9.92332 2.96885Z"></path> </svg> </span> <div class="irrelevant-date"> <p>New date</p> <p>'+ formatDate(new Date(v.res_next_date)) +'</p> </div></div>';
                           if(v.res_status.trim() == "accepted")
                           {
                              classtype = '<span class="stamp order-completed"></span>'                              
                              message_type = '<a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a> agreed to extend the delivery date'
                           }
                           else if(v.res_status.trim() == "rejected"){
                              classtype = '<span class="stamp resolution-declined extend-delivery"><span class="lFICM06 stamp-icon" aria-hidden="true" style="width: 18px; height: 18px;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 0.25C3.71875 0.25 0.25 3.71875 0.25 8C0.25 12.2812 3.71875 15.75 8 15.75C12.2812 15.75 15.75 12.2812 15.75 8C15.75 3.71875 12.2812 0.25 8 0.25ZM11.8 10.0344C11.9469 10.1813 11.9469 10.4187 11.8 10.5656L10.5625 11.8C10.4156 11.9469 10.1781 11.9469 10.0312 11.8L8 9.75L5.96562 11.8C5.81875 11.9469 5.58125 11.9469 5.43437 11.8L4.2 10.5625C4.05312 10.4156 4.05312 10.1781 4.2 10.0312L6.25 8L4.2 5.96562C4.05312 5.81875 4.05312 5.58125 4.2 5.43437L5.4375 4.19688C5.58437 4.05 5.82188 4.05 5.96875 4.19688L8 6.25L10.0344 4.2C10.1813 4.05312 10.4187 4.05312 10.5656 4.2L11.8031 5.4375C11.95 5.58437 11.95 5.82188 11.8031 5.96875L9.75 8L11.8 10.0344Z"></path></svg></span></span>'
                              message_type = 'You decided not to extend the delivery date'
                              if(v.cancel_mssg.trim().length != 0)
                              {
                                 cancel_mssg = '<div class="activity-collapsible-content cancel_div"><div style="max-height: unset; overflow: unset;"><div><article class="activity-body"><section class="card-wrap revision-request"><header class="card-header"><span class="card-title">Rejected Message</span> </header><div class="card-content"><div class="user-message"><a href="/user/profile/'+v.sender_username+'" class="stamp link"><div class="user-profile-image"><label class="profile-pict" for="profile_image_2825267375510" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a><div class="message-column"><p><div class="flex"><span class="username"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span>s message</span></div></p><p> '+v.cancel_mssg+'</p></div></div></div></section></article></div></div></div>'
                              }
                           }
                           else if(v.res_status.trim() == "pending"){
                              classtype = '<span class="stamp resolution-opened extend-delivery"></span>'
                              message_type = 'You requested to extend the delivery date'
                           }
                        }
                        else if(v.res_type.trim() == "delivered")
                        {
                           extensionmssg = ''
                           cancel_mssg = ''
                           del_attachment_txt= ''
                           if(v.del_images.trim().length != 0)
                           {
                              del_attachments = v.del_images.trim().split(",");
                              del_attachment_txt = '<div class="attachments-preview-component"><div class="thumbnails-header"><h3>ATTACHMENTS</h3></div><ul class="attchments-container">';
                              $.each(del_attachments, function (key, value1) {
                              if(value1.trim().length != 0)
                              {
                                 file_path = '/media/delivery/'+value1.trim();
                                 del_attachment_txt += '<li class="thumbnail-preview" onclick="attachfile_onclick(this);" title="'+value+'" data-label= "'+file_path+'"><a class="thumbnail-link" href="'+file_path+'" target="_blank"><span class="fa fa-file-o fileicon" ></span></a><div class="action-bar flex flex-between"><div class="flex flex-center"><div class="attachment-name-container"><p class="attachment-name" title="'+value1+'">...'+value1.slice(-20)+'</p></div><span class="attachment-size"></span></div><div class="flex flex-center m-l-8"><a href="'+file_path+'" download class="download-button m-r-8"><span><i class="fa fa-download" aria-hidden="true"></i></span></a></div></div></li>';
                              }
                              });
                              del_attachment_txt += '</ul></div>';
                           }
                           deliverymssg = '<div class="activity-collapsible-content delivery_content"> <div style="max-height: unset; overflow: unset;"> <div> <article class="activity-body"> <section class="card-wrap delivery-card old-revision-copy"> <header class="card-header"><span class="card-title">Delivery #'+v.delivery_No+'</span> </header> <div class="card-content"> <div class="user-message"> <a href="/user/profile/'+v.sender_username+'" class="stamp link"> <div class="user-profile-image"><label class="profile-pict" for="profile_image_2405330232899" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div> </a> <div class="message-column"> <p> <div class="flex"><span class="username">Me</span></div> </p> <p>'+v.del_descrp+'</p> '+del_attachment_txt+' </div> </div> <div class="warning-note auto-complete"> <span class="lFICM06 note-icon" aria-hidden="true" style="width: 18px; height: 18px;"> <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <path d="M8 0.25C3.71875 0.25 0.25 3.71875 0.25 8C0.25 12.2812 3.71875 15.75 8 15.75C12.2812 15.75 15.75 12.2812 15.75 8C15.75 3.71875 12.2812 0.25 8 0.25ZM8 14.25C4.54688 14.25 1.75 11.4531 1.75 8C1.75 4.54688 4.54688 1.75 8 1.75C11.4531 1.75 14.25 4.54688 14.25 8C14.25 11.4531 11.4531 14.25 8 14.25ZM9.93125 10.9875L7.27812 9.05937C7.18125 8.9875 7.125 8.875 7.125 8.75625V3.625C7.125 3.41875 7.29375 3.25 7.5 3.25H8.5C8.70625 3.25 8.875 3.41875 8.875 3.625V8.05313L10.9625 9.57187C11.1312 9.69375 11.1656 9.92813 11.0437 10.0969L10.4563 10.9062C10.3344 11.0719 10.1 11.1094 9.93125 10.9875Z"></path> </svg> </span> <p class="tbody-6"><span class="note-text"><a href="/user/profile/'+v.reciever_username+'" class="username-url">'+v.reciever_username+'</a> has until <b>'+formatAMPM(new Date(v.res_last_date))+'</b> to approve this delivery or request a revision. After this date, the order will be finalized and marked as complete.</span></p> </div> </div> </section> </article> </div> </div></div>'
                           if(v.res_status.trim() == "accepted")
                           {
                              classtype = '<span class="stamp delivery-received"></span>'
                              message_type = 'Your order was completed'
                           }
                           else if(v.res_status.trim() == "rejected"){
                              classtype = '<span class="stamp resolution-declined delivery-received"><span class="lFICM06 stamp-icon" aria-hidden="true" style="width: 18px; height: 18px;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 0.25C3.71875 0.25 0.25 3.71875 0.25 8C0.25 12.2812 3.71875 15.75 8 15.75C12.2812 15.75 15.75 12.2812 15.75 8C15.75 3.71875 12.2812 0.25 8 0.25ZM11.8 10.0344C11.9469 10.1813 11.9469 10.4187 11.8 10.5656L10.5625 11.8C10.4156 11.9469 10.1781 11.9469 10.0312 11.8L8 9.75L5.96562 11.8C5.81875 11.9469 5.58125 11.9469 5.43437 11.8L4.2 10.5625C4.05312 10.4156 4.05312 10.1781 4.2 10.0312L6.25 8L4.2 5.96562C4.05312 5.81875 4.05312 5.58125 4.2 5.43437L5.4375 4.19688C5.58437 4.05 5.82188 4.05 5.96875 4.19688L8 6.25L10.0344 4.2C10.1813 4.05312 10.4187 4.05312 10.5656 4.2L11.8031 5.4375C11.95 5.58437 11.95 5.82188 11.8031 5.96875L9.75 8L11.8 10.0344Z"></path></svg></span></span>'
                              message_type = 'Sorry your delivery was rejected'
                              if(v.cancel_mssg.trim().length != 0)
                              {
                                 cancel_mssg = '<div class="activity-collapsible-content cancel_div"><div style="max-height: unset; overflow: unset;"><div><article class="activity-body"><section class="card-wrap revision-request"><header class="card-header"><span class="card-title">Rejected Message</span> </header><div class="card-content"><div class="user-message"><a href="/user/profile/'+v.sender_username+'" class="stamp link"><div class="user-profile-image"><label class="profile-pict" for="profile_image_2825267375510" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a><div class="message-column"><p><div class="flex"><span class="username"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span>s message</span></div></p><p> '+v.cancel_mssg+'</p></div></div></div></section></article></div></div></div>'
                              }
                           }
                           else if(v.res_status.trim() == "pending"){
                              classtype = '<span class="stamp resolution-opened delivery-received"></span>'
                              message_type =  'You delivered the order'
                           } 
                        }
                        else if(v.res_type.trim() == "completed")
                        {
                           classtype = '<span class="stamp order-completed"></span>'
                           message_type = 'Your order was completed'
                           deliverymssg = ''
                           extensionmssg = ''
                        }
                        $('#loaded_messages').find("#"+div_id).append('<section class="activity-wrap resolution-withdrawn"><article class="LF267+J H1pvagJ PpAciwT"><div class="AuUenGR activity-collapsible-title-wrapper"><div class="CLdO82Y"><label> '+classtype+'<p class="header-base "><span class="title-text">'+message_type+'</span><i class="time-stamp">'+formatAMPM(new Date(v.mssg_time))+'</i></p></label></div></div><div class="activity-collapsible-content"><div style="max-height: unset; overflow: unset;"><div><article class="activity-body"><section class="card-wrap resolution mutual-cancellation-section"><div class="card-content"><div class="user-message"><a href="user/profile/'+v.reciever_username+'" class="stamp link"><div class="user-profile-image"><label class="profile-pict" for="profile_image_7171343538020" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.reciever_img+'" class="profile-pict-img" alt="'+v.reciever_username+'"></label></div></a><div class="message-column"><p><div class="flex"><span class="username"><span><a href="/user/profile/'+v.reciever_username+'" class="username-url">'+v.reciever_username+'</a></span></span></div></p><p>'+ get_url_text(v.res_message)+'</p> '+ extensionmssg + deliverymssg + cancel_mssg +'</div></div></div></section></article></div></div></div></article></section>');
                     }
                  }
                  else
                  {
                     if('{{request.user.username}}' == v.sender_username)
                     {
                        $('#loaded_messages').find("#"+div_id).append('<section class="activity-wrap is-message message-received"> <article class="LF267+J H1pvagJ PpAciwT"> <div class="AuUenGR activity-collapsible-title-wrapper"> <div class="CLdO82Y"> <label> <a href="/user/profile/'+v.sender_username+'" class="stamp link message-sent"> <div class="user-profile-image"> <label class="profile-pict" for="profile_image_8475174845636" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a> <p class="header-base "><span class="title-text"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span> sent you a message</span><i class="time-stamp">'+formatAMPM(new Date(v.timestamp))+'</i></p> </label> </div> </div> <div class="activity-collapsible-content"> <article class="activity-body"> <div style="max-height: unset; overflow: unset;"> <div> <div class="body-with-attachments"> <p class="message-content">'+ get_url_text(v.message) +'</p> </div> </div> </div> </article> </div> </article> </section>');
                     }
                     else{
                        $('#loaded_messages').find("#"+div_id).append('<section class="activity-wrap is-message message-received"> <article class="LF267+J H1pvagJ PpAciwT"> <div class="AuUenGR activity-collapsible-title-wrapper"> <div class="CLdO82Y"> <label> <a href="/user/profile/'+v.sender_username+'" class="stamp link message-sent"> <div class="user-profile-image"> <label class="profile-pict" for="profile_image_8475174845636" style="width: 40px; height: 40px; font-size: 1em;"><img src="'+v.sender_img+'" class="profile-pict-img" alt="'+v.sender_username+'"></label></div></a> <p class="header-base "><span class="title-text"><span><a href="/user/profile/'+v.sender_username+'" class="username-url">'+v.sender_username+'</a></span> sent you a message</span><i class="time-stamp">'+formatAMPM(new Date(v.timestamp))+'</i></p> </label> </div> </div> <div class="activity-collapsible-content"> <article class="activity-body"> <div style="max-height: unset; overflow: unset;"> <div> <div class="body-with-attachments"> <p class="message-content">'+get_url_text(v.message)+'</p> </div> </div> </div> </article> </div> </article> </section>');
                     }
                  }         
               }
            });
            $("#message_ids").val(message_id.join(", "));
            if(message_id.length == 0){
               $("#h_previous_mssg").hide();
            }
         }
      });
   }
   }
</script>
{% endblock %}
